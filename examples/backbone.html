<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>ePubJS Promises Example</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="basic.css">

        <script src="../bower_components/jquery/dist/jquery.js"></script>
        <script src="../bower_components/underscore/underscore.js"></script>
        <script src="../bower_components/backbone/backbone.js"></script>

        <script src="../build/libs/zip.min.js"></script>

        <!-- EPUBJS Renderer -->
        <script src="/build/epub.min.js"></script>
    </head>
    <body>
        <div id="main">
          <div id="loader"><img src="../reader/img/loader.gif"></div>
          <select id="toc"></select>
        </div>

        <script type="text/template" id="template">
            <div id="prev" class="arrow">‹</div>
            <div id="area"></div>
            <div id="next" class="arrow">›</div>
        </script>

        <script>
            var BB = {};

            var Library = new Backbone.Model();
 
            // Router
            BB.Router = Backbone.Router.extend({
              routes: {
                "book/:p"   : "details"
              },
           
              details: function(hash){
                var view = new Book.Views.Details({model: Library.get(hash)});
                view.render(function(el){
                  $("#main").html(el);
                });
              }
            });
           
            // Instantiate Router
            var router = new BB.Router();

            BB.Views = {};

            // This will fetch the book template and render it.
            BB.Views.Details = Backbone.View.extend({

              el: '#main',

              book: ePub("/reader/moby-dick.epub", { restore: true }),

              model: Library,

              events: {
                  'click #next': 'nextPage',
                  'click #prev': 'previousPage'
              },

              template: _.template( $('#template').html() ),

              initialize: function() {
                  this.area = $('<div></div>');

                  this.book.renderTo(this.area[0]);
              },
           
              render: function(done) {
                var view = this;

                  this.$el.html(this.template());

                  this.$('#area').html(this.area);

                  this.bindIframe();

                  return this;
              },

              nextPage: function(e){
                  e.preventDefault();

                  this.book.nextPage();
              },

              previousPage: function(e){
                  e.preventDefault();

                  this.book.prevPage()
              }
            });
           
            var view = new BB.Views.Details();

            view.render();

        </script>
    </body>
</html>
