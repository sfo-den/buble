EPUBJS.reader={},EPUBJS.reader.plugins={},function(a){var b=a.ePubReader||{},c=a.ePubReader=function(a,b){return new EPUBJS.Reader(a,b)};_.extend(c,{noConflict:function(){return a.ePubReader=b,this}}),"function"==typeof define&&define.amd?define(function(){return Reader}):"undefined"!=typeof module&&module.exports&&(module.exports=c)}(window),EPUBJS.Reader=function(a,b){var c=this,d=_.defaults(b||{},{restore:!0}),e=this.book=ePub(a,d);return this.settings=d,this.offline=!1,this.sidebarOpen=!1,e.renderTo("viewer"),c.SettingsView=EPUBJS.reader.SettingsView.call(c,e),c.ControlsView=EPUBJS.reader.ControlsView.call(c,e),c.SidebarView=EPUBJS.reader.SidebarView.call(c,e),e.ready.all.then(function(){c.ReaderView=EPUBJS.reader.ReaderView.call(c,e);for(var a in EPUBJS.reader.plugins)EPUBJS.reader.plugins.hasOwnProperty(a)&&(c[a]=EPUBJS.reader.plugins[a].call(c,e))}),e.getMetadata().then(function(a){c.MetaView=EPUBJS.reader.MetaView.call(c,a)}),e.getToc().then(function(a){c.TocView=EPUBJS.reader.TocView.call(c,a)}),this},EPUBJS.reader.MetaView=function(a){var b=a.bookTitle,c=a.creator,d=$("#book-title"),e=$("#chapter-title"),f=$("#title-seperator");document.title=b+" â€“ "+c,d.html(b),e.html(c),f.show()},EPUBJS.reader.ReaderView=function(a){var b=$("#main"),c=$("#divider"),d=$("#loader"),e=$("#next"),f=$("#prev"),g=function(){b.removeClass("closed")},h=function(){b.addClass("closed")},i=function(){d.show()},j=function(){d.hide()},k=function(){c.addClass("show")},l=function(){c.removeClass("show")},m=!1,n=function(b){37==b.keyCode&&(a.prevPage(),f.addClass("active"),m=!0,setTimeout(function(){m=!1,f.removeClass("active")},100),b.preventDefault()),39==b.keyCode&&(a.nextPage(),e.addClass("active"),m=!0,setTimeout(function(){m=!1,e.removeClass("active")},100),b.preventDefault())};return document.addEventListener("keydown",n,!1),e.on("click",function(b){a.nextPage(),b.preventDefault()}),f.on("click",function(b){a.prevPage(),b.preventDefault()}),j(),a.single||k(),{slideOut:h,slideIn:g,showLoader:i,hideLoader:j,showDivider:k,hideDivider:l}},EPUBJS.reader.SidebarView=function(){var a=this,b=$("#sidebar"),c=$("#panels"),d="TocView",e=function(b){d!=b&&"undefined"!=typeof a[b]&&(a[d].hide(),a[b].show(),d=b,c.find(".active").removeClass("active"),c.find("#show-"+b).addClass("active"))},f=function(){a.sidebarOpen=!0,a.ReaderView.slideOut(),b.addClass("open")},g=function(){a.sidebarOpen=!1,a.ReaderView.slideIn(),b.removeClass("open")};return c.find(".show_view").on("click",function(a){var b=$(this).data("view");e(b),a.preventDefault()}),{show:f,hide:g,activePanel:d,changePanelTo:e}},EPUBJS.reader.ControlsView=function(a){var b=this,c=($("#store"),$("#fullscreen")),d=$("#fullscreenicon"),e=$("#cancelfullscreenicon"),f=$("#slider"),g=($("#main"),$("#sidebar"),$("#settings")),h=$("#bookmark"),i=function(){b.offline=!1},j=function(){b.offline=!0};return a.on("book:online",i),a.on("book:offline",j),f.on("click",function(){b.sidebarOpen?(b.SidebarView.hide(),f.addClass("icon-menu"),f.removeClass("icon-right")):(b.SidebarView.show(),f.addClass("icon-right"),f.removeClass("icon-menu"))}),c.on("click",function(){screenfull.toggle($("#container")[0]),d.toggle(),e.toggle()}),g.on("click",function(){b.SettingsView.show()}),h.on("click",function(){h.addClass("icon-bookmark"),h.removeClass("icon-bookmark-empty"),console.log(b.book.getCurrentLocationCfi())}),a.on("renderer:pageChanged",function(){h.removeClass("icon-bookmark").addClass("icon-bookmark-empty")}),{}},EPUBJS.reader.TocView=function(a){var b=this.book,c=$("#tocView"),d=document.createDocumentFragment(),e=!1,f=function(a,b){var c=document.createElement("ul");return b||(b=1),a.forEach(function(a){var d=document.createElement("li"),e=document.createElement("a");toggle=document.createElement("a");var g;d.id="toc-"+a.id,e.textContent=a.label,e.href=a.href,e.classList.add("toc_link"),d.appendChild(e),a.subitems&&(b++,g=f(a.subitems,b),toggle.classList.add("toc_toggle"),d.insertBefore(toggle,e),d.appendChild(g)),c.appendChild(d)}),c},g=function(){c.show()},h=function(){c.hide()},i=function(a){var b=a.id,d=c.find("#toc-"+b),f=c.find(".currentChapter");c.find(".openChapter"),d.length&&(d!=f&&d.has(e).length>0&&f.removeClass("currentChapter"),d.addClass("currentChapter"),d.parents("li").addClass("openChapter"))};b.on("renderer:chapterDisplayed",i);var j=f(a);return d.appendChild(j),c.append(d),c.find(".toc_link").on("click",function(a){var d=this.getAttribute("href");b.goto(d),c.find(".currentChapter").addClass("openChapter").removeClass("currentChapter"),$(this).parent("li").addClass("currentChapter"),a.preventDefault()}),c.find(".toc_toggle").on("click",function(a){var b=$(this).parent("li"),c=b.hasClass("openChapter");c?b.removeClass("openChapter"):b.addClass("openChapter"),a.preventDefault()}),{show:g,hide:h}},EPUBJS.reader.SettingsView=function(){this.book;var a=$("#settingsPanel"),b=function(){a.show()},c=function(){a.hide()};return{show:b,hide:c}};