!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ePub=t()}}(function(){var t;return function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return n(i?i:e)},c,c.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e){function i(t){return t&&n[t.split(".").pop().toLowerCase()]||o}var r={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},n=function(){var t,e,i,n,o={};for(t in r)if(r.hasOwnProperty(t))for(e in r[t])if(r[t].hasOwnProperty(e))if(i=r[t][e],"string"==typeof i)o[i]=t+"/"+e;else for(n=0;n<i.length;n++)o[i[n]]=t+"/"+e;return o}(),o="text/plain";e.exports={lookup:i}},{}],2:[function(){},{}],3:[function(t,e){function i(){u=!1,s.length?h=s.concat(h):c=-1,h.length&&r()}function r(){if(!u){var t=setTimeout(i);u=!0;for(var e=h.length;e;){for(s=h,h=[];++c<e;)s&&s[c].run();c=-1,e=h.length}s=null,u=!1,clearTimeout(t)}}function n(t,e){this.fun=t,this.array=e}function o(){}var s,a=e.exports={},h=[],u=!1,c=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new n(t,e)),1!==h.length||u||setTimeout(r,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],4:[function(e,i){(function(e){(function(){"use strict";function r(t,e){for(var i=0,r=t.length;r>i;i++)if(t[i]===e)return i;return-1}function n(t){var e=t._promiseCallbacks;return e||(e=t._promiseCallbacks={}),e}function o(t,e){return"onerror"===t?(K.on("error",e),void 0):2!==arguments.length?K[t]:(K[t]=e,void 0)}function s(t){return"function"==typeof t||"object"==typeof t&&null!==t}function a(t){return"function"==typeof t}function h(t){return"object"==typeof t&&null!==t}function u(){}function c(){}function p(t){try{return t.then}catch(e){return he.error=e,he}}function l(t,e,i,r){try{t.call(e,i,r)}catch(n){return n}}function d(t,e,i){K.async(function(t){var r=!1,n=l(i,e,function(i){r||(r=!0,e!==i?g(t,i):v(t,i))},function(e){r||(r=!0,b(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&n&&(r=!0,b(t,n))},t)}function f(t,e){e._state===se?v(t,e._result):t._state===ae?b(t,e._result):w(e,void 0,function(i){e!==i?g(t,i):v(t,i)},function(e){b(t,e)})}function m(t,e){if(e.constructor===t.constructor)f(t,e);else{var i=p(e);i===he?b(t,he.error):void 0===i?v(t,e):a(i)?d(t,e,i):v(t,e)}}function g(t,e){t===e?v(t,e):s(e)?m(t,e):v(t,e)}function y(t){t._onerror&&t._onerror(t._result),x(t)}function v(t,e){t._state===oe&&(t._result=e,t._state=se,0===t._subscribers.length?K.instrument&&ne("fulfilled",t):K.async(x,t))}function b(t,e){t._state===oe&&(t._state=ae,t._result=e,K.async(y,t))}function w(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+se]=i,n[o+ae]=r,0===o&&t._state&&K.async(x,t)}function x(t){var e=t._subscribers,i=t._state;if(K.instrument&&ne(i===se?"fulfilled":"rejected",t),0!==e.length){for(var r,n,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?T(i,r,n,o):n(o);t._subscribers.length=0}}function _(){this.error=null}function S(t,e){try{return t(e)}catch(i){return ue.error=i,ue}}function T(t,e,i,r){var n,o,s,h,u=a(i);if(u){if(n=S(i,r),n===ue?(h=!0,o=n.error,n=null):s=!0,e===n)return b(e,new TypeError("A promises callback cannot return that same promise.")),void 0}else n=r,s=!0;e._state!==oe||(u&&s?g(e,n):h?b(e,o):t===se?v(e,n):t===ae&&b(e,n))}function E(t,e){try{e(function(e){g(t,e)},function(e){b(t,e)})}catch(i){b(t,i)}}function k(t,e,i){return t===se?{state:"fulfilled",value:i}:{state:"rejected",reason:i}}function C(t,e,i,r){this._instanceConstructor=t,this.promise=new t(c,r),this._abortOnReject=i,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?v(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&v(this.promise,this._result))):b(this.promise,this._validationError())}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function A(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function P(t,e){this._id=ge++,this._label=e,this._state=void 0,this._result=void 0,this._subscribers=[],K.instrument&&ne("created",this),c!==t&&(a(t)||q(),this instanceof P||A(),E(this,t))}function R(){this.value=void 0}function L(t){try{return t.then}catch(e){return ve.value=e,ve}}function N(t,e,i){try{t.apply(e,i)}catch(r){return ve.value=r,ve}}function O(t,e){for(var i,r,n={},o=t.length,s=new Array(o),a=0;o>a;a++)s[a]=t[a];for(r=0;r<e.length;r++)i=e[r],n[i]=s[r+1];return n}function B(t){for(var e=t.length,i=new Array(e-1),r=1;e>r;r++)i[r-1]=t[r];return i}function z(t,e){return{then:function(i,r){return t.call(e,i,r)}}}function F(t,e,i,r){var n=N(i,r,e);return n===ve&&b(t,n.value),t}function I(t,e,i,r){return ye.all(e).then(function(e){var n=N(i,r,e);return n===ve&&b(t,n.value),t})}function j(t){return t&&"object"==typeof t?t.constructor===ye?!0:L(t):!1}function U(t,e,i){this._superConstructor(t,e,!1,i)}function Q(t,e,i){this._superConstructor(t,e,!0,i)}function D(t,e,i){this._superConstructor(t,e,!1,i)}function H(){return function(){e.nextTick(X)}}function M(){var t=0,e=new Fe(X),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function W(){var t=new MessageChannel;return t.port1.onmessage=X,function(){t.port2.postMessage(0)}}function V(){return function(){setTimeout(X,1)}}function X(){for(var t=0;Oe>t;t+=2){var e=je[t],i=je[t+1];e(i),je[t]=void 0,je[t+1]=void 0}Oe=0}function $(t,e){K.async(t,e)}function J(){K.on.apply(K,arguments)}function Z(){K.off.apply(K,arguments)}var Y={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t._promiseCallbacks=void 0,t},on:function(t,e){var i,o=n(this);i=o[t],i||(i=o[t]=[]),-1===r(i,e)&&i.push(e)},off:function(t,e){var i,o,s=n(this);return e?(i=s[t],o=r(i,e),-1!==o&&i.splice(o,1),void 0):(s[t]=[],void 0)},trigger:function(t,e){var i,r,o=n(this);if(i=o[t])for(var s=0;s<i.length;s++)r=i[s],r(e)}},K={instrument:!1};Y.mixin(K);var G;G=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var te=G,ee=Date.now||function(){return(new Date).getTime()},ie=Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return u.prototype=t,new u},re=[],ne=function(t,e,i){1===re.push({name:t,payload:{guid:e._guidKey+e._id,eventName:t,detail:e._result,childGuid:i&&e._guidKey+i._id,label:e._label,timeStamp:ee(),stack:new Error(e._label).stack}})&&setTimeout(function(){for(var t,e=0;e<re.length;e++)t=re[e],K.trigger(t.name,t.payload);re.length=0},50)},oe=void 0,se=1,ae=2,he=new _,ue=new _;C.prototype._validateInput=function(t){return te(t)},C.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},C.prototype._init=function(){this._result=new Array(this.length)};var ce=C;C.prototype._enumerate=function(){for(var t=this.length,e=this.promise,i=this._input,r=0;e._state===oe&&t>r;r++)this._eachEntry(i[r],r)},C.prototype._eachEntry=function(t,e){var i=this._instanceConstructor;h(t)?t.constructor===i&&t._state!==oe?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(i.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(se,e,t))},C.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===oe&&(this._remaining--,this._abortOnReject&&t===ae?b(r,i):this._result[e]=this._makeResult(t,e,i)),0===this._remaining&&v(r,this._result)},C.prototype._makeResult=function(t,e,i){return i},C.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){i._settledAt(se,e,t)},function(t){i._settledAt(ae,e,t)})};var pe=function(t,e){return new ce(this,t,!0,e).promise},le=function(t,e){function i(t){g(o,t)}function r(t){b(o,t)}var n=this,o=new n(c,e);if(!te(t))return b(o,new TypeError("You must pass an array to race.")),o;for(var s=t.length,a=0;o._state===oe&&s>a;a++)w(n.resolve(t[a]),void 0,i,r);return o},de=function(t,e){var i=this;if(t&&"object"==typeof t&&t.constructor===i)return t;var r=new i(c,e);return g(r,t),r},fe=function(t,e){var i=this,r=new i(c,e);return b(r,t),r},me="rsvp_"+ee()+"-",ge=0,ye=P;P.cast=de,P.all=pe,P.race=le,P.resolve=de,P.reject=fe,P.prototype={constructor:P,_guidKey:me,_onerror:function(t){K.trigger("error",t)},then:function(t,e,i){var r=this,n=r._state;if(n===se&&!t||n===ae&&!e)return K.instrument&&ne("chained",this,this),this;r._onerror=null;var o=new this.constructor(c,i),s=r._result;if(K.instrument&&ne("chained",r,o),n){var a=arguments[n-1];K.async(function(){T(n,o,a,s)})}else w(r,o,t,e);return o},"catch":function(t,e){return this.then(null,t,e)},"finally":function(t,e){var i=this.constructor;return this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})},e)}};var ve=new R,be=new R,we=function(t,e){var i=function(){for(var i,r=this,n=arguments.length,o=new Array(n+1),s=!1,a=0;n>a;++a){if(i=arguments[a],!s){if(s=j(i),s===be){var h=new ye(c);return b(h,be.value),h}s&&s!==!0&&(i=z(s,i))}o[a]=i}var u=new ye(c);return o[n]=function(t,i){t?b(u,t):void 0===e?g(u,i):e===!0?g(u,B(arguments)):te(e)?g(u,O(arguments,e)):g(u,i)},s?I(u,o,t,r):F(u,o,t,r)};return i.__proto__=t,i},xe=function(t,e){return ye.all(t,e)};U.prototype=ie(ce.prototype),U.prototype._superConstructor=ce,U.prototype._makeResult=k,U.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var _e=function(t,e){return new U(ye,t,e).promise},Se=function(t,e){return ye.race(t,e)},Te=Q;Q.prototype=ie(ce.prototype),Q.prototype._superConstructor=ce,Q.prototype._init=function(){this._result={}},Q.prototype._validateInput=function(t){return t&&"object"==typeof t},Q.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},Q.prototype._enumerate=function(){var t=this.promise,e=this._input,i=[];for(var r in e)t._state===oe&&e.hasOwnProperty(r)&&i.push({position:r,entry:e[r]});var n=i.length;this._remaining=n;for(var o,s=0;t._state===oe&&n>s;s++)o=i[s],this._eachEntry(o.entry,o.position)};var Ee=function(t,e){return new Te(ye,t,e).promise};D.prototype=ie(Te.prototype),D.prototype._superConstructor=ce,D.prototype._makeResult=k,D.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var ke,Ce=function(t,e){return new D(ye,t,e).promise},qe=function(t){throw setTimeout(function(){throw t}),t},Ae=function(t){var e={};return e.promise=new ye(function(t,i){e.resolve=t,e.reject=i},t),e},Pe=function(t,e,i){return ye.all(t,i).then(function(t){if(!a(e))throw new TypeError("You must pass a function as map's second argument.");for(var r=t.length,n=new Array(r),o=0;r>o;o++)n[o]=e(t[o]);return ye.all(n,i)})},Re=function(t,e){return ye.resolve(t,e)},Le=function(t,e){return ye.reject(t,e)},Ne=function(t,e,i){return ye.all(t,i).then(function(t){if(!a(e))throw new TypeError("You must pass a function as filter's second argument.");for(var r=t.length,n=new Array(r),o=0;r>o;o++)n[o]=e(t[o]);return ye.all(n,i).then(function(e){for(var i=new Array(r),n=0,o=0;r>o;o++)e[o]&&(i[n]=t[o],n++);return i.length=n,i})})},Oe=0,Be=function(t,e){je[Oe]=t,je[Oe+1]=e,Oe+=2,2===Oe&&ke()},ze="undefined"!=typeof window?window:{},Fe=ze.MutationObserver||ze.WebKitMutationObserver,Ie="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,je=new Array(1e3);ke="undefined"!=typeof e&&"[object process]"==={}.toString.call(e)?H():Fe?M():Ie?W():V(),K.async=Be;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var Ue=window.__PROMISE_INSTRUMENTATION__;o("instrument",!0);for(var Qe in Ue)Ue.hasOwnProperty(Qe)&&J(Qe,Ue[Qe])}var De={race:Se,Promise:ye,allSettled:_e,hash:Ee,hashSettled:Ce,denodeify:we,on:J,off:Z,map:Pe,filter:Ne,resolve:Re,reject:Le,all:xe,rethrow:qe,defer:Ae,EventTarget:Y,configure:o,async:$};"function"==typeof t&&t.amd?t(function(){return De}):"undefined"!=typeof i&&i.exports?i.exports=De:"undefined"!=typeof this&&(this.RSVP=De)}).call(this)}).call(this,e("_process"))},{_process:3}],5:[function(e,i,r){!function(n,o){"use strict";"object"==typeof r?i.exports=o(e("./punycode"),e("./IPv6"),e("./SecondLevelDomains")):"function"==typeof t&&t.amd?t(["./punycode","./IPv6","./SecondLevelDomains"],o):n.URI=o(n.punycode,n.IPv6,n.SecondLevelDomains,n)}(this,function(t,e,i,r){"use strict";function n(t,e){var i=arguments.length>=1,r=arguments.length>=2;if(!(this instanceof n))return i?r?new n(t,e):new n(t):new n;if(void 0===t){if(i)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}return this.href(t),void 0!==e?this.absoluteTo(e):this}function o(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function s(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function a(t){return"Array"===s(t)}function h(t,e){var i,r,n={};if("RegExp"===s(e))n=null;else if(a(e))for(i=0,r=e.length;r>i;i++)n[e[i]]=!0;else n[e]=!0;for(i=0,r=t.length;r>i;i++){var o=n&&void 0!==n[t[i]]||!n&&e.test(t[i]);o&&(t.splice(i,1),r--,i--)}return t}function u(t,e){var i,r;if(a(e)){for(i=0,r=e.length;r>i;i++)if(!u(t,e[i]))return!1;return!0}var n=s(e);for(i=0,r=t.length;r>i;i++)if("RegExp"===n){if("string"==typeof t[i]&&t[i].match(e))return!0}else if(t[i]===e)return!0;return!1}function c(t,e){if(!a(t)||!a(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var i=0,r=t.length;r>i;i++)if(t[i]!==e[i])return!1;return!0}function p(t){var e=/^\/+|\/+$/g;return t.replace(e,"")}function l(t){return escape(t)}function d(t){return encodeURIComponent(t).replace(/[!'()*]/g,l).replace(/\*/g,"%2A")}function f(t){return function(e,i){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!i),this)}}function m(t,e){return function(i,r){return void 0===i?this._parts[t]||"":(null!==i&&(i+="",i.charAt(0)===e&&(i=i.substring(1))),this._parts[t]=i,this.build(!r),this)}}var g=r&&r.URI;n.version="1.17.0";var y=n.prototype,v=Object.prototype.hasOwnProperty;n._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:n.duplicateQueryParameters,escapeQuerySpace:n.escapeQuerySpace}},n.duplicateQueryParameters=!1,n.escapeQuerySpace=!0,n.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,n.idn_expression=/[^a-z0-9\.-]/i,n.punycode_expression=/(xn--)/i,n.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,n.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,n.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,n.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},n.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},n.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,n.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},n.getDomAttribute=function(t){if(!t||!t.nodeName)return void 0;var e=t.nodeName.toLowerCase();return"input"===e&&"image"!==t.type?void 0:n.domAttributes[e]},n.encode=d,n.decode=decodeURIComponent,n.iso8859=function(){n.encode=escape,n.decode=unescape},n.unicode=function(){n.encode=d,n.decode=decodeURIComponent},n.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},n.encodeQuery=function(t,e){var i=n.encode(t+"");return void 0===e&&(e=n.escapeQuerySpace),e?i.replace(/%20/g,"+"):i},n.decodeQuery=function(t,e){t+="",void 0===e&&(e=n.escapeQuerySpace);try{return n.decode(e?t.replace(/\+/g,"%20"):t)}catch(i){return t}};var b,w={encode:"encode",decode:"decode"},x=function(t,e){return function(i){try{return n[e](i+"").replace(n.characters[t][e].expression,function(i){return n.characters[t][e].map[i]})}catch(r){return i}}};for(b in w)n[b+"PathSegment"]=x("pathname",w[b]),n[b+"UrnPathSegment"]=x("urnpath",w[b]);var _=function(t,e,i){return function(r){var o;o=i?function(t){return n[e](n[i](t))}:n[e];for(var s=(r+"").split(t),a=0,h=s.length;h>a;a++)s[a]=o(s[a]);return s.join(t)}};n.decodePath=_("/","decodePathSegment"),n.decodeUrnPath=_(":","decodeUrnPathSegment"),n.recodePath=_("/","encodePathSegment","decode"),n.recodeUrnPath=_(":","encodeUrnPathSegment","decode"),n.encodeReserved=x("reserved","encode"),n.parse=function(t,e){var i;return e||(e={}),i=t.indexOf("#"),i>-1&&(e.fragment=t.substring(i+1)||null,t=t.substring(0,i)),i=t.indexOf("?"),i>-1&&(e.query=t.substring(i+1)||null,t=t.substring(0,i)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=n.parseAuthority(t,e)):(i=t.indexOf(":"),i>-1&&(e.protocol=t.substring(0,i)||null,e.protocol&&!e.protocol.match(n.protocol_expression)?e.protocol=void 0:"//"===t.substring(i+1,i+3)?(t=t.substring(i+3),t=n.parseAuthority(t,e)):(t=t.substring(i+1),e.urn=!0))),e.path=t,e},n.parseHost=function(t,e){t=t.replace(/\\/g,"/");var i,r,n=t.indexOf("/");if(-1===n&&(n=t.length),"["===t.charAt(0))i=t.indexOf("]"),e.hostname=t.substring(1,i)||null,e.port=t.substring(i+2,n)||null,"/"===e.port&&(e.port=null);else{var o=t.indexOf(":"),s=t.indexOf("/"),a=t.indexOf(":",o+1);-1!==a&&(-1===s||s>a)?(e.hostname=t.substring(0,n)||null,e.port=null):(r=t.substring(0,n).split(":"),e.hostname=r[0]||null,e.port=r[1]||null)}return e.hostname&&"/"!==t.substring(n).charAt(0)&&(n++,t="/"+t),t.substring(n)||"/"},n.parseAuthority=function(t,e){return t=n.parseUserinfo(t,e),n.parseHost(t,e)},n.parseUserinfo=function(t,e){var i,r=t.indexOf("/"),o=t.lastIndexOf("@",r>-1?r:t.length-1);return o>-1&&(-1===r||r>o)?(i=t.substring(0,o).split(":"),e.username=i[0]?n.decode(i[0]):null,i.shift(),e.password=i[0]?n.decode(i.join(":")):null,t=t.substring(o+1)):(e.username=null,e.password=null),t},n.parseQuery=function(t,e){if(!t)return{};if(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!t)return{};for(var i,r,o,s={},a=t.split("&"),h=a.length,u=0;h>u;u++)i=a[u].split("="),r=n.decodeQuery(i.shift(),e),o=i.length?n.decodeQuery(i.join("="),e):null,v.call(s,r)?(("string"==typeof s[r]||null===s[r])&&(s[r]=[s[r]]),s[r].push(o)):s[r]=o;return s},n.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=n.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},n.buildHost=function(t){var e="";return t.hostname?(e+=n.ip6_expression.test(t.hostname)?"["+t.hostname+"]":t.hostname,t.port&&(e+=":"+t.port),e):""},n.buildAuthority=function(t){return n.buildUserinfo(t)+n.buildHost(t)},n.buildUserinfo=function(t){var e="";return t.username&&(e+=n.encode(t.username),t.password&&(e+=":"+n.encode(t.password)),e+="@"),e},n.buildQuery=function(t,e,i){var r,o,s,h,u="";for(o in t)if(v.call(t,o)&&o)if(a(t[o]))for(r={},s=0,h=t[o].length;h>s;s++)void 0!==t[o][s]&&void 0===r[t[o][s]+""]&&(u+="&"+n.buildQueryParameter(o,t[o][s],i),e!==!0&&(r[t[o][s]+""]=!0));else void 0!==t[o]&&(u+="&"+n.buildQueryParameter(o,t[o],i));return u.substring(1)},n.buildQueryParameter=function(t,e,i){return n.encodeQuery(t,i)+(null!==e?"="+n.encodeQuery(e,i):"")},n.addQuery=function(t,e,i){if("object"==typeof e)for(var r in e)v.call(e,r)&&n.addQuery(t,r,e[r]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return t[e]=i,void 0;"string"==typeof t[e]&&(t[e]=[t[e]]),a(i)||(i=[i]),t[e]=(t[e]||[]).concat(i)}},n.removeQuery=function(t,e,i){var r,o,u;if(a(e))for(r=0,o=e.length;o>r;r++)t[e[r]]=void 0;else if("RegExp"===s(e))for(u in t)e.test(u)&&(t[u]=void 0);else if("object"==typeof e)for(u in e)v.call(e,u)&&n.removeQuery(t,u,e[u]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==i?"RegExp"===s(i)?t[e]=!a(t[e])&&i.test(t[e])?void 0:h(t[e],i):t[e]!==String(i)||a(i)&&1!==i.length?a(t[e])&&(t[e]=h(t[e],i)):t[e]=void 0:t[e]=void 0}},n.hasQuery=function(t,e,i,r){if("object"==typeof e){for(var o in e)if(v.call(e,o)&&!n.hasQuery(t,o,e[o]))return!1;return!0}if("string"!=typeof e)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(s(i)){case"Undefined":return e in t;case"Boolean":var h=Boolean(a(t[e])?t[e].length:t[e]);return i===h;case"Function":return!!i(t[e],e,t);case"Array":if(!a(t[e]))return!1;var p=r?u:c;return p(t[e],i);case"RegExp":return a(t[e])?r?u(t[e],i):!1:Boolean(t[e]&&t[e].match(i));case"Number":i=String(i);case"String":return a(t[e])?r?u(t[e],i):!1:t[e]===i;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},n.commonPath=function(t,e){var i,r=Math.min(t.length,e.length);for(i=0;r>i;i++)if(t.charAt(i)!==e.charAt(i)){i--;break}return 1>i?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":(("/"!==t.charAt(i)||"/"!==e.charAt(i))&&(i=t.substring(0,i).lastIndexOf("/")),t.substring(0,i+1))},n.withinString=function(t,e,i){i||(i={});var r=i.start||n.findUri.start,o=i.end||n.findUri.end,s=i.trim||n.findUri.trim,a=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){var h=r.exec(t);if(!h)break;var u=h.index;if(i.ignoreHtml){var c=t.slice(Math.max(u-3,0),u);if(c&&a.test(c))continue}var p=u+t.slice(u).search(o),l=t.slice(u,p).replace(s,"");if(!i.ignore||!i.ignore.test(l)){p=u+l.length;var d=e(l,u,p,t);t=t.slice(0,u)+d+t.slice(p),r.lastIndex=u+d.length}}return r.lastIndex=0,t},n.ensureValidHostname=function(e){if(e.match(n.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(t.toASCII(e).match(n.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}},n.noConflict=function(t){if(t){var e={URI:this.noConflict()};return r.URITemplate&&"function"==typeof r.URITemplate.noConflict&&(e.URITemplate=r.URITemplate.noConflict()),r.IPv6&&"function"==typeof r.IPv6.noConflict&&(e.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&"function"==typeof r.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=r.SecondLevelDomains.noConflict()),e}return r.URI===this&&(r.URI=g),this},y.build=function(t){return t===!0?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=n.build(this._parts),this._deferred_build=!1),this},y.clone=function(){return new n(this)},y.valueOf=y.toString=function(){return this.build(!1)._string},y.protocol=f("protocol"),y.username=f("username"),y.password=f("password"),y.hostname=f("hostname"),y.port=f("port"),y.query=m("query","?"),y.fragment=m("fragment","#"),y.search=function(t,e){var i=this.query(t,e);return"string"==typeof i&&i.length?"?"+i:i},y.hash=function(t,e){var i=this.fragment(t,e);return"string"==typeof i&&i.length?"#"+i:i},y.pathname=function(t,e){if(void 0===t||t===!0){var i=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?n.decodeUrnPath:n.decodePath)(i):i}return this._parts.path=this._parts.urn?t?n.recodeUrnPath(t):"":t?n.recodePath(t):"/",this.build(!e),this},y.path=y.pathname,y.href=function(t,e){var i;if(void 0===t)return this.toString();this._string="",this._parts=n._parts();var r=t instanceof n,o="object"==typeof t&&(t.hostname||t.path||t.pathname);if(t.nodeName){var s=n.getDomAttribute(t);t=t[s]||"",o=!1}if(!r&&o&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=n.parse(String(t),this._parts);else{if(!r&&!o)throw new TypeError("invalid input");var a=r?t._parts:t;for(i in a)v.call(this._parts,i)&&(this._parts[i]=a[i])}return this.build(!e),this},y.is=function(t){var e=!1,r=!1,o=!1,s=!1,a=!1,h=!1,u=!1,c=!this._parts.urn;switch(this._parts.hostname&&(c=!1,r=n.ip4_expression.test(this._parts.hostname),o=n.ip6_expression.test(this._parts.hostname),e=r||o,s=!e,a=s&&i&&i.has(this._parts.hostname),h=s&&n.idn_expression.test(this._parts.hostname),u=s&&n.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return c;case"absolute":return!c;case"domain":case"name":return s;case"sld":return a;case"ip":return e;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return o;case"idn":return h;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var S=y.protocol,T=y.port,E=y.hostname;y.protocol=function(t,e){if(void 0!==t&&t&&(t=t.replace(/:(\/\/)?$/,""),!t.match(n.protocol_expression)))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return S.call(this,t,e)},y.scheme=y.protocol,y.port=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(t+="",":"===t.charAt(0)&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError('Port "'+t+'" contains characters other than [0-9]');return T.call(this,t,e)},y.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var i={},r=n.parseHost(t,i);if("/"!==r)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=i.hostname}return E.call(this,t,e)},y.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var i=this.protocol(),r=this.authority();return r?(i?i+"://":"")+this.authority():""}var o=n(t);return this.protocol(o.protocol()).authority(o.authority()).build(!e),this},y.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?n.buildHost(this._parts):"";var i=n.parseHost(t,this._parts);if("/"!==i)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},y.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?n.buildAuthority(this._parts):"";var i=n.parseAuthority(t,this._parts);if("/"!==i)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},y.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.username)return"";var i=n.buildUserinfo(this._parts);return i.substring(0,i.length-1)}return"@"!==t[t.length-1]&&(t+="@"),n.parseUserinfo(t,this._parts),this.build(!e),this},y.resource=function(t,e){var i;return void 0===t?this.path()+this.search()+this.hash():(i=n.parse(t),this._parts.path=i.path,this._parts.query=i.query,this._parts.fragment=i.fragment,this.build(!e),this)
},y.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,i)||""}var r=this._parts.hostname.length-this.domain().length,s=this._parts.hostname.substring(0,r),a=new RegExp("^"+o(s));return t&&"."!==t.charAt(t.length-1)&&(t+="."),t&&n.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(a,t),this.build(!e),this},y.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.match(/\./g);if(i&&i.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(e).length-1;return r=this._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!t)throw new TypeError("cannot set domain empty");if(n.ensureValidHostname(t),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var s=new RegExp(o(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(s,t)}return this.build(!e),this},y.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),n=this._parts.hostname.substring(r+1);return e!==!0&&i&&i.list[n.toLowerCase()]?i.get(this._parts.hostname)||n:n}var s;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!i||!i.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');s=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,t)}return this.build(!e),this},y.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var i=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,i)||(this._parts.hostname?"/":"");return t?n.decodePath(r):r}var s=this._parts.path.length-this.filename().length,a=this._parts.path.substring(0,s),h=new RegExp("^"+o(a));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=n.recodePath(t),this._parts.path=this._parts.path.replace(h,t),this.build(!e),this},y.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var i=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(i+1);return t?n.decodePathSegment(r):r}var s=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(s=!0);var a=new RegExp(o(this.filename())+"$");return t=n.recodePath(t),this._parts.path=this._parts.path.replace(a,t),s?this.normalizePath(e):this.build(!e),this},y.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var i,r,s=this.filename(),a=s.lastIndexOf(".");return-1===a?"":(i=s.substring(a+1),r=/^[a-z0-9%]+$/i.test(i)?i:"",t?n.decodePathSegment(r):r)}"."===t.charAt(0)&&(t=t.substring(1));var h,u=this.suffix();if(u)h=t?new RegExp(o(u)+"$"):new RegExp(o("."+u)+"$");else{if(!t)return this;this._parts.path+="."+n.recodePath(t)}return h&&(t=n.recodePath(t),this._parts.path=this._parts.path.replace(h,t)),this.build(!e),this},y.segment=function(t,e,i){var r=this._parts.urn?":":"/",n=this.path(),o="/"===n.substring(0,1),s=n.split(r);if(void 0!==t&&"number"!=typeof t&&(i=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(o&&s.shift(),0>t&&(t=Math.max(s.length+t,0)),void 0===e)return void 0===t?s:s[t];if(null===t||void 0===s[t])if(a(e)){s=[];for(var h=0,u=e.length;u>h;h++)(e[h].length||s.length&&s[s.length-1].length)&&(s.length&&!s[s.length-1].length&&s.pop(),s.push(p(e[h])))}else(e||"string"==typeof e)&&(e=p(e),""===s[s.length-1]?s[s.length-1]=e:s.push(e));else e?s[t]=p(e):s.splice(t,1);return o&&s.unshift(""),this.path(s.join(r),i)},y.segmentCoded=function(t,e,i){var r,o,s;if("number"!=typeof t&&(i=e,e=t,t=void 0),void 0===e){if(r=this.segment(t,e,i),a(r))for(o=0,s=r.length;s>o;o++)r[o]=n.decode(r[o]);else r=void 0!==r?n.decode(r):void 0;return r}if(a(e))for(o=0,s=e.length;s>o;o++)e[o]=n.encode(e[o]);else e="string"==typeof e||e instanceof String?n.encode(e):e;return this.segment(t,e,i)};var k=y.query;return y.query=function(t,e){if(t===!0)return n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var i=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=t.call(this,i);return this._parts.query=n.buildQuery(r||i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=n.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):k.call(this,t,e)},y.setQuery=function(t,e,i){var r=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)r[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var o in t)v.call(t,o)&&(r[o]=t[o])}return this._parts.query=n.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},y.addQuery=function(t,e,i){var r=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return n.addQuery(r,t,void 0===e?null:e),this._parts.query=n.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},y.removeQuery=function(t,e,i){var r=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return n.removeQuery(r,t,e),this._parts.query=n.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},y.hasQuery=function(t,e,i){var r=n.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return n.hasQuery(r,t,e,i)},y.setSearch=y.setQuery,y.addSearch=y.addQuery,y.removeSearch=y.removeQuery,y.hasSearch=y.hasQuery,y.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},y.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},y.normalizeHostname=function(i){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!i)),this},y.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===n.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},y.normalizePath=function(t){var e=this._parts.path;if(!e)return this;if(this._parts.urn)return this._parts.path=n.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;var i,r,o,s="";for("/"!==e.charAt(0)&&(i=!0,e="/"+e),("/.."===e.slice(-3)||"/."===e.slice(-2))&&(e+="/"),e=e.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),i&&(s=e.substring(1).match(/^(\.\.\/)+/)||"",s&&(s=s[0]));;){if(r=e.indexOf("/.."),-1===r)break;0!==r?(o=e.substring(0,r).lastIndexOf("/"),-1===o&&(o=r),e=e.substring(0,o)+e.substring(r+3)):e=e.substring(3)}return i&&this.is("relative")&&(e=s+e.substring(1)),e=n.recodePath(e),this._parts.path=e,this.build(!t),this},y.normalizePathname=y.normalizePath,y.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(n.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},y.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},y.normalizeSearch=y.normalizeQuery,y.normalizeHash=y.normalizeFragment,y.iso8859=function(){var t=n.encode,e=n.decode;n.encode=escape,n.decode=decodeURIComponent;try{this.normalize()}finally{n.encode=t,n.decode=e}return this},y.unicode=function(){var t=n.encode,e=n.decode;n.encode=d,n.decode=unescape;try{this.normalize()}finally{n.encode=t,n.decode=e}return this},y.readable=function(){var e=this.clone();e.username("").password("").normalize();var i="";if(e._parts.protocol&&(i+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&t?(i+=t.toUnicode(e._parts.hostname),e._parts.port&&(i+=":"+e._parts.port)):i+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path.charAt(0)&&(i+="/"),i+=e.path(!0),e._parts.query){for(var r="",o=0,s=e._parts.query.split("&"),a=s.length;a>o;o++){var h=(s[o]||"").split("=");r+="&"+n.decodeQuery(h[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==h[1]&&(r+="="+n.decodeQuery(h[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}i+="?"+r.substring(1)}return i+=n.decodeQuery(e.hash(),!0)},y.absoluteTo=function(t){var e,i,r,o=this.clone(),s=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof n||(t=new n(t)),o._parts.protocol||(o._parts.protocol=t._parts.protocol),this._parts.hostname)return o;for(i=0;r=s[i];i++)o._parts[r]=t._parts[r];return o._parts.path?".."===o._parts.path.substring(-2)&&(o._parts.path+="/"):(o._parts.path=t._parts.path,o._parts.query||(o._parts.query=t._parts.query)),"/"!==o.path().charAt(0)&&(e=t.directory(),e=e?e:0===t.path().indexOf("/")?"/":"",o._parts.path=(e?e+"/":"")+o._parts.path,o.normalizePath()),o.build(),o},y.relativeTo=function(t){var e,i,r,o,s,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new n(t).normalize(),e=a._parts,i=t._parts,o=a.path(),s=t.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==s.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===i.protocol&&(e.protocol=null),e.username!==i.username||e.password!==i.password)return a.build();if(null!==e.protocol||null!==e.username||null!==e.password)return a.build();if(e.hostname!==i.hostname||e.port!==i.port)return a.build();if(e.hostname=null,e.port=null,o===s)return e.path="",a.build();if(r=n.commonPath(o,s),!r)return a.build();var h=i.path.substring(r.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=h+e.path.substring(r.length)||"./",a.build()},y.equals=function(t){var e,i,r,o=this.clone(),s=new n(t),h={},u={},p={};if(o.normalize(),s.normalize(),o.toString()===s.toString())return!0;if(e=o.query(),i=s.query(),o.query(""),s.query(""),o.toString()!==s.toString())return!1;if(e.length!==i.length)return!1;h=n.parseQuery(e,this._parts.escapeQuerySpace),u=n.parseQuery(i,this._parts.escapeQuerySpace);for(r in h)if(v.call(h,r)){if(a(h[r])){if(!c(h[r],u[r]))return!1}else if(h[r]!==u[r])return!1;p[r]=!0}for(r in u)if(v.call(u,r)&&!p[r])return!1;return!0},y.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},y.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},n})},{"./IPv6":2,"./SecondLevelDomains":2,"./punycode":2}],6:[function(t,e){function i(t){this.opening=new r.defer,this.opened=this.opening.promise,this.isOpen=!1,this.url=void 0,this.loading={manifest:new r.defer,spine:new r.defer,metadata:new r.defer,cover:new r.defer,navigation:new r.defer,pageList:new r.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise},this.ready=r.hash(this.loaded),this.isRendered=!1,this.request=this.requestMethod.bind(this),this.spine=new o(this.request),this.locations=new s(this.spine,this.request),t&&this.open(t)}var r=t("rsvp"),n=t("urijs"),o=(t("./core"),t("./spine")),s=t("./locations"),a=t("./parser"),h=t("./navigation"),u=(t("./rendition"),t("./continuous"),t("./paginate"),t("./unarchive")),c=t("./request");i.prototype.open=function(t){var e,i,r,o=new a,s=this,h="META-INF/container.xml";return t?(e=n(t),this.url=t,"opf"===e.suffix()?(this.packageUrl=t,this.containerUrl="",this.baseUrl=e.origin()?e.origin()+"/"+e.directory()+"/":window?e.absoluteTo(window.location.href).directory()+"/":e.directory()+"/",i=this.request(this.packageUrl)):this.isArchivedUrl(e)?(this.url="/",this.containerUrl=n(h).absoluteTo(this.url).toString(),r=this.unarchive(t).then(function(){return this.request(this.containerUrl)}.bind(this))):e.suffix()||(this.containerUrl=this.url+h,r=this.request(this.containerUrl)),r&&(i=r.then(function(t){return o.container(t)}).then(function(t){var i=n(t.packagePath);return s.packageUrl=i.absoluteTo(s.url).toString(),s.encoding=t.encoding,s.baseUrl=i.origin()?i.origin()+"/"+i.directory()+"/":window&&!s.isArchivedUrl(e)?i.absoluteTo(window.location.href).directory()+"/":"/"+i.directory()+"/",s.request(s.packageUrl)}).catch(function(t){console.error("Could not load book at: "+(this.packageUrl||this.containerPath)),s.trigger("book:loadFailed",this.packageUrl||this.containerPath),s.opening.reject(t)})),i.then(function(t){s.unpack(t),s.loading.manifest.resolve(s.package.manifest),s.loading.metadata.resolve(s.package.metadata),s.loading.spine.resolve(s.spine),s.loading.cover.resolve(s.cover),s.isOpen=!0,s.opening.resolve(s)}).catch(function(t){console.error(t.message,t.stack),s.opening.reject(t)}),this.opened):(this.opening.resolve(this),this.opened)},i.prototype.unpack=function(t){var e=this,i=new a;e.package=i.packageContents(t),e.package.baseUrl=e.baseUrl,this.spine.load(e.package),e.navigation=new h(e.package,this.request),e.navigation.load().then(function(t){e.toc=t,e.loading.navigation.resolve(e.toc)}),e.cover=n(e.package.coverPath).absoluteTo(e.baseUrl).toString()},i.prototype.section=function(t){return this.spine.get(t)},i.prototype.renderTo=function(e,i){var r=i&&i.method?i.method:"rendition",n=t("./"+r);return this.rendition=new n(this,i),this.rendition.attachTo(e),this.rendition},i.prototype.requestMethod=function(t){return this.archive?this.archive.request(t):c(t,null,this.requestCredentials,this.requestHeaders)},i.prototype.setRequestCredentials=function(t){this.requestCredentials=t},i.prototype.setRequestHeaders=function(t){this.requestHeaders=t},i.prototype.unarchive=function(t){return this.archive=new u,this.archive.open(t)},i.prototype.isArchivedUrl=function(t){var e,i;return t instanceof ArrayBuffer?!0:(e=n(t),i=e.suffix(),!i||"epub"!=i&&"zip"!=i?!1:!0)},i.prototype.coverUrl=function(){var t=this.loaded.cover.then(function(){return this.archive?this.archive.createUrl(this.cover):this.cover}.bind(this));return t},e.exports=i,r.EventTarget.mixin(i.prototype),r.on("error",function(t){console.error(t)}),r.configure("instrument",!0),r.on("rejected",function(t){console.error(t.detail.message,t.detail.stack)})},{"./continuous":7,"./core":8,"./locations":12,"./navigation":14,"./paginate":15,"./parser":16,"./rendition":18,"./request":20,"./spine":22,"./unarchive":23,rsvp:4,urijs:5}],7:[function(t,e){function i(t,e){o.apply(this,arguments),this.settings=n.extend(this.settings||{},{infinite:!0,overflow:"auto",axis:"vertical",offset:500,offsetDelta:250}),n.extend(this.settings,e),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}{var r=t("rsvp"),n=t("./core"),o=t("./rendition");t("./view")}i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.attachListeners=function(){n.isNumber(this.settings.width)&&n.isNumber(this.settings.height)||window.addEventListener("resize",this.onResized.bind(this),!1),this.settings.infinite&&this.start()},i.prototype.parseTarget=function(t){this.epubcfi.isCfiString(t)?(cfi=this.epubcfi.parse(t),spinePos=cfi.spinePos,section=this.book.spine.get(spinePos)):section=this.book.spine.get(t)},i.prototype.moveTo=function(t){return this.check(t.left+this.settings.offset,t.top+this.settings.offset).then(function(){"vertical"===this.settings.axis?this.scrollBy(0,t.top):this.scrollBy(t.left,0)}.bind(this))},i.prototype.afterDisplayed=function(t){var e,i,r=t.section.next(),n=t.section.prev(),o=this.views.indexOf(t);o+1===this.views.length&&r&&(i=this.createView(r),this.q.enqueue(this.append,i)),0===o&&n&&(e=this.createView(n,this.viewSettings),this.q.enqueue(this.prepend,e)),this.trigger("added",t.section)},i.prototype.removeShownListeners=function(t){t.onDisplayed=function(){}},i.prototype.append=function(t){return t.onDisplayed=this.afterDisplayed.bind(this),this.views.append(t),this.check()},i.prototype.prepend=function(t){return t.onDisplayed=this.afterDisplayed.bind(this),t.on("resized",this.counter.bind(this)),this.views.prepend(t),this.check()},i.prototype.counter=function(t){"vertical"===this.settings.axis?this.scrollBy(0,t.heightDelta,!0):this.scrollBy(t.widthDelta,0,!0)},i.prototype.check=function(t){var e=new r.defer,i=this.bounds(),n=[],o=t||this.settings.offset;return this.views.each(function(t){var e=this.isVisible(t,o,o,i);e?t.displayed||t.rendering||n.push(this.render(t)):t.displayed&&(this.q.enqueue(t.destroy.bind(t)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim)}.bind(this),250))}.bind(this)),n.length?r.all(n).then(function(){this.q.enqueue(this.check)}.bind(this)):(e.resolve(),e.promise)},i.prototype.trim=function(){for(var t=new r.defer,e=this.views.displayed(),i=e[0],n=e[e.length-1],o=this.views.indexOf(i),s=this.views.indexOf(n),a=this.views.slice(0,o),h=this.views.slice(s+1),u=0;u<a.length-1;u++)this.erase(a[u],a);for(var c=1;c<h.length;c++)this.erase(h[c]);return t.resolve(),t.promise},i.prototype.erase=function(t,e){var i,r;this.settings.height?(i=this.container.scrollTop,r=this.container.scrollLeft):(i=window.scrollY,r=window.scrollX);var n=t.bounds();this.views.remove(t),e&&("vertical"===this.settings.axis?this.scrollTo(0,i-n.height,!0):this.scrollTo(r-n.width,0,!0))},i.prototype.start=function(){var t;this.tick=n.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,t=this.settings.height?this.container:window,window.addEventListener("scroll",function(){this.ignore?this.ignore=!1:this.scrolled=!0}.bind(this)),window.addEventListener("unload",function(){this.ignore=!0,this.destroy()}.bind(this)),this.tick.call(window,this.onScroll.bind(this)),this.scrolled=!1},i.prototype.onScroll=function(){this.scrolled&&(this.settings.height?(scrollTop=this.container.scrollTop,scrollLeft=this.container.scrollLeft):(scrollTop=window.scrollY,scrollLeft=window.scrollX),this.ignore?this.ignore=!1:(0===this.scrollDeltaVert&&0===this.scrollDeltaHorz||this.scrollDeltaVert>this.settings.offsetDelta||this.scrollDeltaHorz>this.settings.offsetDelta)&&(this.q.enqueue(this.check),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.trigger("scroll",{top:scrollTop,left:scrollLeft})),this.scrollDeltaVert+=Math.abs(scrollTop-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(scrollLeft-this.prevScrollLeft),this.prevScrollTop=scrollTop,this.prevScrollLeft=scrollLeft,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.scrolled=!1),this.tick.call(window,this.onScroll.bind(this))},i.prototype.resizeView=function(t){"horizontal"===this.settings.axis?t.lock("height",this.stage.width,this.stage.height):t.lock("width",this.stage.width,this.stage.height)},i.prototype.currentLocation=function(){{var t,e,i=this.visible();this.container.getBoundingClientRect()}return 1===i.length?this.map.page(i[0]):i.length>1?(t=this.map.page(i[0]),e=this.map.page(i[i.length-1]),{start:t.start,end:e.end}):void 0},e.exports=i},{"./core":8,"./rendition":18,"./view":24,rsvp:4}],8:[function(t,e){function i(t){return!(!t||1!=t.nodeType)}function r(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:7&i|8).toString(16)});return e}function n(t){for(var e=-1,i=Object.keys(t),r=i.length,n=Array(r);++e<r;)n[e]=t[i[e]];return n}function o(t,e){var i,r=[],n=[],o=uri(t),s=uri(e),a=o.directory,h=s.directory,u=[];return"/"===a[0]&&(a=a.substring(1)),"/"===h[h.length-1]&&(a=a.substring(0,a.length-1)),"/"===h[0]&&(h=h.substring(1)),"/"===h[h.length-1]&&(h=h.substring(0,h.length-1)),a&&(u=a.split("/")),i=h.split("/"),i.reverse().forEach(function(t){".."===t?u.pop():t===u[u.length-1]?(u.pop(),n.unshift(t)):n.unshift(t)}),r=[o.origin],u.length&&(r=r.concat(u)),n&&(r=r.concat(n)),r=r.concat(s.filename),r.join("/")}function s(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function a(t){return!isNaN(parseFloat(t))&&isFinite(t)}function h(t){var e=["Webkit","Moz","O","ms"],i=t[0].toUpperCase()+t.slice(1),r=e.length;if("undefined"!=typeof document.body.style[t])return t;for(var n=0;r>n;n++)if("undefined"!=typeof document.body.style[e[n]+i])return e[n]+i;return t}function u(t){for(var e=1,i=arguments.length;i>e;e++){var r=arguments[e];for(var n in r)void 0===t[n]&&(t[n]=r[n])}return t}function c(t){var e=[].slice.call(arguments,1);return e.forEach(function(e){e&&Object.getOwnPropertyNames(e).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}),t}function p(t,e,i){var r=l(t,e,i);return e.splice(r,0,t),r}function l(t,e,i,r,n){var o,s=r||0,a=n||e.length,h=parseInt(s+(a-s)/2);return i||(i=function(t,e){return t>e?1:e>t?-1:(t=e)?0:void 0}),0>=a-s?h:(o=i(e[h],t),a-s===1?o>0?h:h+1:0===o?h:-1===o?l(t,e,i,h,a):l(t,e,i,s,h))}function d(t,e,i,r,n){var o,s=r||0,a=n||e.length,h=parseInt(s+(a-s)/2);return i||(i=function(t,e){return t>e?1:e>t?-1:(t=e)?0:void 0}),0>=a-s?-1:(o=i(e[h],t),a-s===1?0===o?h:-1:0===o?h:-1===o?d(t,e,i,h,a):d(t,e,i,s,h))}function f(t){var e=window.getComputedStyle(t),i=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],r=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],n=0,o=0;return i.forEach(function(t){n+=parseFloat(e[t])||0}),r.forEach(function(t){o+=parseFloat(e[t])||0}),{height:o,width:n}}function m(t){var e=window.getComputedStyle(t),i=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],r=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],n=0,o=0;return i.forEach(function(t){n+=parseFloat(e[t])||0}),r.forEach(function(t){o+=parseFloat(e[t])||0}),{height:o,width:n}}function g(){var t=window.innerWidth,e=window.innerHeight;return{top:0,left:0,right:t,bottom:e,width:t,height:e}}function y(t){var e=t.match(/[^'"]+|['"]/g);return e=e.map(function(t){return"'"===t?'"\'"':'"'===t?"'\"'":"'"+t+"'"}),"concat('',"+e.join(",")+")"}function v(t){for(var e,i=t.parentNode,r=i.childNodes,n=-1,o=0;o<r.length&&(e=r[o],e.nodeType===Node.TEXT_NODE&&n++,e!=t);o++);return n}function b(t){return["xml","opf","ncx"].indexOf(t)>-1}function w(t,e){var i,r=window.URL||window.webkitURL||window.mozURL,n=new Blob([t],{type:e});return i=r.createObjectURL(n)}var x=(t("rsvp"),window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame);e.exports={isElement:i,uuid:r,values:n,resolveUrl:o,indexOfSorted:d,documentHeight:s,isNumber:a,prefixed:h,defaults:u,extend:c,insert:p,locationOf:l,indexOfSorted:d,requestAnimationFrame:x,bounds:f,borders:m,windowBounds:g,cleanStringForXpath:y,indexOfTextNode:v,isXml:b,createBlobUrl:w}},{rsvp:4}],9:[function(t,e){function i(t){return t?this.parse(t):void 0}var r=t("urijs"),n=t("./core");i.prototype.generateChapterComponent=function(t,e,i){var r=parseInt(e),n=t+1,o="/"+n+"/";return o+=2*(r+1),i&&(o+="["+i+"]"),o},i.prototype.generatePathComponent=function(t){var e=[];return t.forEach(function(t){var i="";i+=2*(t.index+1),t.id&&(i+="["+t.id+"]"),e.push(i)}),e.join("/")},i.prototype.generateCfiFromElement=function(t,e){var i=this.pathTo(t),r=this.generatePathComponent(i);return r.length?"epubcfi("+e+"!"+r+"/1:0)":"epubcfi("+e+"!/4/)"},i.prototype.pathTo=function(t){for(var e,i=[];t&&null!==t.parentNode&&9!=t.parentNode.nodeType;)e=t.parentNode.children,i.unshift({id:t.id,tagName:t.tagName,index:e?Array.prototype.indexOf.call(e,t):0}),t=t.parentNode;return i},i.prototype.getChapterComponent=function(t){var e=t.split("!");return e[0]},i.prototype.getPathComponent=function(t){var e=t.split("!"),i=e[1]?e[1].split(":"):"";return i[0]},i.prototype.getCharecterOffsetComponent=function(t){var e=t.split(":");return e[1]||""},i.prototype.parse=function(t){var e,i,r,n,o,s,a,h,u,c={},p=function(t){var e,i,r,n;return e="element",i=parseInt(t)/2-1,r=t.match(/\[(.*)\]/),r&&r[1]&&(n=r[1]),{type:e,index:i,id:n||!1}};return"string"!=typeof t?{spinePos:-1}:(c.str=t,0===t.indexOf("epubcfi(")&&")"===t[t.length-1]&&(t=t.slice(8,t.length-1)),i=this.getChapterComponent(t),r=this.getPathComponent(t)||"",n=this.getCharecterOffsetComponent(t),i?(e=i.split("/")[2]||"")?(c.spinePos=parseInt(e)/2-1||0,s=e.match(/\[(.*)\]/),c.spineId=s?s[1]:!1,-1!=r.indexOf(",")&&console.warn("CFI Ranges are not supported"),a=r.split("/"),h=a.pop(),c.steps=[],a.forEach(function(t){var e;t&&(e=p(t),c.steps.push(e))}),u=parseInt(h),isNaN(u)||(u%2===0?c.steps.push(p(h)):c.steps.push({type:"text",index:(u-1)/2})),o=n.match(/\[(.*)\]/),o&&o[1]?(c.characterOffset=parseInt(n.split("[")[0]),c.textLocationAssertion=o[1]):c.characterOffset=parseInt(n),c):{spinePos:-1}:{spinePos:-1})},i.prototype.addMarker=function(t,e,i){var r,n,o,s,a=e||document,h=i||this.createMarker(a);return"string"==typeof t&&(t=this.parse(t)),n=t.steps[t.steps.length-1],-1===t.spinePos?!1:(r=this.findParent(t,a))?(n&&"text"===n.type?(o=r.childNodes[n.index],t.characterOffset?(s=o.splitText(t.characterOffset),h.classList.add("EPUBJS-CFI-SPLIT"),r.insertBefore(h,s)):r.insertBefore(h,o)):r.insertBefore(h,r.firstChild),h):!1},i.prototype.createMarker=function(t){var e=t||document,i=e.createElement("span");return i.id="EPUBJS-CFI-MARKER:"+n.uuid(),i.classList.add("EPUBJS-CFI-MARKER"),i},i.prototype.removeMarker=function(t,e){t.classList.contains("EPUBJS-CFI-SPLIT")?(nextSib=t.nextSibling,prevSib=t.previousSibling,nextSib&&prevSib&&3===nextSib.nodeType&&3===prevSib.nodeType&&(prevSib.textContent+=nextSib.textContent,t.parentNode.removeChild(nextSib)),t.parentNode.removeChild(t)):t.classList.contains("EPUBJS-CFI-MARKER")&&t.parentNode.removeChild(t)},i.prototype.findParent=function(t,e){var i,r,n,o=e||document,s=o.getElementsByTagName("html")[0],a=Array.prototype.slice.call(s.children);if("string"==typeof t&&(t=this.parse(t)),r=t.steps.slice(0),!r.length)return o.getElementsByTagName("body")[0];for(;r&&r.length>0;){if(i=r.shift(),"text"===i.type?(n=s.childNodes[i.index],s=n.parentNode||s):s=i.id?o.getElementById(i.id):a[i.index],"undefined"==typeof s)return console.error("No Element For",i,t.str),!1;a=Array.prototype.slice.call(s.children)}return s},i.prototype.compare=function(t,e){if("string"==typeof t&&(t=new i(t)),"string"==typeof e&&(e=new i(e)),t.spinePos>e.spinePos)return 1;if(t.spinePos<e.spinePos)return-1;for(var r=0;r<t.steps.length;r++){if(!e.steps[r])return 1;if(t.steps[r].index>e.steps[r].index)return 1;if(t.steps[r].index<e.steps[r].index)return-1}return t.steps.length<e.steps.length?-1:t.characterOffset>e.characterOffset?1:t.characterOffset<e.characterOffset?-1:0},i.prototype.generateCfiFromHref=function(t,e){var n,o,s=r(t),a=s.path(),h=s.fragment(),u=e.spineIndexByURL[a],c=new RSVP.defer,p=new i;return"undefined"!=typeof u&&(o=e.spine[u],n=e.loadXml(o.url),n.then(function(t){var e,i=t.getElementById(h);e=p.generateCfiFromElement(i,o.cfiBase),c.resolve(e)})),c.promise},i.prototype.generateCfiFromTextNode=function(t,e,i){var r=t.parentNode,n=this.pathTo(r),o=this.generatePathComponent(n),s=1+2*Array.prototype.indexOf.call(r.childNodes,t);return"epubcfi("+i+"!"+o+"/"+s+":"+(e||0)+")"},i.prototype.generateCfiFromRangeAnchor=function(t,e){var i=t.anchorNode,r=t.anchorOffset;return this.generateCfiFromTextNode(i,r,e)},i.prototype.generateCfiFromRange=function(t,e){var i,r,o,s,a,h,u,c,p,l,d,f;if(i=t.startContainer,3===i.nodeType)r=i.parentNode,h=1+2*n.indexOfTextNode(i),o=this.pathTo(r);else{if(t.collapsed)return this.generateCfiFromElement(i,e);o=this.pathTo(i)}return s=this.generatePathComponent(o),a=t.startOffset,t.collapsed?"epubcfi("+e+"!"+s+"/"+h+":"+a+")":(u=t.endContainer,3===u.nodeType?(c=u.parentNode,f=1+2*n.indexOfTextNode(u),p=this.pathTo(c)):p=this.pathTo(u),l=this.generatePathComponent(p),d=t.endOffset,l=l.replace(s,""),l.length&&(l+="/"),"epubcfi("+e+"!"+s+"/"+h+":"+a+","+l+f+":"+d+")")},i.prototype.generateXpathFromSteps=function(t){var e=[".","*"];return t.forEach(function(t){var i=t.index+1;t.id?e.push("*[position()="+i+" and @id='"+t.id+"']"):"text"===t.type?e.push("text()["+i+"]"):e.push("*["+i+"]")}),e.join("/")},i.prototype.generateQueryFromSteps=function(t){var e=["html"];return t.forEach(function(t){var i=t.index+1;t.id?e.push("#"+t.id):"text"===t.type||e.push("*:nth-child("+i+")")}),e.join(">")},i.prototype.generateRangeFromCfi=function(t,e){var i,r,n,o,s,a,h=e||document,u=h.createRange();return"string"==typeof t&&(t=this.parse(t)),-1===t.spinePos?!1:(i=t.steps[t.steps.length-1],"undefined"!=typeof document.evaluate?(r=this.generateXpathFromSteps(t.steps),n=h.evaluate(r,h,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):(s=this.generateQueryFromSteps(t.steps),a=h.querySelector(s),a&&"text"==i.type&&(n=a.childNodes[i.index])),n?(n&&t.characterOffset>=0?(o=n.length,t.characterOffset<o?(u.setStart(n,t.characterOffset),u.setEnd(n,o)):(console.debug("offset greater than length:",t.characterOffset,o),u.setStart(n,o-1),u.setEnd(n,o))):n&&u.selectNode(n),u):null)},i.prototype.isCfiString=function(t){return"string"==typeof t&&0===t.indexOf("epubcfi(")?!0:!1},e.exports=i},{"./core":8,urijs:5}],10:[function(t,e){function i(t){this.context=t||this,this.hooks=[]}var r=t("rsvp");i.prototype.register=function(){for(var t=0;t<arguments.length;++t)if("function"==typeof arguments[t])this.hooks.push(arguments[t]);else for(var e=0;e<arguments[t].length;++e)this.hooks.push(arguments[t][e])},i.prototype.trigger=function(){var t=arguments,e=this.context,i=[];return this.hooks.forEach(function(r){var n=r.apply(e,t);n&&"function"==typeof n.then&&i.push(n)}),r.all(i)},i.prototype.list=function(){return this.hooks},e.exports=i},{rsvp:4}],11:[function(t,e){function i(){}function r(){}function n(){}var o=t("./core");i.prototype.calculate=function(t,e,i,r){var n,s,a,h=r||1,u=Math.floor(t),c=u%2===0?u:u-1,p=Math.floor(c/8),l=i>=0?i:p%2===0?p:p-1;n=h>1?Math.floor((c-l)/h):c,s=n*h,a=(n+l)*h,this.columnAxis=o.prefixed("columnAxis"),this.columnGap=o.prefixed("columnGap"),this.columnWidth=o.prefixed("columnWidth"),this.columnFill=o.prefixed("columnFill"),this.width=c,this.height=e,this.spread=s,this.delta=a,this.column=n,this.gap=l,this.divisor=h},i.prototype.format=function(t){var e=t.document.documentElement,i=t.document.body;e.style.overflow="hidden",e.style.width=this.width+"px",i.style.height=this.height+"px",i.style[this.columnAxis]="horizontal",i.style[this.columnFill]="auto",i.style[this.columnGap]=this.gap+"px",i.style[this.columnWidth]=this.column+"px",t.iframe.style.marginRight=this.gap+"px"
},i.prototype.count=function(t){var e=t.root().scrollWidth,i=Math.ceil(e/this.spread);return{spreads:i,pages:i*this.divisor}},r.prototype.calculate=function(){},r.prototype.format=function(t){var e,i,r=t.document.documentElement,n=documentElement.querySelector("[name=viewport");n&&n.hasAttribute("content")&&(content=n.getAttribute("content"),contents=content.split(","),contents[0]&&(e=contents[0].replace("width=","")),contents[1]&&(i=contents[1].replace("height=",""))),t.resize(e,i),r.style.overflow="auto"},r.prototype.count=function(){return{spreads:1,pages:1}},n.prototype.calculate=function(t){this.spread=t,this.column=t,this.gap=0},n.prototype.format=function(t){var e=t.document.documentElement;e.style.width="auto",e.style.height="auto"},n.prototype.count=function(){return{spreads:1,pages:1}},e.exports={Reflowable:i,Fixed:r,Scroll:n}},{"./core":8}],12:[function(t,e){function i(t,e){this.spine=t,this.request=e,this.q=new n(this),this.epubcfi=new o,this._locations=[],this.total=0,this.break=150,this._current=0}var r=t("./core"),n=t("./queue"),o=t("./epubcfi"),s=t("rsvp");i.prototype.generate=function(t){return t&&(this.break=t),this.q.pause(),this.spine.each(function(t){this.q.enqueue(this.process,t)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))},i.prototype.process=function(t){return t.load(this.request).then(function(e){var i,r=e.ownerDocument,n=0;this.sprint(e,function(e){var o,s=e.length,a=0;for(0==n&&(i=r.createRange(),i.setStart(e,0)),o=this.break-n,o>s&&(n+=s,a=s);s>a;)n=this.break,a+=this.break,a>=s?n=s-(a-this.break):(i.setEnd(e,a),cfi=t.cfiFromRange(i),this._locations.push(cfi),n=0,a+=1,i=r.createRange(),i.setStart(e,a))}.bind(this)),i&&(i.setEnd(prev,prev.length),cfi=t.cfiFromRange(i),this._locations.push(cfi),n=0)}.bind(this))},i.prototype.sprint=function(t,e){for(var i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);node=i.nextNode();)e(node)},i.prototype.locationFromCfi=function(t){return 0===this._locations.length?-1:r.locationOf(t,this._locations,this.epubcfi.compare)},i.prototype.precentageFromCfi=function(t){var e=this.locationFromCfi(t);return this.precentageFromLocation(e)},i.prototype.percentageFromLocation=function(t){return t&&this.total?t/this.total:0},i.prototype.cfiFromLocation=function(t){var e=-1;return"number"!=typeof t&&(t=parseInt(pg)),t>=0&&t<this._locations.length&&(e=this._locations[t]),e},i.prototype.cfiFromPercentage=function(t){var e=t>1?t/100:t,i=Math.ceil(this.total*e);return this.cfiFromLocation(i)},i.prototype.load=function(t){return this._locations=JSON.parse(t),this.total=this._locations.length-1,this._locations},i.prototype.save=function(){return JSON.stringify(this._locations)},i.prototype.getCurrent=function(){return this._current},i.prototype.setCurrent=function(t){var e;if("string"==typeof t)this._currentCfi=t;else{if("number"!=typeof t)return;this._current=t}0!==this._locations.length&&("string"==typeof t?(e=this.locationFromCfi(t),this._current=e):e=t,this.trigger("changed",{percentage:this.precentageFromLocation(e)}))},Object.defineProperty(i.prototype,"currentLocation",{get:function(){return this._current},set:function(t){this.setCurrent(t)}}),s.EventTarget.mixin(i.prototype),e.exports=i},{"./core":8,"./epubcfi":9,"./queue":17,rsvp:4}],13:[function(t,e){function i(t){this.layout=t}i.prototype.section=function(t){var e=this.findRanges(t),i=this.rangeListToCfiList(t,e);return i},i.prototype.page=function(t,e,i){var r=t.document.body;return this.rangePairToCfiPair(t.section,{start:this.findStart(r,e,i),end:this.findEnd(r,e,i)})},i.prototype.walk=function(t,e){for(var i,r,n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return t.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);(i=n.nextNode())&&!(r=e(i)););return r},i.prototype.findRanges=function(t){for(var e,i,r=[],n=this.layout.count(t),o=this.layout.column,s=this.layout.gap,a=0;a<n.pages;a++)e=(o+s)*a,i=o*(a+1)+s*a,r.push({start:this.findStart(t.document.body,e,i),end:this.findEnd(t.document.body,e,i)});return r},i.prototype.findStart=function(t,e,i){for(var r,n,o=[t],s=t;o.length;)if(r=o.shift(),n=this.walk(r,function(t){var r,n,a,h;return t.nodeType==Node.TEXT_NODE?(h=document.createRange(),h.selectNodeContents(t),a=h.getBoundingClientRect()):a=t.getBoundingClientRect(),r=a.left,n=a.right,r>=e&&i>=r?t:n>e?t:(s=t,o.push(t),void 0)}))return this.findTextStartRange(n,e,i);return this.findTextStartRange(s,e,i)},i.prototype.findEnd=function(t,e,i){for(var r,n,o=[t],s=t;o.length;)if(r=o.shift(),n=this.walk(r,function(t){var e,r,n,a;return t.nodeType==Node.TEXT_NODE?(a=document.createRange(),a.selectNodeContents(t),n=a.getBoundingClientRect()):n=t.getBoundingClientRect(),e=n.left,r=n.right,e>i&&s?s:r>i?t:(s=t,o.push(t),void 0)}))return this.findTextEndRange(n,e,i);return this.findTextEndRange(s,e,i)},i.prototype.findTextStartRange=function(t,e){for(var i,r,n,o=this.splitTextNodeIntoRanges(t),s=0;s<o.length;s++){if(r=o[s],n=r.getBoundingClientRect(),n.left>=e)return r;i=r}return o[0]},i.prototype.findTextEndRange=function(t,e,i){for(var r,n,o,s=this.splitTextNodeIntoRanges(t),a=0;a<s.length;a++){if(n=s[a],o=n.getBoundingClientRect(),o.left>i&&r)return r;if(o.right>i)return n;r=n}return s[s.length-1]},i.prototype.splitTextNodeIntoRanges=function(t,e){var i,r=[],n=t.textContent||"",o=n.trim(),s=t.ownerDocument,a=e||" ";if(pos=o.indexOf(a),-1===pos||t.nodeType!=Node.TEXT_NODE)return i=s.createRange(),i.selectNodeContents(t),[i];for(i=s.createRange(),i.setStart(t,0),i.setEnd(t,pos),r.push(i),i=!1;-1!=pos;)pos=o.indexOf(a,pos+1),pos>0&&(i&&(i.setEnd(t,pos),r.push(i)),i=s.createRange(),i.setStart(t,pos+1));return i&&(i.setEnd(t,o.length),r.push(i)),r},i.prototype.rangePairToCfiPair=function(t,e){var i=e.start,r=e.end;return i.collapse(!0),r.collapse(!0),startCfi=t.cfiFromRange(i),endCfi=t.cfiFromRange(r),{start:startCfi,end:endCfi}},i.prototype.rangeListToCfiList=function(t,e){for(var i,r=[],n=0;n<e.length;n++)i=this.rangePairToCfiPair(t.section,e[n]),r.push(i);return r},e.exports=i},{}],14:[function(t,e){function i(e,i){var s=this,a=new r,h=i||t("./request");this.package=e,this.toc=[],this.tocByHref={},this.tocById={},e.navPath&&(this.navUrl=o(e.navPath).absoluteTo(e.baseUrl).toString(),this.nav={},this.nav.load=function(){var t=new n.defer,e=t.promise;return h(s.navUrl,"xml").then(function(e){s.toc=a.nav(e),s.loaded(s.toc),t.resolve(s.toc)}),e}),e.ncxPath&&(this.ncxUrl=o(e.ncxPath).absoluteTo(e.baseUrl).toString(),this.ncx={},this.ncx.load=function(){var t=new n.defer,e=t.promise;return h(s.ncxUrl,"xml").then(function(e){s.toc=a.ncx(e),s.loaded(s.toc),t.resolve(s.toc)}),e})}var r=(t("./core"),t("./parser")),n=t("rsvp"),o=t("urijs");i.prototype.load=function(e){{var i,r;e||t("./request")}return this.nav?i=this.nav.load():this.ncx?i=this.ncx.load():(r=new n.defer,r.resolve([]),i=r.promise),i},i.prototype.loaded=function(t){for(var e,i=0;i<t.length;i++)e=t[i],this.tocByHref[e.href]=i,this.tocById[e.id]=i},i.prototype.get=function(t){var e;return t?(0===t.indexOf("#")?e=this.tocById[t.substring(1)]:t in this.tocByHref&&(e=this.tocByHref[t]),this.toc[e]):this.toc},e.exports=i},{"./core":8,"./parser":16,"./request":20,rsvp:4,urijs:5}],15:[function(t,e){function i(t,e){o.apply(this,arguments),this.settings=n.extend(this.settings||{},{width:600,height:400,axis:"horizontal",forceSingle:!1,minSpreadWidth:800,gap:"auto",overflow:"hidden",infinite:!1}),n.extend(this.settings,e),this.isForcedSingle=this.settings.forceSingle,this.viewSettings={axis:this.settings.axis},this.start()}var r=t("rsvp"),n=t("./core"),o=t("./continuous"),s=t("./map"),a=t("./layout");i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.determineSpreads=function(t){return this.isForcedSingle||!t||this.bounds().width<t?1:2},i.prototype.forceSingle=function(t){this.isForcedSingle=t===!1?!1:!0,this.applyLayoutMethod()},i.prototype.start=function(){this.on("displayed",this.reportLocation.bind(this)),this.currentPage=0,window.addEventListener("unload",function(){this.ignore=!0,this.destroy()}.bind(this))},i.prototype.applyLayoutMethod=function(){this.layout=new a.Reflowable,this.updateLayout(),this.map=new s(this.layout)},i.prototype.updateLayout=function(){this.spreads=this.determineSpreads(this.settings.minSpreadWidth),this.layout.calculate(this.stage.width,this.stage.height,this.settings.gap,this.spreads),this.settings.offset=this.layout.delta},i.prototype.moveTo=function(t){var e=Math.floor(t.left/this.layout.delta)*this.layout.delta;return this.check(0,e+this.settings.offset).then(function(){this.scrollBy(e,0)}.bind(this))},i.prototype.page=function(){},i.prototype.next=function(){return this.q.enqueue(function(){return this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<this.container.scrollWidth?this.scrollBy(this.layout.delta,0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0),this.reportLocation(),this.check()})},i.prototype.prev=function(){return this.q.enqueue(function(){return this.scrollBy(-this.layout.delta,0),this.reportLocation(),this.check()})},i.prototype.currentLocation=function(){var t,e,i,r,n,o,s=this.visible(),a=this.container.getBoundingClientRect();return 1===s.length?(t=a.left-s[0].position().left,i=t+this.layout.spread,this.map.page(s[0],t,i)):s.length>1?(t=a.left-s[0].position().left,i=t+this.layout.column,e=a.left+this.layout.spread-s[s.length-1].position().left,r=e+this.layout.column,n=this.map.page(s[0],t,i),o=this.map.page(s[s.length-1],e,r),{start:n.start,end:o.end}):void 0},i.prototype.resize=function(t,e){this.q.clear(),this.stageSize(t,e),this.updateLayout(),this.location&&this.display(this.location.start),this.trigger("resized",{width:this.stage.width,height:this.stage.height})},i.prototype.onResized=function(){this.views.clear(),clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)},i.prototype.adjustImages=function(t){return t.addStylesheetRules([["img",["max-width",this.layout.spread+"px"],["max-height",this.layout.height+"px"]]]),new r.Promise(function(t){setTimeout(function(){t()},1)})},e.exports=i},{"./continuous":7,"./core":8,"./layout":11,"./map":13,rsvp:4}],16:[function(t,e){function i(){}var r=t("urijs"),n=(t("./core"),t("./epubcfi"));i.prototype.container=function(t){var e,i,n,o;return t?(e=t.querySelector("rootfile"))?(i=e.getAttribute("full-path"),n=r(i).directory(),o=t.xmlEncoding,{packagePath:i,basePath:n,encoding:o}):(console.error("No RootFile Found"),void 0):(console.error("Container File Not Found"),void 0)},i.prototype.identifier=function(t){var e;return t?(e=t.querySelector("metadata"),e?this.getElementText(e,"identifier"):(console.error("No Metadata Found"),void 0)):(console.error("Package File Not Found"),void 0)},i.prototype.packageContents=function(t){var e,i,r,n,o,s,a,h,u,c,p=this;return t?(e=t.querySelector("metadata"))?(i=t.querySelector("manifest"))?(r=t.querySelector("spine"))?(n=p.manifest(i),o=p.findNavPath(i),s=p.findNcxPath(i,r),a=p.findCoverPath(t),h=Array.prototype.indexOf.call(r.parentNode.childNodes,r),u=p.spine(r,n),c=p.metadata(e),c.direction=r.getAttribute("page-progression-direction"),{metadata:c,spine:u,manifest:n,navPath:o,ncxPath:s,coverPath:a,spineNodeIndex:h}):(console.error("No Spine Found"),void 0):(console.error("No Manifest Found"),void 0):(console.error("No Metadata Found"),void 0):(console.error("Package File Not Found"),void 0)},i.prototype.findNavPath=function(t){var e=t.querySelector("item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']");return e?e.getAttribute("href"):!1},i.prototype.findNcxPath=function(t,e){var i,r=t.querySelector("item[media-type='application/x-dtbncx+xml']");return r||(i=e.getAttribute("toc"),i&&(r=t.querySelector("item[id='"+i+"']"))),r?r.getAttribute("href"):!1},i.prototype.metadata=function(t){var e={},i=this;return e.title=i.getElementText(t,"title"),e.creator=i.getElementText(t,"creator"),e.description=i.getElementText(t,"description"),e.pubdate=i.getElementText(t,"date"),e.publisher=i.getElementText(t,"publisher"),e.identifier=i.getElementText(t,"identifier"),e.language=i.getElementText(t,"language"),e.rights=i.getElementText(t,"rights"),e.modified_date=i.querySelectorText(t,"meta[property='dcterms:modified']"),e.layout=i.querySelectorText(t,"meta[property='rendition:layout']"),e.orientation=i.querySelectorText(t,"meta[property='rendition:orientation']"),e.spread=i.querySelectorText(t,"meta[property='rendition:spread']"),e},i.prototype.findCoverPath=function(t){var e=t.querySelector("package").getAttribute("version");if("2.0"===e){var i=t.querySelector('meta[name="cover"]');if(i){var r=i.getAttribute("content"),n=t.querySelector("item[id='"+r+"']");return n?n.getAttribute("href"):!1}return!1}var o=t.querySelector("item[properties='cover-image']");return o?o.getAttribute("href"):!1},i.prototype.getElementText=function(t,e){var i,r=t.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",e);return r&&0!==r.length?(i=r[0],i.childNodes.length?i.childNodes[0].nodeValue:""):""},i.prototype.querySelectorText=function(t,e){var i=t.querySelector(e);return i&&i.childNodes.length?i.childNodes[0].nodeValue:""},i.prototype.manifest=function(t){var e={},i=t.querySelectorAll("item"),r=Array.prototype.slice.call(i);return r.forEach(function(t){var i=t.getAttribute("id"),r=t.getAttribute("href")||"",n=t.getAttribute("media-type")||"",o=t.getAttribute("properties")||"";e[i]={href:r,type:n,properties:o.length?o.split(" "):[]}}),e},i.prototype.spine=function(t){{var e=[],i=t.getElementsByTagName("itemref"),r=Array.prototype.slice.call(i);new n}return r.forEach(function(t,i){var r=t.getAttribute("idref"),n=t.getAttribute("properties")||"",o=n.length?n.split(" "):[],s={idref:r,linear:t.getAttribute("linear")||"",properties:o,index:i};e.push(s)}),e},i.prototype.querySelectorByType=function(t,e,i){var r=t.querySelector(e+'[*|type="'+i+'"]');if(null!==r&&0!==r.length)return r;r=t.querySelectorAll(e);for(var n=0;n<r.length;n++)if(r[n].getAttributeNS("http://www.idpf.org/2007/ops","type")===i)return r[n]},i.prototype.nav=function(t,e,i){var r,n,o,s=this.querySelectorByType(t,"nav","toc"),a=s?s.querySelectorAll("ol li"):[],h=a.length,u={},c=[];if(!a||0===h)return c;for(r=0;h>r;++r)n=this.navItem(a[r],e,i),u[n.id]=n,n.parent?(o=u[n.parent],o.subitems.push(n)):c.push(n);return c},i.prototype.navItem=function(t){var e,i=t.getAttribute("id")||!1,r=t.querySelector("a, span"),n=r.getAttribute("href")||"",o=r.textContent||"",s=[],a=t.parentNode;return a&&"navPoint"===a.nodeName&&(e=a.getAttribute("id")),{id:i,href:n,label:o,subitems:s,parent:e}},i.prototype.toc=function(t,e,i){var r,n,o,s=t.querySelectorAll("navMap navPoint"),a=s.length,h={},u=[];if(!s||0===a)return u;for(r=0;a>r;++r)n=this.tocItem(s[r],e,i),h[n.id]=n,n.parent?(o=h[n.parent],o.subitems.push(n)):u.push(n);return u},i.prototype.tocItem=function(t){var e,i=t.getAttribute("id")||!1,r=t.querySelector("content"),n=r.getAttribute("src"),o=t.querySelector("navLabel"),s=o.textContent?o.textContent:"",a=[],h=t.parentNode;return h&&"navPoint"===h.nodeName&&(e=h.getAttribute("id")),{id:i,href:n,label:s,subitems:a,parent:e}},i.prototype.pageList=function(t,e,i){var r,n,o=this.querySelectorByType(t,"nav","page-list"),s=o?o.querySelectorAll("ol li"):[],a=s.length,h=[];if(!s||0===a)return h;for(r=0;a>r;++r)n=this.pageListItem(s[r],e,i),h.push(n);return h},i.prototype.pageListItem=function(t){var e,i,r,n=(t.getAttribute("id")||!1,t.querySelector("a")),o=n.getAttribute("href")||"",s=n.textContent||"",a=parseInt(s),h=o.indexOf("epubcfi");return-1!=h?(e=o.split("#"),i=e[0],r=e.length>1?e[1]:!1,{cfi:r,href:o,packageUrl:i,page:a}):{href:o,page:a}},e.exports=i},{"./core":8,"./epubcfi":9,urijs:5}],17:[function(t,e){function i(t){this._q=[],this.context=t,this.tick=n.requestAnimationFrame,this.running=!1,this.paused=!1}var r=t("rsvp"),n=t("./core");i.prototype.enqueue=function(){var t,e,i,n=[].shift.call(arguments),o=arguments;return n?("function"==typeof n?(t=new r.defer,e=t.promise,i={task:n,args:o,deferred:t,promise:e}):i={promise:n},this._q.push(i),0!=this.paused||this.running||this.run(),i.promise):console.error("No Task Provided")},i.prototype.dequeue=function(){var t,e,i;return this._q.length?(t=this._q.shift(),(e=t.task)?(i=e.apply(this.context,t.args),i&&"function"==typeof i.then?i.then(function(){t.deferred.resolve.apply(this.context,arguments)}.bind(this)):(t.deferred.resolve.apply(this.context,i),t.promise)):t.promise?t.promise:void 0):(t=new r.defer,t.deferred.resolve(),t.promise)},i.prototype.dump=function(){for(;this._q.length;)this.dequeue()},i.prototype.run=function(){return this.running||(this.running=!0,this.defered=new r.defer),this.tick.call(window,function(){this._q.length?this.dequeue().then(function(){this.run()}.bind(this)):(this.defered.resolve(),this.running=void 0)}.bind(this)),1==this.paused&&(this.paused=!1),this.defered.promise},i.prototype.flush=function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0},i.prototype.clear=function(){this._q=[],this.running=!1},i.prototype.length=function(){return this._q.length},i.prototype.pause=function(){this.paused=!0},e.exports=i},{"./core":8,rsvp:4}],18:[function(t,e){function i(t,e){this.settings=o.extend(this.settings||{},{infinite:!0,hidden:!1,width:!1,height:null,layoutOveride:null,axis:"vertical"}),o.extend(this.settings,e),this.viewSettings={},this.book=t,this.views=null,this.hooks={},this.hooks.display=new a(this),this.hooks.serialize=new a(this),this.hooks.content=new a(this),this.hooks.layout=new a(this),this.hooks.render=new a(this),this.hooks.show=new a(this),this.hooks.content.register(s.links.bind(this)),this.hooks.content.register(this.passViewEvents.bind(this)),this.epubcfi=new h,this.q=new u(this),this.q.enqueue(this.book.opened),this.q.enqueue(this.parseLayoutProperties),this.book.archive&&this.replacements()}var r=t("rsvp"),n=t("urijs"),o=t("./core"),s=t("./replacements"),a=t("./hook"),h=t("./epubcfi"),u=t("./queue"),c=t("./view"),p=t("./views"),l=t("./layout"),d=t("./map");i.prototype.initialize=function(t){{var e,i=t||{},r=i.height,n=i.width;i.hidden||!1}return i.height&&o.isNumber(i.height)&&(r=i.height+"px"),i.width&&o.isNumber(i.width)&&(n=i.width+"px"),e=document.createElement("div"),e.id="epubjs-container:"+o.uuid(),e.classList.add("epub-container"),e.style.fontSize="0",e.style.wordSpacing="0",e.style.lineHeight="0",e.style.verticalAlign="top","horizontal"===this.settings.axis&&(e.style.whiteSpace="nowrap"),n&&(e.style.width=n),r&&(e.style.height=r),e.style.overflow=this.settings.overflow,e},i.wrap=function(t){var e=document.createElement("div");return e.style.visibility="hidden",e.style.overflow="hidden",e.style.width="0",e.style.height="0",e.appendChild(t),e},i.prototype.attachTo=function(t){return this.container=this.initialize({width:this.settings.width,height:this.settings.height}),o.isElement(t)?this.element=t:"string"==typeof t&&(this.element=document.getElementById(t)),this.element?(this.settings.hidden?(this.wrapper=this.wrap(this.container),this.element.appendChild(this.wrapper)):this.element.appendChild(this.container),this.views=new p(this.container),this.attachListeners(),this.stageSize(),this.applyLayoutMethod(),this.trigger("attached"),void 0):(console.error("Not an Element"),void 0)},i.prototype.attachListeners=function(){o.isNumber(this.settings.width)&&o.isNumber(this.settings.height)||window.addEventListener("resize",this.onResized.bind(this),!1)},i.prototype.bounds=function(){return this.container.getBoundingClientRect()},i.prototype.display=function(t){return this.q.enqueue(this._display,t)},i.prototype._display=function(t){var e,i,n,o,s,a=new r.defer,h=a.promise,u=this.epubcfi.isCfiString(t);return(e=this.book.spine.get(t))?(s=this.views.find(e),s?(n=i.locationOf(t),h=this.moveTo(n).then(function(){return this.check()})):(this.views.hide(),i=this.createView(e),h=this.fill(i).then(function(){return"string"==typeof t&&t.indexOf("#")>-1&&(o=t.substring(t.indexOf("#")+1)),u||o?(n=i.locationOf(t),this.moveTo(n)):"function"==typeof this.check?this.check():void 0}.bind(this)).then(function(){return this.hooks.display.trigger(i)}.bind(this)).then(function(){this.views.show()}.bind(this))),h.then(function(){this.trigger("displayed",e)}.bind(this)),h):(a.reject(new Error("No Section Found")),h)},i.prototype.moveTo=function(t){this.scrollBy(t.left,t.top)},i.prototype.render=function(t,e){return t.create(),t.onLayout=this.layout.format.bind(this.layout),this.resizeView(t),t.render(this.book.request).then(function(){return this.hooks.content.trigger(t,this)}.bind(this)).then(function(){return this.hooks.layout.trigger(t,this)}.bind(this)).then(function(){return t.display()}.bind(this)).then(function(){return this.hooks.render.trigger(t,this)}.bind(this)).then(function(){e!==!1&&this.views.hidden===!1&&this.q.enqueue(function(t){t.show()},t),this.hooks.show.trigger(t,this),this.trigger("rendered",t.section)}.bind(this)).catch(function(t){this.trigger("loaderror",t)}.bind(this))},i.prototype.afterDisplayed=function(t){this.trigger("added",t.section)},i.prototype.fill=function(t){return this.views.clear(),this.views.append(t),t.onDisplayed=this.afterDisplayed.bind(this),this.render(t)},i.prototype.resizeView=function(t){"pre-paginated"===this.globalLayoutProperties.layout?t.lock("both",this.stage.width,this.stage.height):t.lock("width",this.stage.width,this.stage.height)},i.prototype.stageSize=function(t,e){var i,r=t||this.settings.width,n=e||this.settings.height;return r===!1&&(i=this.element.getBoundingClientRect(),i.width&&(r=i.width,this.container.style.width=i.width+"px")),n===!1&&(i=i||this.element.getBoundingClientRect(),i.height&&(n=i.height,this.container.style.height=i.height+"px")),r&&!o.isNumber(r)&&(i=this.container.getBoundingClientRect(),r=i.width),n&&!o.isNumber(n)&&(i=i||this.container.getBoundingClientRect(),n=i.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0},this.stage={width:r-this.containerPadding.left-this.containerPadding.right,height:n-this.containerPadding.top-this.containerPadding.bottom},this.stage},i.prototype.applyLayoutMethod=function(){this.layout=new l.Scroll,this.updateLayout(),this.map=new d(this.layout)},i.prototype.updateLayout=function(){this.layout.calculate(this.stage.width,this.stage.height)},i.prototype.resize=function(t,e){this.stageSize(t,e),this.updateLayout(),this.views.each(this.resizeView.bind(this)),this.trigger("resized",{width:this.stage.width,height:this.stage.height})},i.prototype.onResized=function(){this.resize()},i.prototype.createView=function(t){return t.hooks.serialize.register(this.hooks.serialize.list()),new c(t,this.viewSettings)},i.prototype.next=function(){return this.q.enqueue(function(){var t,e;return this.views.length?(t=this.views.last().section.next(),t?(e=this.createView(t),this.fill(e)):void 0):void 0})},i.prototype.prev=function(){return this.q.enqueue(function(){var t,e;return this.views.length?(t=this.views.first().section.prev(),t?(e=this.createView(t),this.fill(e)):void 0):void 0})},i.prototype.parseLayoutProperties=function(t){var e=t||this.book.package.metadata,i=this.layoutOveride&&this.layoutOveride.layout||e.layout||"reflowable",r=this.layoutOveride&&this.layoutOveride.spread||e.spread||"auto",n=this.layoutOveride&&this.layoutOveride.orientation||e.orientation||"auto";return this.globalLayoutProperties={layout:i,spread:r,orientation:n},this.globalLayoutProperties},i.prototype.current=function(){var t=this.visible();return t.length?t[t.length-1]:null},i.prototype.isVisible=function(t,e,i,r){var n=t.position(),o=r||this.container.getBoundingClientRect();return"horizontal"===this.settings.axis&&n.right>o.left-e&&n.left<o.right+i?!0:"vertical"===this.settings.axis&&n.bottom>o.top-e&&n.top<o.bottom+i?!0:!1},i.prototype.visible=function(){for(var t,e,i=this.bounds(),r=this.views.displayed(),n=[],o=0;o<r.length;o++)e=r[o],t=this.isVisible(e,0,0,i),t===!0&&n.push(e);return n},i.prototype.bounds=function(){var t;return t=this.settings.height?this.container.getBoundingClientRect():o.windowBounds()},i.prototype.destroy=function(){this.q.clear(),this.views.clear(),clearTimeout(this.trimTimeout),this.settings.hidden?this.element.removeChild(this.wrapper):this.element.removeChild(this.container)},i.prototype.reportLocation=function(){return this.q.enqueue(function(){this.location=this.currentLocation(),this.trigger("locationChanged",this.location)}.bind(this))},i.prototype.currentLocation=function(){var t;return this.views.length?(t=this.views.first(),this.map.page(t)):void 0},i.prototype.scrollBy=function(t,e,i){i&&(this.ignore=!0),this.settings.height?(t&&(this.container.scrollLeft+=t),e&&(this.container.scrollTop+=e)):window.scrollBy(t,e),this.scrolled=!0},i.prototype.scrollTo=function(t,e,i){i&&(this.ignore=!0),this.settings.height?(this.container.scrollLeft=t,this.container.scrollTop=e):window.scrollTo(t,e),this.scrolled=!0},i.prototype.passViewEvents=function(t){t.listenedEvents.forEach(function(e){t.on(e,this.triggerViewEvent.bind(this))}.bind(this))},i.prototype.triggerViewEvent=function(t){this.trigger(t.type,t)},i.prototype.replacements=function(){return this.q.enqueue(function(){var t=this.book.package.manifest,e=Object.keys(t).map(function(e){return t[e]}),i=e.filter(function(t){return"application/xhtml+xml"!=t.type&&"text/html"!=t.type?!0:void 0}),o=i.filter(function(t){return"text/css"===t.type?!0:void 0}),s=o.map(function(t){return t.href}),a=i.map(function(t){return t.href}.bind(this)),h=a.map(function(t){var e=n(t).absoluteTo(this.book.baseUrl).toString();return this.book.archive.createUrl(e)}.bind(this));return r.all(h).then(function(t){s.forEach(function(e){this.replaceCss(e,a,t)}.bind(this)),this.hooks.serialize.register(function(e,i){this.replaceAssets(i,a,t)}.bind(this))}.bind(this)).catch(function(t){console.error(t)})}.bind(this))},i.prototype.replaceCss=function(t,e,i){var r,a,h=n(t),u=h.absoluteTo(this.book.baseUrl).toString(),c=this.book.archive.getText(u),p=e.map(function(t){var e=n(t).absoluteTo(this.book.baseUrl),i=e.relativeTo(u).toString();return i}.bind(this));c=s.substitute(c,p,i),r=o.createBlobUrl(c,"text/css"),a=e.indexOf(t),a>-1&&(i[a]=r)},i.prototype.replaceAssets=function(t,e,i){var r=n(t.url),o=e.map(function(t){var e=n(t).absoluteTo(this.book.baseUrl),i=e.relativeTo(r).toString();return i}.bind(this));t.output=s.substitute(t.output,o,i)},r.EventTarget.mixin(i.prototype),e.exports=i},{"./core":8,"./epubcfi":9,"./hook":10,"./layout":11,"./map":13,"./queue":17,"./replacements":19,"./view":24,"./views":25,rsvp:4,urijs:5}],19:[function(t,e){function i(t,e){var i,r;t&&(r=t.querySelector("head"),i=r.querySelector("base"),i||(i=t.createElement("base")),i.setAttribute("href",e.url),r.insertBefore(i,r.firstChild))}function r(t,e){for(var i=t.document.querySelectorAll("a[href]"),r=function(i){var r=i.getAttribute("href"),n=o(r),s=n.absoluteTo(t.section.url),a=s.relativeTo(this.book.baseUrl).toString();n.protocol()?i.setAttribute("target","_blank"):n.fragment()||(i.onclick=function(){return e.display(a),!1})},n=0;n<i.length;n++)r(i[n])}function n(t,e,i){return e.forEach(function(e,r){e&&i[r]&&(t=t.replace(new RegExp(e,"g"),i[r]))}),t}{var o=t("urijs");t("./core")}e.exports={base:i,links:r,substitute:n}},{"./core":8,urijs:5}],20:[function(t,e){function i(t,e,i,s){function a(){if(this.readyState===this.DONE)if(200===this.status||this.responseXML){var t;t=""!=this.responseType&&"document"!=this.responseType||!this.responseXML?o.isXml(e)?(new DOMParser).parseFromString(this.response,"text/xml"):"xhtml"==e?(new DOMParser).parseFromString(this.response,"application/xhtml+xml"):"html"==e||"htm"==e?(new DOMParser).parseFromString(this.response,"text/html"):"json"==e?JSON.parse(this.response):"blob"==e?c?this.response:new Blob([this.response]):this.response:this.responseXML,l.resolve(t)}else l.reject({status:this.status,message:this.response,stack:(new Error).stack})}var h,u,c=window.URL,p=c?"blob":"arraybuffer",l=new r.defer,d=new XMLHttpRequest,f=XMLHttpRequest.prototype;"overrideMimeType"in f||Object.defineProperty(f,"overrideMimeType",{value:function(){}}),i&&(d.withCredentials=!0),d.open("GET",t,!0);for(u in s)d.setRequestHeader(u,s[u]);return d.onreadystatechange=a,e||(h=n(t),e=h.suffix()),"blob"==e&&(d.responseType=p),"json"==e&&d.setRequestHeader("Accept","application/json"),o.isXml(e)&&(d.responseType="document",d.overrideMimeType("text/xml")),"xhtml"==e&&(d.responseType="document"),("html"==e||"htm"==e)&&(d.responseType="document"),"binary"==e&&(d.responseType="arraybuffer"),d.send(),l.promise}var r=t("rsvp"),n=t("urijs"),o=t("./core");e.exports=i},{"./core":8,rsvp:4,urijs:5}],21:[function(t,e){function i(t){this.idref=t.idref,this.linear=t.linear,this.properties=t.properties,this.index=t.index,this.href=t.href,this.url=t.url,this.next=t.next,this.prev=t.prev,this.epubcfi=new o,this.cfiBase=t.cfiBase,this.hooks={},this.hooks.serialize=new s(this),this.hooks.content=new s(this),this.hooks.content.register(a.base)}var r=t("rsvp"),n=t("urijs"),o=(t("./core"),t("./epubcfi")),s=t("./hook"),a=t("./replacements");i.prototype.load=function(e){var i=e||this.request||t("./request"),o=new r.defer,s=o.promise;return this.contents?o.resolve(this.contents):i(this.url).then(function(t){n(this.url).directory();return this.document=t,this.contents=t.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){o.resolve(this.contents)}.bind(this)).catch(function(t){o.reject(t)}),s},i.prototype.base=function(t){var e,i=new r.defer,n=t.createElement("base");return n.setAttribute("href",this.url),t&&(e=t.querySelector("head")),e?(e.insertBefore(n,e.firstChild),i.resolve()):i.reject(new Error("No head to insert into")),i.promise},i.prototype.beforeSectionLoad=function(){},i.prototype.render=function(t){var e=new r.defer,i=e.promise;return this.output,this.load(t).then(function(t){var e=new XMLSerializer;return this.output=e.serializeToString(t),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){e.resolve(this.output)}.bind(this)).catch(function(t){e.reject(t)}),i},i.prototype.find=function(){},i.prototype.reconcileLayoutSettings=function(t){var e={layout:t.layout,spread:t.spread,orientation:t.orientation};return this.properties.forEach(function(t){var i,r,n=t.replace("rendition:",""),o=n.indexOf("-");-1!=o&&(i=n.slice(0,o),r=n.slice(o+1),e[i]=r)}),e},i.prototype.cfiFromRange=function(t){return this.epubcfi.generateCfiFromRange(t,this.cfiBase)},i.prototype.cfiFromElement=function(t){return this.epubcfi.generateCfiFromElement(t,this.cfiBase)},e.exports=i},{"./core":8,"./epubcfi":9,"./hook":10,"./replacements":19,"./request":20,rsvp:4,urijs:5}],22:[function(t,e){function i(t){this.request=t,this.spineItems=[],this.spineByHref={},this.spineById={}}var r=(t("rsvp"),t("./core"),t("./epubcfi")),n=t("./section");i.prototype.load=function(t){this.items=t.spine,this.manifest=t.manifest,this.spineNodeIndex=t.spineNodeIndex,this.baseUrl=t.baseUrl||"",this.length=this.items.length,this.epubcfi=new r,this.items.forEach(function(t,e){var i,r=this.manifest[t.idref];t.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,t.index,t.idref),r&&(t.href=r.href,t.url=this.baseUrl+t.href,r.properties.length&&t.properties.push.apply(t.properties,r.properties)),t.prev=function(){return this.get(e-1)}.bind(this),t.next=function(){return this.get(e+1)
}.bind(this),i=new n(t),this.append(i)}.bind(this))},i.prototype.get=function(t){var e=0;return this.epubcfi.isCfiString(t)?(cfi=this.epubcfi.parse(t),e=cfi.spinePos):!t||"number"!=typeof t&&isNaN(t)!==!1?t&&0===t.indexOf("#")?e=this.spineById[t.substring(1)]:t&&(t=t.split("#")[0],e=this.spineByHref[t]):e=t,this.spineItems[e]||null},i.prototype.append=function(t){var e=this.spineItems.length;return t.index=e,this.spineItems.push(t),this.spineByHref[t.href]=e,this.spineById[t.idref]=e,e},i.prototype.prepend=function(t){this.spineItems.unshift(t);return this.spineByHref[t.href]=0,this.spineById[t.idref]=0,this.spineItems.forEach(function(t,e){t.index=e}),0},i.prototype.insert=function(){},i.prototype.remove=function(t){var e=this.spineItems.indexOf(t);return e>-1?(delete this.spineByHref[t.href],delete this.spineById[t.idref],this.spineItems.splice(e,1)):void 0},i.prototype.each=function(){return this.spineItems.forEach.apply(this.spineItems,arguments)},e.exports=i},{"./core":8,"./epubcfi":9,"./section":21,rsvp:4}],23:[function(t,e){function i(){this.checkRequirements(),this.urlCache={}}var r=t("rsvp"),n=t("urijs"),o=t("./core"),s=t("./request"),a=t("../libs/mime/mime");i.prototype.checkRequirements=function(){try{"undefined"!=typeof JSZip?this.zip=new JSZip:(JSZip=t("jszip"),this.zip=new JSZip)}catch(e){console.error("JSZip lib not loaded")}},i.prototype.open=function(t){return t instanceof ArrayBuffer?new r.Promise(function(e){this.zip=new JSZip(t),e(this.zip)}):s(t,"binary").then(function(t){return this.zip=new JSZip(t),this.zip}.bind(this))},i.prototype.request=function(t,e){var i,o,s=new r.defer;return e||(uri=n(t),e=uri.suffix()),i="blob"==e?this.getBlob(t):this.getText(t),i?(o=this.handleResponse(i,e),s.resolve(o)):s.reject({message:"File not found in the epub: "+t,stack:(new Error).stack}),s.promise},i.prototype.handleResponse=function(t,e){var i;return i="json"==e?JSON.parse(t):o.isXml(e)?(new DOMParser).parseFromString(t,"text/xml"):"xhtml"==e?(new DOMParser).parseFromString(t,"application/xhtml+xml"):"html"==e||"htm"==e?(new DOMParser).parseFromString(t,"text/html"):t},i.prototype.getBlob=function(t,e){var i,r=window.decodeURIComponent(t.substr(1)),n=this.zip.file(r);return n?(i=e||a.lookup(n.name),new Blob([n.asUint8Array()],{type:i})):void 0},i.prototype.getText=function(t){var e=window.decodeURIComponent(t.substr(1)),i=this.zip.file(e);return i?i.asText():void 0},i.prototype.createUrl=function(t){var e,i,n=new r.defer,o=window.URL||window.webkitURL||window.mozURL;return t in this.urlCache?(n.resolve(this.urlCache[t]),n.promise):(i=this.getBlob(t),i?(e=o.createObjectURL(i),n.resolve(e),this.urlCache[t]=e):n.reject({message:"File not found in the epub: "+t,stack:(new Error).stack}),n.promise)},i.prototype.revokeUrl=function(t){var e=window.URL||window.webkitURL||window.mozURL,i=this.urlCache[t];i&&e.revokeObjectURL(i)},e.exports=i},{"../libs/mime/mime":1,"./core":8,"./request":20,jszip:"jszip",rsvp:4,urijs:5}],24:[function(t,e){function i(t,e){this.settings=e||{},this.id="epubjs-view:"+n.uuid(),this.section=t,this.index=t.index,this.element=document.createElement("div"),this.element.classList.add("epub-view"),this.element.style.height="0px",this.element.style.width="0px",this.element.style.overflow="hidden",this.added=!1,this.displayed=!1,this.rendered=!1,this.epubcfi=new o,this.element.style.display=this.settings.axis&&"horizontal"==this.settings.axis?"inline-block":"block",this.listenedEvents=["keydown","keyup","keypressed","mouseup","mousedown","click","touchend","touchstart"]}var r=t("rsvp"),n=t("./core"),o=t("./epubcfi");i.prototype.create=function(){return this.iframe?this.iframe:(this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=n.bounds(this.element),this.supportsSrcdoc=!1,this.iframe)},i.prototype.lock=function(t,e,i){var r,o=n.borders(this.element);r=this.iframe?n.borders(this.iframe):{width:0,height:0},"width"==t&&n.isNumber(e)&&(this.lockedWidth=e-o.width-r.width,this.resize(this.lockedWidth,e)),"height"==t&&n.isNumber(i)&&(this.lockedHeight=i-o.height-r.height,this.resize(e,this.lockedHeight)),"both"===t&&n.isNumber(e)&&n.isNumber(i)&&(this.lockedWidth=e-o.width-r.width,this.lockedHeight=i-o.height-r.height,this.resize(this.lockedWidth,this.lockedHeight)),this.displayed&&this.iframe&&(this.layout(),this.expand())},i.prototype.expand=function(){var t,e,i=this.lockedWidth,r=this.lockedHeight;this.iframe&&!this._expanding&&(this._expanding=!0,r&&!i&&(t=this.textWidth(),t!=this._textWidth?(i=this.contentWidth(t),this._textWidth=t,this._contentWidth=i):i=this._contentWidth),i&&!r&&(e=this.textHeight(),e!=this._textHeight?(r=this.contentHeight(e),this._textHeight=e,this._contentHeight=r):r=this._contentHeight),(this._needsReframe||i!=this._width||r!=this._height)&&this.resize(i,r),this._expanding=!1)},i.prototype.contentWidth=function(t){var e,i;return e=this.iframe.style.width,this.iframe.style.width=(t||0)+"px",i=this.document.body.scrollWidth,this.iframe.style.width=e,i},i.prototype.contentHeight=function(t){var e,i;return e=this.iframe.style.height,this.iframe.style.height=(t||0)+"px",i=this.document.body.scrollHeight,this.iframe.style.height=e,i},i.prototype.textWidth=function(){var t,e=this.document.createRange();return e.selectNodeContents(this.document.body),t=e.getBoundingClientRect().width},i.prototype.textHeight=function(){var t,e=this.document.createRange();return e.selectNodeContents(this.document.body),t=e.getBoundingClientRect().height},i.prototype.resize=function(t,e){this.iframe&&(n.isNumber(t)&&(this.iframe.style.width=t+"px",this._width=t),n.isNumber(e)&&(this.iframe.style.height=e+"px",this._height=e),this.iframeBounds=n.bounds(this.iframe),this.reframe(this.iframeBounds.width,this.iframeBounds.height))},i.prototype.reframe=function(t,e){return this.displayed?(n.isNumber(t)&&(this.element.style.width=t+"px"),n.isNumber(e)&&(this.element.style.height=e+"px"),this.prevBounds=this.elementBounds,this.elementBounds=n.bounds(this.element),this.trigger("resized",{width:this.elementBounds.width,height:this.elementBounds.height,widthDelta:this.elementBounds.width-this.prevBounds.width,heightDelta:this.elementBounds.height-this.prevBounds.height}),void 0):(this._needsReframe=!0,void 0)},i.prototype.resized=function(){},i.prototype.render=function(t){return this.rendering=!0,this.section.render(t).then(function(t){return this.load(t)}.bind(this))},i.prototype.load=function(t){var e=new r.defer,i=e.promise;if(!this.iframe)return e.reject(new Error("No Iframe Available")),i;if(this.iframe.onload=function(){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.rendering=!1,e.resolve(this)}.bind(this),this.supportsSrcdoc)this.iframe.srcdoc=t;else{if(this.document=this.iframe.contentDocument,!this.document)return e.reject(new Error("No Document Available")),i;this.document.open(),this.document.write(t),this.document.close()}return i},i.prototype.layout=function(t){this.iframe.style.display="inline-block",this.document.body.style.margin="0",t&&t(this),this.onLayout(this)},i.prototype.onLayout=function(){},i.prototype.listeners=function(){this.document.fonts&&"loading"===this.document.fonts.status&&(this.document.fonts.onloadingdone=function(){this.expand()}.bind(this)),this.section.properties.indexOf("scripted")>-1&&(this.observer=this.observe(this.document.body)),this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners()},i.prototype.removeListeners=function(){this.removeEventListeners(),this.removeSelectionListeners()},i.prototype.resizeListenters=function(){clearTimeout(this.expanding),this.expanding=setTimeout(this.expand.bind(this),350)},i.prototype.mediaQueryListeners=function(){for(var t=this.document.styleSheets,e=function(t){t.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),i=0;i<t.length;i+=1){var r=t[i].cssRules;if(!r)return;for(var n=0;n<r.length;n+=1)if(r[n].media){var o=this.window.matchMedia(r[n].media.mediaText);o.addListener(e)}}},i.prototype.observe=function(t){var e=this,i=new MutationObserver(function(){e._expanding&&e.expand()}),r={attributes:!0,childList:!0,characterData:!0,subtree:!0};return i.observe(t,r),i},i.prototype.imageLoadListeners=function(){for(var t,e=this.document.body.querySelectorAll("img"),i=0;i<e.length;i++)t=e[i],"undefined"!=typeof t.naturalWidth&&0===t.naturalWidth&&(t.onload=this.expand.bind(this))},i.prototype.display=function(){var t=new r.defer;return this.displayed=!0,this.layout(),this.listeners(),this.expand(),this.trigger("displayed",this),this.onDisplayed(this),t.resolve(this),t.promise},i.prototype.show=function(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible"),this.trigger("shown",this)},i.prototype.hide=function(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.trigger("hidden",this)},i.prototype.position=function(){return this.element.getBoundingClientRect()},i.prototype.onDisplayed=function(){},i.prototype.bounds=function(){return this.elementBounds||(this.elementBounds=n.bounds(this.element)),this.elementBounds},i.prototype.destroy=function(){this.observer&&this.observer.disconnect(),this.displayed&&(this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.displayed=!1,this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)},i.prototype.root=function(){return this.document?this.document.documentElement:null},i.prototype.locationOf=function(t){var e=this.iframe.getBoundingClientRect(),i={left:0,top:0};return this.document?(this.epubcfi.isCfiString(t)?(cfi=this.epubcfi.parse(t),"undefined"==typeof document.evaluate?(marker=this.epubcfi.addMarker(cfi,this.document),marker&&(this.epubcfi.removeMarker(marker,this.document),i=marker.getBoundingClientRect())):(range=this.epubcfi.generateRangeFromCfi(cfi,this.document),range&&(i=range.getBoundingClientRect()))):"string"==typeof t&&t.indexOf("#")>-1&&(id=t.substring(t.indexOf("#")+1),el=this.document.getElementById(id),el&&(i=el.getBoundingClientRect())),{left:window.scrollX+e.left+i.left,top:window.scrollY+e.top+i.top}):void 0},i.prototype.addCss=function(t){return new r.Promise(function(e){var i,r=!1;return this.document?(i=this.document.createElement("link"),i.type="text/css",i.rel="stylesheet",i.href=t,i.onload=i.onreadystatechange=function(){r||this.readyState&&"complete"!=this.readyState||(r=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(i),void 0):(e(!1),void 0)}.bind(this))},i.prototype.addStylesheetRules=function(t){var e,i;if(this.document){e=this.document.createElement("style"),this.document.head.appendChild(e),i=e.sheet;for(var r=0,n=t.length;n>r;r++){var o=1,s=t[r],a=t[r][0],h="";"[object Array]"===Object.prototype.toString.call(s[1][0])&&(s=s[1],o=0);for(var u=s.length;u>o;o++){var c=s[o];h+=c[0]+":"+c[1]+(c[2]?" !important":"")+";\n"}i.insertRule(a+"{"+h+"}",i.cssRules.length)}}},i.prototype.addScript=function(t){return new r.Promise(function(e){var i,r=!1;return this.document?(i=this.document.createElement("script"),i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){r||this.readyState&&"complete"!=this.readyState||(r=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(i),void 0):(e(!1),void 0)}.bind(this))},i.prototype.addEventListeners=function(){this.document&&this.listenedEvents.forEach(function(t){this.document.addEventListener(t,this.triggerEvent.bind(this),!1)},this)},i.prototype.removeEventListeners=function(){this.document&&this.listenedEvents.forEach(function(t){this.document.removeEventListener(t,this.triggerEvent,!1)},this)},i.prototype.triggerEvent=function(t){this.trigger(t.type,t)},i.prototype.addSelectionListeners=function(){this.document&&this.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)},i.prototype.removeSelectionListeners=function(){this.document&&this.document.removeEventListener("selectionchange",this.onSelectionChange,!1)},i.prototype.onSelectionChange=function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){this.selectedRange=this.window.getSelection(),this.trigger("selected",this.selectedRange)}.bind(this),500)},r.EventTarget.mixin(i.prototype),e.exports=i},{"./core":8,"./epubcfi":9,rsvp:4}],25:[function(t,e){function i(t){this.container=t,this._views=[],this.length=0,this.hidden=!1}i.prototype.first=function(){return this._views[0]},i.prototype.last=function(){return this._views[this._views.length-1]},i.prototype.each=function(){return this._views.forEach.apply(this._views,arguments)},i.prototype.indexOf=function(t){return this._views.indexOf(t)},i.prototype.slice=function(){return this._views.slice.apply(this._views,arguments)},i.prototype.get=function(t){return this._views[t]},i.prototype.append=function(t){return this._views.push(t),this.container.appendChild(t.element),this.length++,t},i.prototype.prepend=function(t){return this._views.unshift(t),this.container.insertBefore(t.element,this.container.firstChild),this.length++,t},i.prototype.insert=function(t,e){return this._views.splice(e,0,t),e<this.container.children.length?this.container.insertBefore(t.element,this.container.children[e]):this.container.appendChild(t.element),this.length++,t},i.prototype.remove=function(t){var e=this._views.indexOf(t);e>-1&&this._views.splice(e,1),this.destroy(t),this.length--},i.prototype.destroy=function(t){t.off("resized"),t.displayed&&t.destroy(),this.container.removeChild(t.element),t=null},i.prototype.clear=function(){var t,e=this.length;if(this.length){for(var i=0;e>i;i++)t=this._views[i],this.destroy(t);this._views=[],this.length=0}},i.prototype.find=function(t){for(var e,i=this.length,r=0;i>r;r++)if(e=this._views[r],e.displayed&&e.section.index==t.index)return e},i.prototype.displayed=function(){for(var t,e=[],i=this.length,r=0;i>r;r++)t=this._views[r],t.displayed&&e.push(t);return e},i.prototype.show=function(){for(var t,e=this.length,i=0;e>i;i++)t=this._views[i],t.displayed&&t.show();this.hidden=!1},i.prototype.hide=function(){for(var t,e=this.length,i=0;e>i;i++)t=this._views[i],t.displayed&&t.hide();this.hidden=!0},e.exports=i},{}],epub:[function(t,e){(function(i){function r(t){return new n(t)}"undefined"==typeof EPUBJS&&(("undefined"!=typeof window?window:i).EPUBJS={}),EPUBJS.VERSION="0.3.0";var n=t("./book");e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./book":6}]},{},["epub"])("epub")});
//# sourceMappingURL=epub.min.js.map
