{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap b3c79a560b3b7f5773bb","webpack:///./src/utils/core.js","webpack:///./src/epubcfi.js","webpack:///./src/utils/path.js","webpack:///./~/event-emitter/index.js","webpack:///./src/utils/url.js","webpack:///./~/path-webpack/path.js","webpack:///./src/hook.js","webpack:///./src/mapping.js","webpack:///./src/queue.js","webpack:///./src/replacements.js","webpack:///./src/request.js","webpack:///./src/contents.js","webpack:///./src/managers/default/index.js","webpack:///./src/rendition.js","webpack:///external \"xmldom\"","webpack:///./src/book.js","webpack:///./src/managers/continuous/index.js","webpack:///./src/managers/views/iframe.js","webpack:///(webpack)/buildin/global.js","webpack:///./libs/mime/mime.js","webpack:///./src/archive.js","webpack:///./src/container.js","webpack:///./src/layout.js","webpack:///./src/locations.js","webpack:///./src/managers/helpers/stage.js","webpack:///./src/managers/helpers/views.js","webpack:///./src/navigation.js","webpack:///./src/packaging.js","webpack:///./src/pagelist.js","webpack:///./src/resources.js","webpack:///./src/section.js","webpack:///./src/spine.js","webpack:///./src/themes.js","webpack:///./~/d/index.js","webpack:///./~/es5-ext/object/assign/index.js","webpack:///./~/es5-ext/object/assign/is-implemented.js","webpack:///./~/es5-ext/object/assign/shim.js","webpack:///./~/es5-ext/object/is-callable.js","webpack:///./~/es5-ext/object/keys/index.js","webpack:///./~/es5-ext/object/keys/is-implemented.js","webpack:///./~/es5-ext/object/keys/shim.js","webpack:///./~/es5-ext/object/normalize-options.js","webpack:///./~/es5-ext/object/valid-callable.js","webpack:///./~/es5-ext/object/valid-value.js","webpack:///./~/es5-ext/string/#/contains/index.js","webpack:///./~/es5-ext/string/#/contains/is-implemented.js","webpack:///./~/es5-ext/string/#/contains/shim.js","webpack:///./~/process/browser.js","webpack:///external \"JSZip\"","webpack:///./src/epub.js"],"names":["isElement","uuid","values","documentHeight","isNumber","isFloat","prefixed","defaults","extend","insert","locationOf","indexOfSorted","bounds","borders","windowBounds","cleanStringForXpath","indexOfTextNode","isXml","createBlob","createBlobUrl","createBase64Url","type","parse","qs","qsa","qsp","sprint","treeWalker","walk","blob2base64","defer","querySelectorByType","children","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","obj","nodeType","d","Date","getTime","replace","c","r","Math","random","floor","toString","object","index","props","Object","keys","length","result","Array","max","document","documentElement","clientHeight","body","scrollHeight","offsetHeight","n","isNaN","parseFloat","isFinite","unprefixed","vendors","prefixes","upper","toUpperCase","slice","style","i","arguments","source","prop","target","sources","call","forEach","getOwnPropertyNames","propName","defineProperty","getOwnPropertyDescriptor","item","array","compareFunction","location","splice","_start","_end","start","end","pivot","parseInt","compared","a","b","el","getComputedStyle","widthProps","heightProps","width","height","innerWidth","innerHeight","top","left","right","bottom","str","parts","match","map","part","join","textNode","parent","parentNode","childNodes","sib","Node","TEXT_NODE","ext","indexOf","content","mime","blob","Blob","_URL","URL","webkitURL","mozURL","tempUrl","createObjectURL","string","data","datauri","btoa","prototype","markup","forceXMLDom","doc","DOMParser","require","parseFromString","sel","elements","Error","querySelector","getElementsByTagName","querySelectorAll","q","filtered","filter","getAttribute","root","func","ownerDocument","createTreeWalker","NodeFilter","SHOW_TEXT","node","nextNode","callback","firstChild","nextSibling","cb","reader","FileReader","readAsDataURL","onloadend","resolve","reject","id","promise","Promise","bind","freeze","html","element","query","getAttributeNS","push","ELEMENT_NODE","COMMENT_NODE","DOCUMENT_NODE","EpubCFI","constructor","cfiFrom","base","ignoreClass","spinePos","range","path","parseComponent","steps","checkType","fromRange","fromNode","TypeError","cfi","isCfiString","startContainer","cfiStr","baseComponent","pathComponent","getChapterComponent","getPathComponent","getRange","componentStr","component","terminal","offset","assertion","split","parseTerminal","shift","step","parseStep","stepStr","num","has_brackets","termialStr","characterOffset","textLocationAssertion","indirection","ranges","getCharecterOffsetComponent","splitStr","joinSteps","segment","segmentString","cfiString","compare","cfiOne","cfiTwo","stepsA","stepsB","terminalA","terminalB","concat","tagName","position","filteredStep","filteredNode","filteredPosition","pathTo","currentNode","unshift","equalStep","stepA","stepB","endContainer","startOffset","endOffset","needsIgnoring","collapsed","patchOffset","len","anchor","sibling","previousSibling","isText","classList","contains","console","error","curr","totalOffset","textContent","normalizedMap","output","prevIndex","currNodeType","prevNodeType","textNodes","stepsToXpath","xpath","stepsToQuerySelector","container","walkToNode","_doc","findNode","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","fixMiss","child","childIndex","lastStepIndex","hasOwnProperty","toRange","createRange","startSteps","endSteps","missed","setStart","e","setEnd","generateChapterComponent","_spineNodeIndex","_pos","pos","spineNodeIndex","Path","pathString","protocol","parsed","pathname","isDirectory","directory","dir","filename","extension","what","isAbsolute","charAt","relative","splitPath","splitPathRe","exec","Url","urlString","baseString","absolute","undefined","href","origin","fragment","search","fullpath","Hook","context","hooks","register","j","trigger","args","promises","task","executing","apply","all","list","clear","Mapping","layout","section","view","findRanges","rangeListToCfiList","cfiBase","page","contents","rangePairToCfiPair","findStart","findEnd","acceptNode","trim","FILTER_ACCEPT","FILTER_REJECT","columns","scrollWidth","count","column","gap","pages","stack","$el","found","$prev","elPos","elRange","selectNodeContents","getBoundingClientRect","findTextStartRange","findTextEndRange","splitTextNodeIntoRanges","prev","_splitter","text","rect","splitter","rangePair","startRange","endRange","collapse","startCfi","endCfi","cifPair","Queue","_q","tick","running","paused","enqueue","deferred","queued","run","dequeue","inwait","then","reason","dump","defered","flush","pause","Task","toApply","value","replaceBase","replaceCanonical","replaceLinks","substitute","head","createElement","insertBefore","setAttribute","url","link","appendChild","renderer","links","replaceLink","linkUrl","book","onclick","display","urls","replacements","RegExp","request","withCredentials","headers","supportsURL","BLOB_RESPONSE","uri","xhr","XMLHttpRequest","xhrPrototype","header","xmlHttpRequestOverrideMimeType","mimeType","onreadystatechange","handler","onerror","err","open","setRequestHeader","responseType","overrideMimeType","send","readyState","DONE","responseXML","status","response","message","JSON","Contents","epubcfi","defaultView","listenedEvents","_size","listeners","w","frame","h","contentWidth","contentHeight","textWidth","textHeight","overflow","overflowX","overflowY","css","property","viewport","options","scale","scalable","$viewport","newContent","hasAttribute","expand","emit","imageLoadListeners","mediaQueryListeners","addEventListeners","addSelectionListeners","resizeListeners","removeListeners","removeEventListeners","removeSelectionListeners","clearTimeout","expanding","setTimeout","sheets","styleSheets","mediaChangeHandler","m","matches","_expanding","rules","cssRules","media","mql","matchMedia","mediaText","addListener","observe","observer","MutationObserver","mutations","config","attributes","childList","characterData","subtree","images","img","naturalWidth","onload","fontLoadListeners","fonts","ready","targetPos","getClientRects","substring","getElementById","addStylesheet","src","$stylesheet","rel","addStylesheetRules","styleEl","styleSheet","key","sheet","rl","rule","selector","propStr","pl","insertRule","addScript","$script","async","addClass","className","add","removeClass","remove","eventName","addEventListener","triggerEvent","removeEventListener","onSelectionChange","selectionEndTimeout","selection","getSelection","triggerSelectedEvent","cfirange","rangeCount","getRangeAt","_cfi","size","columnWidth","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","scaler","offsetX","offsetY","translate","fit","widthScale","heightScale","mapPage","mapping","destroy","disconnect","DefaultViewManager","name","View","renditionQueue","queue","settings","infinite","hidden","axis","viewSettings","render","stage","attachTo","getContainer","views","_bounds","_stageSize","onResize","onResized","updateLayout","resizeTimeout","resize","each","createView","displaying","displayed","visible","find","moveTo","hide","next","divisor","show","afterDisplayed","afterResized","distX","distY","delta","scrollTo","append","onDisplayed","prepend","scrollLeft","offsetWidth","scrollBy","last","first","current","currentLocation","scrolledLocation","paginatedLocation","spreadWidth","isVisible","offsetPrev","offsetNext","_container","viewsLength","x","y","silent","ignore","scrollTop","scrolled","onScroll","applyLayout","calculate","addStyleRules","setLayout","updateFlow","flow","getContents","Rendition","manager","spread","minSpreadWidth","serialize","passViewEvents","themes","opened","starting","started","setManager","requireManager","viewManager","ePub","ViewManagers","requireView","Views","ViewManager","load","globalLayoutProperties","determineLayoutProperties","package","metadata","on","reportLocation","_display","locations","log","cfiFromPercentage","spine","get","properties","orientation","_flow","_layout","min","isRendered","percentage","percentageFromCfi","triggerViewEvent","adjustImages","CONTAINER_PATH","Book","requestMethod","requestCredentials","requestHeaders","encoding","opening","isOpen","loading","manifest","cover","navigation","pageList","resources","loaded","archived","catch","input","determineType","openEpub","openPackaging","openContainer","unarchive","packagePath","xml","packageUrl","packaging","unpack","resolved","archive","opf","resolver","loadNavigation","toc","coverPath","navPath","ncxPath","renderTo","rendition","setRequestCredentials","credentials","setRequestHeaders","coverUrl","retrieved","replaceCss","cfiRange","identifier","ident","EPUBJS_VERSION","VERSION","ContinuousViewManager","offsetDelta","fill","_full","full","check","removeShownListeners","counter","heightDelta","widthDelta","update","_offset","updating","trimTimeout","_offsetLeft","_offsetTop","checking","newViews","horizontal","visibleLength","contentLength","firstIndex","lastIndex","above","below","erase","prevTop","prevLeft","scrollY","scrollX","addScrollListeners","scroller","prevScrollTop","prevScrollLeft","scrollDeltaVert","scrollDeltaHorz","afterScrolled","abs","scrollTimeout","startPage","endPage","startA","startB","endA","endB","pageLeft","pageRight","IframeView","added","rendered","fixedWidth","fixedHeight","create","iframe","createContainer","scrolling","seamless","border","resizing","visibility","_width","_height","elementBounds","supportsSrcdoc","sectionRender","format","addListeners","lock","elBorders","iframeBorders","lockedWidth","lockedHeight","force","_textWidth","ceil","_contentWidth","_textHeight","_contentHeight","_needsReframe","iframeBounds","reframe","prevBounds","event","onLoad","srcdoc","contentDocument","write","close","contentWindow","rendering","setAxis","resizeListenters","layoutFunc","stopExpanding","parentPos","removeChild","table","mimeTypes","subtype","val","defaultValue","lookup","pop","toLowerCase","module","exports","Archive","zip","checkRequirements","urlCache","JSZip","isBase64","loadAsync","openUrl","zipUrl","getBlob","getText","handleResponse","decodededUrl","decodeURIComponent","substr","entry","file","uint8array","getBase64","createUrl","useBase64","base64","revokeUrl","fromCache","revokeObjectURL","Container","containerDocument","rootfile","folder","dirname","xmlEncoding","Layout","_spread","_minSpreadWidth","_evenSpreads","evenSpreads","_gap","fullWidth","colWidth","formating","totalWidth","spreads","Locations","_locations","total","break","_current","generate","chars","process","_currentCfi","_break","parser","dist","locationFromCfi","loc","percentageFromLocation","cfiFromLocation","pg","save","json","stringify","getCurrent","setCurrent","Stage","_options","wrapper","wrap","wordSpacing","lineHeight","verticalAlign","whiteSpace","getElement","_element","containerStyles","containerPadding","getSheet","createTextNode","rulesArray","scope","set","_views","Navigation","tocByHref","tocById","ncx","parseNav","parseNcx","navHtml","navElement","navItems","navItem","subitems","nodeName","tocXml","navPoints","ncxItem","navLabel","fn","Packaging","packageDocument","metadataNode","manifestNode","spineNode","parseManifest","findNavPath","findNcxPath","findCoverPath","parseSpine","parseMetadata","direction","title","getElementText","creator","description","pubdate","publisher","language","rights","modified_date","getPropertyText","manifestXml","selected","items","spineXml","idref","propArray","itemref","tocId","packageXml","pkg","epubVersion","metaCover","coverId","tag","getElementsByTagNameNS","nodeValue","PageList","isCfi","firstPage","lastPage","totalPages","addCFIs","pageFromCfi","cfiFromPage","pageFromPercentage","percent","round","percentageFromPage","Resources","replacementUrls","splitUrls","assets","cssUrls","replaced","replacement","createCssFile","replacementUrl","indexInUrls","newUrl","textResponse","relUrls","assetHref","relativeTo","Section","linear","_request","_document","serializer","XMLSerializer","serializeToString","reconcileLayoutSettings","global","cfiFromRange","_range","cfiFromElement","Spine","spineItems","spineByHref","spineById","_package","baseUrl","basePath","manifestItem","spineItem","Themes","_themes","_overrides","_injected","inject","overrides","registerThemes","default","registerUrl","registerRules","theme","serialized","injected","override","fontSize","CFI"],"mappings":"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SAAO,KAAKgH,IAAZ;AACA;;AAEDtI,SAASgJ,IAAT,EAAe;AACd,MAAIC,aAAcD,KAAKhM,OAAL,CAAa,KAAb,IAAsB,CAAC,CAAzC;AACA,MAAIgN,QAAJ;;AAEA,MAAIf,UAAJ,EAAgB;AACf,UAAOD,IAAP;AACA;;AAEDgB,aAAW,sBAAKhK,OAAL,CAAa,KAAK4I,SAAlB,EAA6BI,IAA7B,CAAX;AACA,SAAO,KAAKa,MAAL,GAAcG,QAArB;AACA;;AAEDb,UAAUH,IAAV,EAAgB;AACf,SAAO,sBAAKG,QAAL,CAAcH,IAAd,EAAoB,KAAKJ,SAAzB,CAAP;AACA;;AAED3Q,YAAY;AACX,SAAO,KAAK2R,IAAZ;AACA;AApEQ;;kBAuEKL,G;;;;;;;;AClFf;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,QAAQ;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAAsC,8BAA8B;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,UAAU,yBAAyB;AACnC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU,qBAAqB;AAC/B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU,aAAa;AACvB;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,WAAW;AACX;AACA,qCAAqC;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA,gDAAgD;AAChD;AACA,WAAW;AACX;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2CAA2C,cAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU,YAAY;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;;;;ACniBA;;;;;;;AAOA,MAAMU,IAAN,CAAW;AACVjJ,aAAYkJ,OAAZ,EAAoB;AACnB,OAAKA,OAAL,GAAeA,WAAW,IAA1B;AACA,OAAKC,KAAL,GAAa,EAAb;AACA;;AAED;;;;AAIAC,YAAU;AACT,OAAI,IAAIxQ,IAAI,CAAZ,EAAeA,IAAIC,UAAUtB,MAA7B,EAAqC,EAAEqB,CAAvC,EAA0C;AACzC,OAAI,OAAOC,UAAUD,CAAV,CAAP,KAAyB,UAA7B,EAAyC;AACxC,SAAKuQ,KAAL,CAAWxJ,IAAX,CAAgB9G,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AEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA,SAAS;AACT;AACA;;;;;;;;AC9DA;;AAEA;AACA;AACA;;;;;;;;ACJA;;AAEA;AACA;AACA;AACA,QAAQ;AACR,cAAc,aAAa,GAAG,eAAe;AAC7C;AACA;;;;;;;;ACRA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO,sBAAsB,EAAE;AAC/B;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrBA;;AAEA;;AAEA,iCAAiC,kCAAkC;;;;;;;;ACJnE;;AAEA;AACA;AACA;;;;;;;;ACJA;;AAEA;AACA;AACA;AACA;AACA,EAAE,YAAY,cAAc;AAC5B;;;;;;;;ACPA;;AAEA;;AAEA;AACA;AACA;;;;;;;;ACNA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;;;;;;;AChBA;;AAEA;AACA;AACA;AACA;;;;;;;;ACLA;;AAEA;AACA;AACA;AACA;;;;;;;;ACLA;;AAEA;AACA;AACA;;;;;;;;ACJA;;AAEA;;AAEA;AACA;AACA;AACA;;;;;;;;ACPA;;AAEA;;AAEA;AACA;AACA;;;;;;;ACNA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;ACnLtC,2DAA2D,kDAAkD,6BAA6B;AAC1I,gD;;;;;;;;;;;;;ACDA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;;;;;;;AAOA,SAASjX,IAAT,CAAczP,GAAd,EAAmB4D,OAAnB,EAA4B;AAC3B,QAAO,mBAAS5D,GAAT,EAAc4D,OAAd,CAAP;AACA;;AAED6L,KAAK6E,OAAL,GAAe,OAAf;;AAEA,IAAI,OAAOuR,MAAP,KAAmB,WAAvB,EAAoC;AACnCA,QAAOxR,cAAP,GAAwB5E,KAAK6E,OAA7B;AACA;;AAED7E,KAAKgY,GAAL;AACAhY,KAAKb,SAAL;AACAa,KAAKhN,QAAL;;AAEAgN,KAAKC,YAAL,GAAoB,EAApB;AACAD,KAAKG,KAAL,GAAa,EAAb;AACA;;;AAGAH,KAAK7U,QAAL,GAAgB;AACf;;;AAGAiU,UAAU,iBAASvE,IAAT,EAAeuE,QAAf,EAAuB;AAChC,SAAOY,KAAKC,YAAL,CAAkBpF,IAAlB,IAA0BuE,QAAjC;AACA,EANc;AAOf;;;AAGAnT,OAAO,cAAS4O,IAAT,EAAe5O,KAAf,EAAoB;AAC1B,SAAO+T,KAAKG,KAAL,CAAWtF,IAAX,IAAmB5O,KAA1B;AACA;AAZc,CAAhB;;AAeA;AACA+T,KAAK7U,QAAL,CAAcc,IAAd,CAAmB,QAAnB,EAA6B,mBAAA9M,CAAQ,EAAR,CAA7B;;AAEA;AACA6gB,KAAK7U,QAAL,CAAciU,OAAd,CAAsB,SAAtB,EAAiC,mBAAAjgB,CAAQ,EAAR,CAAjC;AACA6gB,KAAK7U,QAAL,CAAciU,OAAd,CAAsB,YAAtB,EAAoC,mBAAAjgB,CAAQ,EAAR,CAApC;;kBAEe6gB,I;AACf","file":"epub.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory((function webpackLoadOptionalExternalModule() { try { return require(\"JSZip\"); } catch(e) {} }()), require(\"xmldom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"JSZip\", \"xmldom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ePub\"] = factory((function webpackLoadOptionalExternalModule() { try { return require(\"JSZip\"); } catch(e) {} }()), require(\"xmldom\"));\n\telse\n\t\troot[\"ePub\"] = factory(root[\"JSZip\"], root[\"xmldom\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_48__, __WEBPACK_EXTERNAL_MODULE_14__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 49);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b3c79a560b3b7f5773bb","export const requestAnimationFrame = (typeof window != 'undefined') ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\n\nexport function isElement(obj) {\n\t\treturn !!(obj && obj.nodeType == 1);\n};\n\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\nexport function uuid() {\n\tvar d = new Date().getTime();\n\tvar uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\t\td = Math.floor(d/16);\n\t\t\treturn (c=='x' ? r : (r&0x7|0x8)).toString(16);\n\t});\n\treturn uuid;\n};\n\n// From Lodash\nexport function values(object) {\n\tvar index = -1,\n\t\t\tprops = Object.keys(object),\n\t\t\tlength = props.length,\n\t\t\tresult = Array(length);\n\n\twhile (++index < length) {\n\t\tresult[index] = object[props[index]];\n\t}\n\treturn result;\n};\n\nexport function documentHeight() {\n\treturn Math.max(\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight\n\t);\n};\n\nexport function isNumber(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n};\n\nexport function isFloat(n) {\n\treturn isNumber(n) && (Math.floor(n) !== n);\n}\n\nexport function prefixed(unprefixed) {\n\tvar vendors = [\"Webkit\", \"Moz\", \"O\", \"ms\" ],\n\t\tprefixes = ['-Webkit-', '-moz-', '-o-', '-ms-'],\n\t\tupper = unprefixed[0].toUpperCase() + unprefixed.slice(1),\n\t\tlength = vendors.length;\n\n\tif (typeof(document) === 'undefined' || typeof(document.body.style[unprefixed]) != 'undefined') {\n\t\treturn unprefixed;\n\t}\n\n\tfor ( var i=0; i < length; i++ ) {\n\t\tif (typeof(document.body.style[vendors[i] + upper]) != 'undefined') {\n\t\t\treturn vendors[i] + upper;\n\t\t}\n\t}\n\n\treturn unprefixed;\n};\n\nexport function defaults(obj) {\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\n\t\tvar source = arguments[i];\n\t\tfor (var prop in source) {\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\n\t\t}\n\t}\n\treturn obj;\n};\n\nexport function extend(target) {\n\t\tvar sources = [].slice.call(arguments, 1);\n\t\tsources.forEach(function (source) {\n\t\t\tif(!source) return;\n\t\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\n\t\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n\t\t\t});\n\t\t});\n\t\treturn target;\n};\n\n// Fast quicksort insert for sorted array -- based on:\n// http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\nexport function insert(item, array, compareFunction) {\n\tvar location = locationOf(item, array, compareFunction);\n\tarray.splice(location, 0, item);\n\n\treturn location;\n};\n// Returns where something would fit in\nexport function locationOf(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a = b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn pivot;\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared > 0 ? pivot : pivot + 1;\n\t}\n\n\tif(compared === 0) {\n\t\treturn pivot;\n\t}\n\tif(compared === -1) {\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\n\t}\n};\n// Returns -1 of mpt found\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a = b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn -1; // Not found\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared === 0 ? pivot : -1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot; // Found\n\t}\n\tif(compared === -1) {\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\n\t}\n};\n\nexport function bounds(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n};\n\nexport function borders(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n};\n\nexport function windowBounds() {\n\n\tvar width = window.innerWidth;\n\tvar height = window.innerHeight;\n\n\treturn {\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tright: width,\n\t\tbottom: height,\n\t\twidth: width,\n\t\theight: height\n\t};\n\n};\n\n//https://stackoverflow.com/questions/13482352/xquery-looking-for-text-with-single-quote/13483496#13483496\nexport function cleanStringForXpath(str)\t{\n\t\tvar parts = str.match(/[^'\"]+|['\"]/g);\n\t\tparts = parts.map(function(part){\n\t\t\t\tif (part === \"'\")\t{\n\t\t\t\t\t\treturn '\\\"\\'\\\"'; // output \"'\"\n\t\t\t\t}\n\n\t\t\t\tif (part === '\"') {\n\t\t\t\t\t\treturn \"\\'\\\"\\'\"; // output '\"'\n\t\t\t\t}\n\t\t\t\treturn \"\\'\" + part + \"\\'\";\n\t\t});\n\t\treturn \"concat(\\'\\',\" + parts.join(\",\") + \")\";\n};\n\nexport function indexOfTextNode(textNode){\n\tvar parent = textNode.parentNode;\n\tvar children = parent.childNodes;\n\tvar sib;\n\tvar index = -1;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tsib = children[i];\n\t\tif(sib.nodeType === Node.TEXT_NODE){\n\t\t\tindex++;\n\t\t}\n\t\tif(sib == textNode) break;\n\t}\n\n\treturn index;\n};\n\nexport function isXml(ext) {\n\treturn ['xml', 'opf', 'ncx'].indexOf(ext) > -1;\n}\n\nexport function createBlob(content, mime){\n\tvar blob = new Blob([content], {type : mime });\n\n\treturn blob;\n};\n\nexport function createBlobUrl(content, mime){\n\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\tvar tempUrl;\n\tvar blob = this.createBlob(content, mime);\n\n\ttempUrl = _URL.createObjectURL(blob);\n\n\treturn tempUrl;\n};\n\nexport function createBase64Url(content, mime){\n\tvar string;\n\tvar data;\n\tvar datauri;\n\n\tif (typeof(content) !== \"string\") {\n\t\t// Only handles strings\n\t\treturn;\n\t}\n\n\tdata = btoa(content);\n\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\n\n\treturn datauri;\n};\n\nexport function type(obj){\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\n}\n\nexport function parse(markup, mime, forceXMLDom) {\n\tvar doc;\n\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\n\t\tDOMParser = require('xmldom').DOMParser;\n\t}\n\n\n\tdoc = new DOMParser().parseFromString(markup, mime);\n\n\treturn doc;\n}\n\nexport function qs(el, sel) {\n\tvar elements;\n\tif (!el) {\n\t\tthrow new Error('No Element Provided');\n\t}\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\telements = el.getElementsByTagName(sel);\n\t\tif (elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\t}\n}\n\nexport function qsa(el, sel) {\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelectorAll(sel);\n\t} else {\n\t\treturn el.getElementsByTagName(sel);\n\t}\n}\n\nexport function qsp(el, sel, props) {\n\tvar q, filtered;\n\tif (typeof el.querySelector != \"undefined\") {\n\t\tsel += '[';\n\t\tfor (var prop in props) {\n\t\t\tsel += prop + \"='\" + props[prop] + \"'\";\n\t\t}\n\t\tsel += ']';\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\tq = el.getElementsByTagName(sel);\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\n\t\t\tfor (var prop in props) {\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (filtered) {\n\t\t\treturn filtered[0];\n\t\t}\n\t}\n}\n\n/**\n * Sprint through all text nodes in a document\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n\tvar doc = root.ownerDocument || root;\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\n\t} else {\n\t\twalk(root, function(node) {\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\n\t\t\t\tfunc(node);\n\t\t\t}\n\t\t}, true);\n\t}\n}\n\nexport function treeWalker(root, func, filter) {\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\n\tlet node;\n\twhile ((node = treeWalker.nextNode())) {\n\t\tfunc(node);\n\t}\n}\n\n// export function walk(root, func, onlyText) {\n// \tvar node = root;\n//\n// \tif (node && !onlyText || node.nodeType === 3) { // Node.TEXT_NODE\n// \t\tfunc(node);\n// \t}\n// \tconsole.log(root);\n//\n// \tnode = node.firstChild;\n// \twhile(node) {\n// \t\twalk(node, func, onlyText);\n// \t\tnode = node.nextSibling;\n// \t}\n// }\n\n/**\n * @param callback return false for continue,true for break\n * @return boolean true: break visit;\n */\nexport function walk(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tif(node = node.firstChild){\n\t\tdo{\n\t\t\tif(walk(node,callback)){return true}\n\t\t}while(node=node.nextSibling)\n\t}\n}\n\nexport function blob2base64(blob, cb) {\n\tvar reader = new FileReader();\n\treader.readAsDataURL(blob);\n\treader.onloadend = function() {\n\t\tcb(reader.result);\n\t}\n}\n\n// From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\nexport function defer() {\n\t/* A method to resolve the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} value : This value is used to resolve the promise\n\t * If the value is a Promise then the associated promise assumes the state\n\t * of Promise passed as value.\n\t */\n\tthis.resolve = null;\n\n\t/* A method to reject the assocaited Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} reason: The reason for the rejection of the Promise.\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\n\t * itself will be the reason for rejection no matter the state of the Promise.\n\t */\n\tthis.reject = null;\n\n\tthis.id = uuid();\n\n\t/* A newly created Pomise object.\n\t * Initially in pending state.\n\t */\n\tthis.promise = new Promise(function(resolve, reject) {\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t}.bind(this));\n\tObject.freeze(this);\n}\n\n export function querySelectorByType(html, element, type){\n\tvar query;\n\tif (typeof html.querySelector != \"undefined\") {\n\t\tquery = html.querySelector(element+'[*|type=\"'+type+'\"]');\n\t}\n\t// Handle IE not supporting namespaced epub:type in querySelector\n\tif(!query || query.length === 0) {\n\t\tquery = qsa(html, element);\n\t\tfor (var i = 0; i < query.length; i++) {\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type) {\n\t\t\t\treturn query[i];\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn query;\n\t}\n}\n\nexport function children(el) {\n\tvar children = [];\n\tvar childNodes = el.parentNode.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1) {\n\t\t\tchildren.push(node);\n\t\t}\n\t};\n\treturn children;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/core.js","import {extend, type, children} from './utils/core';\n\n/**\n\tEPUB CFI spec: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\n\n\tImplements:\n\t- Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\n\t- Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\n\n\tDoes Not Implement:\n\t- Temporal Offset (~)\n\t- Spatial Offset (@)\n\t- Temporal-Spatial Offset (~ + @)\n\t- Text Location Assertion ([)\n*/\n\nvar ELEMENT_NODE = 1;\nvar TEXT_NODE = 3;\nvar COMMENT_NODE = 8;\nvar DOCUMENT_NODE = 9;\n\nclass EpubCFI {\n\tconstructor(cfiFrom, base, ignoreClass){\n\t\tvar type;\n\n\t\tthis.str = '';\n\n\t\tthis.base = {};\n\t\tthis.spinePos = 0; // For compatibility\n\n\t\tthis.range = false; // true || false;\n\n\t\tthis.path = {};\n\t\tthis.start = null;\n\t\tthis.end = null;\n\n\t\t// Allow instantiation without the 'new' keyword\n\t\tif (!(this instanceof EpubCFI)) {\n\t\t\treturn new EpubCFI(cfiFrom, base, ignoreClass);\n\t\t}\n\n\t\tif(typeof base === 'string') {\n\t\t\tthis.base = this.parseComponent(base);\n\t\t} else if(typeof base === 'object' && base.steps) {\n\t\t\tthis.base = base;\n\t\t}\n\n\t\ttype = this.checkType(cfiFrom);\n\n\n\t\tif(type === 'string') {\n\t\t\tthis.str = cfiFrom;\n\t\t\treturn extend(this, this.parse(cfiFrom));\n\t\t} else if (type === 'range') {\n\t\t\treturn extend(this, this.fromRange(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === 'node') {\n\t\t\treturn extend(this, this.fromNode(cfiFrom, this.base, ignoreClass));\n\t\t} else if (type === 'EpubCFI' && cfiFrom.path) {\n\t\t\treturn cfiFrom;\n\t\t} else if (!cfiFrom) {\n\t\t\treturn this;\n\t\t} else {\n\t\t\tthrow new TypeError('not a valid argument for EpubCFI');\n\t\t}\n\n\t};\n\n\tcheckType(cfi) {\n\n\t\tif (this.isCfiString(cfi)) {\n\t\t\treturn 'string';\n\t\t// Is a range object\n\t\t} else if (typeof cfi === 'object' && (type(cfi) === \"Range\" || typeof(cfi.startContainer) != \"undefined\")){\n\t\t\treturn 'range';\n\t\t} else if (typeof cfi === 'object' && typeof(cfi.nodeType) != \"undefined\" ){ // || typeof cfi === 'function'\n\t\t\treturn 'node';\n\t\t} else if (typeof cfi === 'object' && cfi instanceof EpubCFI){\n\t\t\treturn 'EpubCFI';\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tparse(cfiStr) {\n\t\tvar cfi = {\n\t\t\t\tspinePos: -1,\n\t\t\t\trange: false,\n\t\t\t\tbase: {},\n\t\t\t\tpath: {},\n\t\t\t\tstart: null,\n\t\t\t\tend: null\n\t\t\t};\n\t\tvar baseComponent, pathComponent, range;\n\n\t\tif(typeof cfiStr !== \"string\") {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tif(cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length-1] === \")\") {\n\t\t\t// Remove intial epubcfi( and ending )\n\t\t\tcfiStr = cfiStr.slice(8, cfiStr.length-1);\n\t\t}\n\n\t\tbaseComponent = this.getChapterComponent(cfiStr);\n\n\t\t// Make sure this is a valid cfi or return\n\t\tif(!baseComponent) {\n\t\t\treturn {spinePos: -1};\n\t\t}\n\n\t\tcfi.base = this.parseComponent(baseComponent);\n\n\t\tpathComponent = this.getPathComponent(cfiStr);\n\t\tcfi.path = this.parseComponent(pathComponent);\n\n\t\trange = this.getRange(cfiStr);\n\n\t\tif(range) {\n\t\t\tcfi.range = true;\n\t\t\tcfi.start = this.parseComponent(range[0]);\n\t\t\tcfi.end = this.parseComponent(range[1]);\n\t\t}\n\n\t\t// Get spine node position\n\t\t// cfi.spineSegment = cfi.base.steps[1];\n\n\t\t// Chapter segment is always the second step\n\t\tcfi.spinePos = cfi.base.steps[1].index;\n\n\t\treturn cfi;\n\t};\n\n\tparseComponent(componentStr){\n\t\tvar component = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar parts = componentStr.split(':');\n\t\tvar steps = parts[0].split('/');\n\t\tvar terminal;\n\n\t\tif(parts.length > 1) {\n\t\t\tterminal = parts[1];\n\t\t\tcomponent.terminal = this.parseTerminal(terminal);\n\t\t}\n\n\t\tif (steps[0] === '') {\n\t\t\tsteps.shift(); // Ignore the first slash\n\t\t}\n\n\t\tcomponent.steps = steps.map(function(step){\n\t\t\treturn this.parseStep(step);\n\t\t}.bind(this));\n\n\t\treturn component;\n\t};\n\n\tparseStep(stepStr){\n\t\tvar type, num, index, has_brackets, id;\n\n\t\thas_brackets = stepStr.match(/\\[(.*)\\]/);\n\t\tif(has_brackets && has_brackets[1]){\n\t\t\tid = has_brackets[1];\n\t\t}\n\n\t\t//-- Check if step is a text node or element\n\t\tnum = parseInt(stepStr);\n\n\t\tif(isNaN(num)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(num % 2 === 0) { // Even = is an element\n\t\t\ttype = \"element\";\n\t\t\tindex = num / 2 - 1;\n\t\t} else {\n\t\t\ttype = \"text\";\n\t\t\tindex = (num - 1 ) / 2;\n\t\t}\n\n\t\treturn {\n\t\t\t\"type\" : type,\n\t\t\t'index' : index,\n\t\t\t'id' : id || null\n\t\t};\n\t};\n\n\tparseTerminal(termialStr){\n\t\tvar characterOffset, textLocationAssertion;\n\t\tvar assertion = termialStr.match(/\\[(.*)\\]/);\n\n\t\tif(assertion && assertion[1]){\n\t\t\tcharacterOffset = parseInt(termialStr.split('[')[0]) || null;\n\t\t\ttextLocationAssertion = assertion[1];\n\t\t} else {\n\t\t\tcharacterOffset = parseInt(termialStr) || null;\n\t\t}\n\n\t\treturn {\n\t\t\t'offset': characterOffset,\n\t\t\t'assertion': textLocationAssertion\n\t\t};\n\n\t};\n\n\tgetChapterComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\treturn indirection[0];\n\t};\n\n\tgetPathComponent(cfiStr) {\n\n\t\tvar indirection = cfiStr.split(\"!\");\n\n\t\tif(indirection[1]) {\n\t\t\tlet ranges = indirection[1].split(',');\n\t\t\treturn ranges[0];\n\t\t}\n\n\t};\n\n\tgetRange(cfiStr) {\n\n\t\tvar ranges = cfiStr.split(\",\");\n\n\t\tif(ranges.length === 3){\n\t\t\treturn [\n\t\t\t\tranges[1],\n\t\t\t\tranges[2]\n\t\t\t];\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetCharecterOffsetComponent(cfiStr) {\n\t\tvar splitStr = cfiStr.split(\":\");\n\t\treturn splitStr[1] || '';\n\t};\n\n\tjoinSteps(steps) {\n\t\tif(!steps) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn steps.map(function(part){\n\t\t\tvar segment = '';\n\n\t\t\tif(part.type === 'element') {\n\t\t\t\tsegment += (part.index + 1) * 2;\n\t\t\t}\n\n\t\t\tif(part.type === 'text') {\n\t\t\t\tsegment += 1 + (2 * part.index); // TODO: double check that this is odd\n\t\t\t}\n\n\t\t\tif(part.id) {\n\t\t\t\tsegment += \"[\" + part.id + \"]\";\n\t\t\t}\n\n\t\t\treturn segment;\n\n\t\t}).join('/');\n\n\t};\n\n\tsegmentString(segment) {\n\t\tvar segmentString = '/';\n\n\t\tsegmentString += this.joinSteps(segment.steps);\n\n\t\tif(segment.terminal && segment.terminal.offset != null){\n\t\t\tsegmentString += ':' + segment.terminal.offset;\n\t\t}\n\n\t\tif(segment.terminal && segment.terminal.assertion != null){\n\t\t\tsegmentString += '[' + segment.terminal.assertion + ']';\n\t\t}\n\n\t\treturn segmentString;\n\t};\n\n\ttoString() {\n\t\tvar cfiString = 'epubcfi(';\n\n\t\tcfiString += this.segmentString(this.base);\n\n\t\tcfiString += '!';\n\t\tcfiString += this.segmentString(this.path);\n\n\t\t// Add Range, if present\n\t\tif(this.start) {\n\t\t\tcfiString += ',';\n\t\t\tcfiString += this.segmentString(this.start);\n\t\t}\n\n\t\tif(this.end) {\n\t\t\tcfiString += ',';\n\t\t\tcfiString += this.segmentString(this.end);\n\t\t}\n\n\t\tcfiString += \")\";\n\n\t\treturn cfiString;\n\t};\n\n\tcompare(cfiOne, cfiTwo) {\n\t\tvar stepsA, stepsB;\n\t\tvar terminalA, terminalB;\n\n\t\tif(typeof cfiOne === 'string') {\n\t\t\tcfiOne = new EpubCFI(cfiOne);\n\t\t}\n\t\tif(typeof cfiTwo === 'string') {\n\t\t\tcfiTwo = new EpubCFI(cfiTwo);\n\t\t}\n\t\t// Compare Spine Positions\n\t\tif(cfiOne.spinePos > cfiTwo.spinePos) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(cfiOne.spinePos < cfiTwo.spinePos) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (cfiOne.range) {\n\t\t\tstepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\n\t\t\tterminalA = cfiOne.start.terminal;\n\t\t} else {\n\t\t\tstepsA = cfiOne.path.steps;\n\t\t\tterminalA = cfiOne.path.terminal;\n\t\t}\n\n\t\tif (cfiTwo.range) {\n\t\t\tstepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\n\t\t\tterminalB = cfiTwo.start.terminal;\n\t\t} else {\n\t\t\tstepsB = cfiTwo.path.steps;\n\t\t\tterminalB = cfiTwo.path.terminal;\n\t\t}\n\n\t\t// Compare Each Step in the First item\n\t\tfor (var i = 0; i < stepsA.length; i++) {\n\t\t\tif(!stepsA[i]) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif(!stepsB[i]) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index > stepsB[i].index) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif(stepsA[i].index < stepsB[i].index) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t// Otherwise continue checking\n\t\t}\n\n\t\t// All steps in First equal to Second and First is Less Specific\n\t\tif(stepsA.length < stepsB.length) {\n\t\t\treturn 1;\n\t\t}\n\n\t\t// Compare the charecter offset of the text node\n\t\tif(terminalA.offset > terminalB.offset) {\n\t\t\treturn 1;\n\t\t}\n\t\tif(terminalA.offset < terminalB.offset) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// CFI's are equal\n\t\treturn 0;\n\t};\n\n\tstep(node) {\n\t\tvar nodeType = (node.nodeType === TEXT_NODE) ? 'text' : 'element';\n\n\t\treturn {\n\t\t\t'id' : node.id,\n\t\t\t'tagName' : node.tagName,\n\t\t\t'type' : nodeType,\n\t\t\t'index' : this.position(node)\n\t\t};\n\t};\n\n\tfilteredStep(node, ignoreClass) {\n\t\tvar filteredNode = this.filter(node, ignoreClass);\n\t\tvar nodeType;\n\n\t\t// Node filtered, so ignore\n\t\tif (!filteredNode) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise add the filter node in\n\t\tnodeType = (filteredNode.nodeType === TEXT_NODE) ? 'text' : 'element';\n\n\t\treturn {\n\t\t\t'id' : filteredNode.id,\n\t\t\t'tagName' : filteredNode.tagName,\n\t\t\t'type' : nodeType,\n\t\t\t'index' : this.filteredPosition(filteredNode, ignoreClass)\n\t\t};\n\t};\n\n\tpathTo(node, offset, ignoreClass) {\n\t\tvar segment = {\n\t\t\tsteps: [],\n\t\t\tterminal: {\n\t\t\t\toffset: null,\n\t\t\t\tassertion: null\n\t\t\t}\n\t\t};\n\t\tvar currentNode = node;\n\t\tvar step;\n\n\t\twhile(currentNode && currentNode.parentNode &&\n\t\t\t\t\tcurrentNode.parentNode.nodeType != DOCUMENT_NODE) {\n\n\t\t\tif (ignoreClass) {\n\t\t\t\tstep = this.filteredStep(currentNode, ignoreClass);\n\t\t\t} else {\n\t\t\t\tstep = this.step(currentNode);\n\t\t\t}\n\n\t\t\tif (step) {\n\t\t\t\tsegment.steps.unshift(step);\n\t\t\t}\n\n\t\t\tcurrentNode = currentNode.parentNode;\n\n\t\t}\n\n\t\tif (offset != null && offset >= 0) {\n\n\t\t\tsegment.terminal.offset = offset;\n\n\t\t\t// Make sure we are getting to a textNode if there is an offset\n\t\t\tif(segment.steps[segment.steps.length-1].type != \"text\") {\n\t\t\t\tsegment.steps.push({\n\t\t\t\t\t'type' : \"text\",\n\t\t\t\t\t'index' : 0\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\n\t\treturn segment;\n\t}\n\n\tequalStep(stepA, stepB) {\n\t\tif (!stepA || !stepB) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif(stepA.index === stepB.index &&\n\t\t\t stepA.id === stepB.id &&\n\t\t\t stepA.type === stepB.type) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tfromRange(range, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\t\trange: false,\n\t\t\t\tbase: {},\n\t\t\t\tpath: {},\n\t\t\t\tstart: null,\n\t\t\t\tend: null\n\t\t\t};\n\n\t\tvar start = range.startContainer;\n\t\tvar end = range.endContainer;\n\n\t\tvar startOffset = range.startOffset;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar needsIgnoring = false;\n\n\t\tif (ignoreClass) {\n\t\t\t// Tell pathTo if / what to ignore\n\t\t\tneedsIgnoring = (start.ownerDocument.querySelector('.' + ignoreClass) != null);\n\t\t}\n\n\n\t\tif (typeof base === 'string') {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === 'object') {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\t\t\tcfi.path = this.pathTo(start, startOffset, ignoreClass);\n\t\t} else {\n\t\t\tcfi.range = true;\n\n\t\t\tif (needsIgnoring) {\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.start = this.pathTo(start, startOffset, ignoreClass);\n\t\t\tif (needsIgnoring) {\n\t\t\t\tendOffset = this.patchOffset(end, endOffset, ignoreClass);\n\t\t\t}\n\n\t\t\tcfi.end = this.pathTo(end, endOffset, ignoreClass);\n\n\t\t\t// Create a new empty path\n\t\t\tcfi.path = {\n\t\t\t\tsteps: [],\n\t\t\t\tterminal: null\n\t\t\t};\n\n\t\t\t// Push steps that are shared between start and end to the common path\n\t\t\tvar len = cfi.start.steps.length;\n\t\t\tvar i;\n\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\n\t\t\t\t\tif(i === len-1) {\n\t\t\t\t\t\t// Last step is equal, check terminals\n\t\t\t\t\t\tif(cfi.start.terminal === cfi.end.terminal) {\n\t\t\t\t\t\t\t// CFI's are equal\n\t\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t\t\t// Not a range\n\t\t\t\t\t\t\tcfi.range = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tcfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\n\t\t\tcfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length);\n\n\t\t\t// TODO: Add Sanity check to make sure that the end if greater than the start\n\t\t}\n\n\t\treturn cfi;\n\t}\n\n\tfromNode(anchor, base, ignoreClass) {\n\t\tvar cfi = {\n\t\t\t\trange: false,\n\t\t\t\tbase: {},\n\t\t\t\tpath: {},\n\t\t\t\tstart: null,\n\t\t\t\tend: null\n\t\t\t};\n\n\t\tvar needsIgnoring = false;\n\n\t\tif (ignoreClass) {\n\t\t\t// Tell pathTo if / what to ignore\n\t\t\tneedsIgnoring = (anchor.ownerDocument.querySelector('.' + ignoreClass) != null);\n\t\t}\n\n\t\tif (typeof base === 'string') {\n\t\t\tcfi.base = this.parseComponent(base);\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\n\t\t} else if (typeof base === 'object') {\n\t\t\tcfi.base = base;\n\t\t}\n\n\t\tcfi.path = this.pathTo(anchor, null, ignoreClass);\n\n\t\treturn cfi;\n\t};\n\n\tfilter(anchor, ignoreClass) {\n\t\tvar needsIgnoring;\n\t\tvar sibling; // to join with\n\t\tvar parent, previousSibling, nextSibling;\n\t\tvar isText = false;\n\n\t\tif (anchor.nodeType === TEXT_NODE) {\n\t\t\tisText = true;\n\t\t\tparent = anchor.parentNode;\n\t\t\tneedsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\n\t\t} else {\n\t\t\tisText = false;\n\t\t\tneedsIgnoring = anchor.classList.contains(ignoreClass);\n\t\t}\n\n\t\tif (needsIgnoring && isText) {\n\t\t\tpreviousSibling = parent.previousSibling;\n\t\t\tnextSibling = parent.nextSibling;\n\n\t\t\t// If the sibling is a text node, join the nodes\n\t\t\tif (previousSibling && previousSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = previousSibling;\n\t\t\t} else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\n\t\t\t\tsibling = nextSibling;\n\t\t\t}\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t} else {\n\t\t\t\t// Parent will be ignored on next step\n\t\t\t\treturn anchor;\n\t\t\t}\n\n\t\t} else if (needsIgnoring && !isText) {\n\t\t\t// Otherwise just skip the element node\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// No need to filter\n\t\t\treturn anchor;\n\t\t}\n\n\t};\n\n\tpatchOffset(anchor, offset, ignoreClass) {\n\t\tvar needsIgnoring;\n\t\tvar sibling;\n\n\t\tif (anchor.nodeType != TEXT_NODE) {\n\t\t\tconsole.error(\"Anchor must be a text node\");\n\t\t\treturn;\n\t\t}\n\n\t\tvar curr = anchor;\n\t\tvar totalOffset = offset;\n\n\t\t// If the parent is a ignored node, get offset from it's start\n\t\tif (anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\tcurr = anchor.parentNode;\n\t\t}\n\n\t\twhile (curr.previousSibling) {\n\t\t\tif(curr.previousSibling.nodeType === ELEMENT_NODE) {\n\t\t\t\t// Originally a text node, so join\n\t\t\t\tif(curr.previousSibling.classList.contains(ignoreClass)){\n\t\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t\t} else {\n\t\t\t\t\tbreak; // Normal node, dont join\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling is a text node, join the nodes\n\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\n\t\t\t}\n\n\t\t\tcurr = curr.previousSibling;\n\t\t}\n\n\t\treturn totalOffset;\n\n\t};\n\n\tnormalizedMap(children, nodeType, ignoreClass) {\n\t\tvar output = {};\n\t\tvar prevIndex = -1;\n\t\tvar i, len = children.length;\n\t\tvar currNodeType;\n\t\tvar prevNodeType;\n\n\t\tfor (i = 0; i < len; i++) {\n\n\t\t\tcurrNodeType = children[i].nodeType;\n\n\t\t\t// Check if needs ignoring\n\t\t\tif (currNodeType === ELEMENT_NODE &&\n\t\t\t\t\tchildren[i].classList.contains(ignoreClass)) {\n\t\t\t\tcurrNodeType = TEXT_NODE;\n\t\t\t}\n\n\t\t\tif (i > 0 &&\n\t\t\t\t\tcurrNodeType === TEXT_NODE &&\n\t\t\t\t\tprevNodeType === TEXT_NODE) {\n\t\t\t\t// join text nodes\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t} else if (nodeType === currNodeType){\n\t\t\t\tprevIndex = prevIndex + 1;\n\t\t\t\toutput[i] = prevIndex;\n\t\t\t}\n\n\t\t\tprevNodeType = currNodeType;\n\n\t\t}\n\n\t\treturn output;\n\t};\n\n\tposition(anchor) {\n\t\tvar children, index, map;\n\t\tvar childNodes, node;\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tif (!children) {\n\t\t\t\tchildren = children(anchor.parentNode);\n\t\t\t}\n\t\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\t\t} else {\n\t\t\tchildren = this.textNodes(anchor.parentNode);\n\t\t\tindex = children.indexOf(anchor);\n\t\t}\n\n\t\treturn index;\n\t};\n\n\tfilteredPosition(anchor, ignoreClass) {\n\t\tvar children, index, map;\n\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\n\t\t\tchildren = anchor.parentNode.children;\n\t\t\tmap = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\n\t\t} else {\n\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t// Inside an ignored node\n\t\t\tif(anchor.parentNode.classList.contains(ignoreClass)) {\n\t\t\t\tanchor = anchor.parentNode;\n\t\t\t\tchildren = anchor.parentNode.childNodes;\n\t\t\t}\n\t\t\tmap = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\t}\n\n\n\t\tindex = Array.prototype.indexOf.call(children, anchor);\n\n\t\treturn map[index];\n\t};\n\n\tstepsToXpath(steps) {\n\t\tvar xpath = [\".\", \"*\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\txpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\txpath.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\txpath.push(\"*[\" + position + \"]\");\n\t\t\t}\n\t\t});\n\n\t\treturn xpath.join(\"/\");\n\t};\n\n\n\t/*\n\n\tTo get the last step if needed:\n\n\t// Get the terminal step\n\tlastStep = steps[steps.length-1];\n\t// Get the query string\n\tquery = this.stepsToQuery(steps);\n\t// Find the containing element\n\tstartContainerParent = doc.querySelector(query);\n\t// Find the text node within that element\n\tif(startContainerParent && lastStep.type == \"text\") {\n\t\tcontainer = startContainerParent.childNodes[lastStep.index];\n\t}\n\t*/\n\tstepsToQuerySelector(steps) {\n\t\tvar query = [\"html\"];\n\n\t\tsteps.forEach(function(step){\n\t\t\tvar position = step.index + 1;\n\n\t\t\tif(step.id){\n\t\t\t\tquery.push(\"#\" + step.id);\n\t\t\t} else if(step.type === \"text\") {\n\t\t\t\t// unsupported in querySelector\n\t\t\t\t// query.push(\"text()[\" + position + \"]\");\n\t\t\t} else {\n\t\t\t\tquery.push(\"*:nth-child(\" + position + \")\");\n\t\t\t}\n\t\t});\n\n\t\treturn query.join(\">\");\n\n\t};\n\n\ttextNodes(container, ignoreClass) {\n\t\treturn Array.prototype.slice.call(container.childNodes).\n\t\t\tfilter(function (node) {\n\t\t\t\tif (node.nodeType === TEXT_NODE) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (ignoreClass && node.classList.contains(ignoreClass)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t};\n\n\twalkToNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container = doc.documentElement;\n\t\tvar step;\n\t\tvar len = steps.length;\n\t\tvar i;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tstep = steps[i];\n\n\t\t\tif(step.type === \"element\") {\n\t\t\t\tcontainer = container.children[step.index];\n\t\t\t} else if(step.type === \"text\"){\n\t\t\t\tcontainer = this.textNodes(container, ignoreClass)[step.index];\n\t\t\t}\n\n\t\t};\n\n\t\treturn container;\n\t};\n\n\tfindNode(steps, _doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar container;\n\t\tvar xpath;\n\n\t\tif(!ignoreClass && typeof doc.evaluate != 'undefined') {\n\t\t\txpath = this.stepsToXpath(steps);\n\t\t\tcontainer = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n\t\t} else if(ignoreClass) {\n\t\t\tcontainer = this.walkToNode(steps, doc, ignoreClass);\n\t\t} else {\n\t\t\tcontainer = this.walkToNode(steps, doc);\n\t\t}\n\n\t\treturn container;\n\t};\n\n\tfixMiss(steps, offset, _doc, ignoreClass) {\n\t\tvar container = this.findNode(steps.slice(0,-1), _doc, ignoreClass);\n\t\tvar children = container.childNodes;\n\t\tvar map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n\t\tvar i;\n\t\tvar child;\n\t\tvar len;\n\t\tvar childIndex;\n\t\tvar lastStepIndex = steps[steps.length-1].index;\n\n\t\tfor (var childIndex in map) {\n\t\t\tif (!map.hasOwnProperty(childIndex)) return;\n\n\t\t\tif(map[childIndex] === lastStepIndex) {\n\t\t\t\tchild = children[childIndex];\n\t\t\t\tlen = child.textContent.length;\n\t\t\t\tif(offset > len) {\n\t\t\t\t\toffset = offset - len;\n\t\t\t\t} else {\n\t\t\t\t\tif (child.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tcontainer = child.childNodes[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainer = child;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tcontainer: container,\n\t\t\toffset: offset\n\t\t};\n\n\t};\n\n\ttoRange(_doc, ignoreClass) {\n\t\tvar doc = _doc || document;\n\t\tvar range = doc.createRange();\n\t\tvar start, end, startContainer, endContainer;\n\t\tvar cfi = this;\n\t\tvar startSteps, endSteps;\n\t\tvar needsIgnoring = ignoreClass ? (doc.querySelector('.' + ignoreClass) != null) : false;\n\t\tvar missed;\n\n\t\tif (cfi.range) {\n\t\t\tstart = cfi.start;\n\t\t\tstartSteps = cfi.path.steps.concat(start.steps);\n\t\t\tstartContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t\tend = cfi.end;\n\t\t\tendSteps = cfi.path.steps.concat(end.steps);\n\t\t\tendContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\n\t\t} else {\n\t\t\tstart = cfi.path;\n\t\t\tstartSteps = cfi.path.steps;\n\t\t\tstartContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\n\t\t}\n\n\t\tif(startContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(start.terminal.offset != null) {\n\t\t\t\t\trange.setStart(startContainer, start.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setStart(startContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setStart(missed.container, missed.offset);\n\t\t\t}\n\t\t} else {\n\t\t\t// No start found\n\t\t\treturn null;\n\t\t}\n\n\t\tif (endContainer) {\n\t\t\ttry {\n\n\t\t\t\tif(end.terminal.offset != null) {\n\t\t\t\t\trange.setEnd(endContainer, end.terminal.offset);\n\t\t\t\t} else {\n\t\t\t\t\trange.setEnd(endContainer, 0);\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tmissed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n\t\t\t\trange.setEnd(missed.container, missed.offset);\n\t\t\t}\n\t\t}\n\n\n\t\t// doc.defaultView.getSelection().addRange(range);\n\t\treturn range;\n\t};\n\n\t// is a cfi string, should be wrapped with \"epubcfi()\"\n\tisCfiString(str) {\n\t\tif(typeof str === 'string' &&\n\t\t\t\tstr.indexOf(\"epubcfi(\") === 0 &&\n\t\t\t\tstr[str.length-1] === \")\") {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgenerateChapterComponent(_spineNodeIndex, _pos, id) {\n\t\tvar pos = parseInt(_pos),\n\t\t\tspineNodeIndex = _spineNodeIndex + 1,\n\t\t\tcfi = '/'+spineNodeIndex+'/';\n\n\t\tcfi += (pos + 1) * 2;\n\n\t\tif(id) {\n\t\t\tcfi += \"[\" + id + \"]\";\n\t\t}\n\n\t\treturn cfi;\n\t};\n}\n\nexport default EpubCFI;\n\n\n\n// WEBPACK FOOTER //\n// ./src/epubcfi.js","import path from 'path-webpack';\n\nclass Path {\n\tconstructor(pathString) {\n\t\tvar protocol;\n\t\tvar parsed;\n\n\t\tprotocol = pathString.indexOf('://');\n\t\tif (protocol > -1) {\n\t\t\tpathString = new URL(pathString).pathname;\n\t\t}\n\n\t\tparsed = this.parse(pathString);\n\n\t\tthis.path = pathString;\n\n\t\tif (this.isDirectory(pathString)) {\n\t\t\tthis.directory = pathString;\n\t\t} else {\n\t\t\tthis.directory = parsed.dir + \"/\";\n\t\t}\n\n\t\tthis.filename = parsed.base;\n\t\tthis.extension = parsed.ext.slice(1);\n\n\t}\n\n\tparse (what) {\n\t\treturn path.parse(what);\n\t};\n\n\tisAbsolute (what) {\n\t\treturn path.isAbsolute(what || this.path);\n\t};\n\n\tisDirectory (what) {\n\t\treturn (what.charAt(what.length-1) === '/');\n\t};\n\n\tresolve (what) {\n\t\treturn path.resolve(this.directory, what);\n\t};\n\n\trelative (what) {\n\t\treturn path.relative(this.directory, what);\n\t};\n\n\tsplitPath(filename) {\n\t\treturn this.splitPathRe.exec(filename).slice(1);\n\t};\n\n\ttoString () {\n\t\treturn this.path;\n\t};\n}\n\nexport default Path\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/path.js","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/event-emitter/index.js\n// module id = 3\n// module chunks = 0","import Path from './path'\nimport path from 'path-webpack';\n\n/**\n * creates a uri object\n * @param\t{string} urlString\ta url string (relative or absolute)\n * @param\t{[string]} baseString optional base for the url,\n * default to window.location.href\n * @return {object} url\n */\n\nclass Url {\n\tconstructor(urlString, baseString) {\n\t\tvar absolute = (urlString.indexOf('://') > -1);\n\t\tvar pathname = urlString;\n\n\t\tthis.Url = undefined;\n\t\tthis.href = urlString;\n\t\tthis.protocol = \"\";\n\t\tthis.origin = \"\";\n\t\tthis.fragment = \"\";\n\t\tthis.search = \"\";\n\t\tthis.base = baseString;\n\n\t\tif (!absolute && (typeof(baseString) !== \"string\")) {\n\t\t\tthis.base = window && window.location.href;\n\t\t}\n\n\t\t// URL Polyfill doesn't throw an error if base is empty\n\t\tif (absolute || this.base) {\n\t\t\ttry {\n\t\t\t\tif (this.base) { // Safari doesn't like an undefined base\n\t\t\t\t\tthis.Url = new URL(urlString, this.base);\n\t\t\t\t} else {\n\t\t\t\t\tthis.Url = new URL(urlString);\n\t\t\t\t}\n\t\t\t\tthis.href = this.Url.href;\n\n\t\t\t\tthis.protocol = this.Url.protocol;\n\t\t\t\tthis.origin = this.Url.origin;\n\t\t\t\tthis.fragment = this.Url.fragment;\n\t\t\t\tthis.search = this.Url.search;\n\n\t\t\t\tpathname = this.Url.pathname;\n\t\t\t} catch (e) {\n\t\t\t\t// Skip URL parsing\n\t\t\t\tthis.Url = undefined;\n\t\t\t}\n\t\t}\n\n\t\tthis.Path = new Path(pathname);\n\t\tthis.directory = this.Path.directory;\n\t\tthis.filename = this.Path.filename;\n\t\tthis.extension = this.Path.extension;\n\n\t}\n\n\tpath () {\n\t\treturn this.Path;\n\t};\n\n\tresolve (what) {\n\t\tvar isAbsolute = (what.indexOf('://') > -1);\n\t\tvar fullpath;\n\n\t\tif (isAbsolute) {\n\t\t\treturn what;\n\t\t}\n\n\t\tfullpath = path.resolve(this.directory, what);\n\t\treturn this.origin + fullpath;\n\t};\n\n\trelative (what) {\n\t\treturn path.relative(what, this.directory);\n\t};\n\n\ttoString () {\n\t\treturn this.href;\n\t};\n}\n\nexport default Url\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/url.js","'use strict';\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/path-webpack/path.js\n// module id = 5\n// module chunks = 0","/**\n * Hooks allow for injecting functions that must all complete in order before finishing\n * They will execute in parallel but all must finish before continuing\n * Functions may return a promise if they are asycn.\n * @param {any} context scope of this\n * @example this.content = new EPUBJS.Hook(this);\n */\nclass Hook {\n\tconstructor(context){\n\t\tthis.context = context || this;\n\t\tthis.hooks = [];\n\t};\n\n\t/**\n\t * Adds a function to be run before a hook completes\n\t * @example this.content.register(function(){...});\n\t */\n\tregister(){\n\t\tfor(var i = 0; i < arguments.length; ++i) {\n\t\t\tif (typeof arguments[i]  === \"function\") {\n\t\t\t\tthis.hooks.push(arguments[i]);\n\t\t\t} else {\n\t\t\t\t// unpack array\n\t\t\t\tfor(var j = 0; j < arguments[i].length; ++j) {\n\t\t\t\t\tthis.hooks.push(arguments[i][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Triggers a hook to run all functions\n\t * @example this.content.trigger(args).then(function(){...});\n\t */\n\ttrigger(){\n\t\tvar args = arguments;\n\t\tvar context = this.context;\n\t\tvar promises = [];\n\n\t\tthis.hooks.forEach(function(task, i) {\n\t\t\tvar executing = task.apply(context, args);\n\n\t\t\tif(executing && typeof executing[\"then\"] === \"function\") {\n\t\t\t\t// Task is a function that returns a promise\n\t\t\t\tpromises.push(executing);\n\t\t\t}\n\t\t\t// Otherwise Task resolves immediately, continue\n\t\t});\n\n\n\t\treturn Promise.all(promises);\n\t};\n\n\t// Adds a function to be run before a hook completes\n\tlist(){\n\t\treturn this.hooks;\n\t};\n\n\tclear(){\n\t\treturn this.hooks = [];\n\t};\n}\nexport default Hook;\n\n\n\n// WEBPACK FOOTER //\n// ./src/hook.js","import EpubCFI from './epubcfi';\n\nclass Mapping {\n\tconstructor(layout) {\n\t\tthis.layout = layout;\n\t};\n\n\tsection(view) {\n\t\tvar ranges = this.findRanges(view);\n\t\tvar map = this.rangeListToCfiList(view.section.cfiBase, ranges);\n\n\t\treturn map;\n\t};\n\n\tpage(contents, cfiBase, start, end) {\n\t\tvar root = contents && contents.document ? contents.document.body : false;\n\n\t\tif (!root) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.rangePairToCfiPair(cfiBase, {\n\t\t\tstart: this.findStart(root, start, end),\n\t\t\tend: this.findEnd(root, start, end)\n\t\t});\n\t};\n\n\twalk(root, func) {\n\t\t//var treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT + NodeFilter.SHOW_TEXT, null, false);\n\t\tvar treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {\n\t\t\t\tacceptNode: function (node) {\n\t\t\t\t\t\tif ( node.data.trim().length > 0 ) {\n\t\t\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t}, false);\n\t\tvar node;\n\t\tvar result;\n\t\twhile ((node = treeWalker.nextNode())) {\n\t\t\tresult = func(node);\n\t\t\tif(result) break;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tfindRanges(view){\n\t\tvar columns = [];\n\t\tvar scrollWidth = view.contents.scrollWidth();\n\t\tvar count = this.layout.count(scrollWidth);\n\t\tvar column = this.layout.column;\n\t\tvar gap = this.layout.gap;\n\t\tvar start, end;\n\n\t\tfor (var i = 0; i < count.pages; i++) {\n\t\t\tstart = (column + gap) * i;\n\t\t\tend = (column * (i+1)) + (gap * i);\n\t\t\tcolumns.push({\n\t\t\t\tstart: this.findStart(view.document.body, start, end),\n\t\t\t\tend: this.findEnd(view.document.body, start, end)\n\t\t\t});\n\t\t}\n\n\t\treturn columns;\n\t};\n\n\tfindStart(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar found;\n\t\tvar $prev = root;\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, function(node){\n\t\t\t\tvar left, right;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\n\t\t\t\tif(node.nodeType == Node.TEXT_NODE){\n\t\t\t\t\telRange = document.createRange();\n\t\t\t\t\telRange.selectNodeContents(node);\n\t\t\t\t\telPos = elRange.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\telPos = node.getBoundingClientRect();\n\t\t\t\t}\n\n\t\t\t\tleft = elPos.left;\n\t\t\t\tright = elPos.right;\n\n\t\t\t\tif( left >= start && left <= end ) {\n\t\t\t\t\treturn node;\n\t\t\t\t} else if (right > start) {\n\t\t\t\t\treturn node;\n\t\t\t\t} else {\n\t\t\t\t\t$prev = node;\n\t\t\t\t\tstack.push(node);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\tif(found) {\n\t\t\t\treturn this.findTextStartRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// Return last element\n\t\treturn this.findTextStartRange($prev, start, end);\n\t};\n\n\tfindEnd(root, start, end){\n\t\tvar stack = [root];\n\t\tvar $el;\n\t\tvar $prev = root;\n\t\tvar found;\n\n\t\twhile (stack.length) {\n\n\t\t\t$el = stack.shift();\n\n\t\t\tfound = this.walk($el, function(node){\n\n\t\t\t\tvar left, right;\n\t\t\t\tvar elPos;\n\t\t\t\tvar elRange;\n\n\n\t\t\t\tif(node.nodeType == Node.TEXT_NODE){\n\t\t\t\t\telRange = document.createRange();\n\t\t\t\t\telRange.selectNodeContents(node);\n\t\t\t\t\telPos = elRange.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\telPos = node.getBoundingClientRect();\n\t\t\t\t}\n\n\t\t\t\tleft = elPos.left;\n\t\t\t\tright = elPos.right;\n\n\t\t\t\tif(left > end && $prev) {\n\t\t\t\t\treturn $prev;\n\t\t\t\t} else if(right > end) {\n\t\t\t\t\treturn node;\n\t\t\t\t} else {\n\t\t\t\t\t$prev = node;\n\t\t\t\t\tstack.push(node);\n\t\t\t\t}\n\n\t\t\t});\n\n\n\t\t\tif(found){\n\t\t\t\treturn this.findTextEndRange(found, start, end);\n\t\t\t}\n\n\t\t}\n\n\t\t// end of chapter\n\t\treturn this.findTextEndRange($prev, start, end);\n\t};\n\n\n\tfindTextStartRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar prev;\n\t\tvar range;\n\t\tvar pos;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif( pos.left >= start ) {\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tprev = range;\n\n\t\t}\n\n\t\treturn ranges[0];\n\t};\n\n\tfindTextEndRange(node, start, end){\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\n\t\tvar prev;\n\t\tvar range;\n\t\tvar pos;\n\n\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\trange = ranges[i];\n\n\t\t\tpos = range.getBoundingClientRect();\n\n\t\t\tif(pos.left > end && prev) {\n\t\t\t\treturn prev;\n\t\t\t} else if(pos.right > end) {\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tprev = range;\n\n\t\t}\n\n\t\t// Ends before limit\n\t\treturn ranges[ranges.length-1];\n\n\t};\n\n\tsplitTextNodeIntoRanges(node, _splitter){\n\t\tvar ranges = [];\n\t\tvar textContent = node.textContent || \"\";\n\t\tvar text = textContent.trim();\n\t\tvar range;\n\t\tvar rect;\n\t\tvar list;\n\t\tvar doc = node.ownerDocument;\n\t\tvar splitter = _splitter || \" \";\n\n\t\tvar pos = text.indexOf(splitter);\n\n\t\tif(pos === -1 || node.nodeType != Node.TEXT_NODE) {\n\t\t\trange = doc.createRange();\n\t\t\trange.selectNodeContents(node);\n\t\t\treturn [range];\n\t\t}\n\n\t\trange = doc.createRange();\n\t\trange.setStart(node, 0);\n\t\trange.setEnd(node, pos);\n\t\tranges.push(range);\n\t\trange = false;\n\n\t\twhile ( pos != -1 ) {\n\n\t\t\tpos = text.indexOf(splitter, pos + 1);\n\t\t\tif(pos > 0) {\n\n\t\t\t\tif(range) {\n\t\t\t\t\trange.setEnd(node, pos);\n\t\t\t\t\tranges.push(range);\n\t\t\t\t}\n\n\t\t\t\trange = doc.createRange();\n\t\t\t\trange.setStart(node, pos+1);\n\t\t\t}\n\t\t}\n\n\t\tif(range) {\n\t\t\trange.setEnd(node, text.length);\n\t\t\tranges.push(range);\n\t\t}\n\n\t\treturn ranges;\n\t};\n\n\n\n\trangePairToCfiPair(cfiBase, rangePair){\n\n\t\tvar startRange = rangePair.start;\n\t\tvar endRange = rangePair.end;\n\n\t\tstartRange.collapse(true);\n\t\tendRange.collapse(true);\n\n\t\t// startCfi = section.cfiFromRange(startRange);\n\t\t// endCfi = section.cfiFromRange(endRange);\n\t\tlet startCfi = new EpubCFI(startRange, cfiBase).toString();\n\t\tlet endCfi = new EpubCFI(endRange, cfiBase).toString();\n\n\t\treturn {\n\t\t\tstart: startCfi,\n\t\t\tend: endCfi\n\t\t};\n\n\t};\n\n\trangeListToCfiList(cfiBase, columns){\n\t\tvar map = [];\n\t\tvar rangePair, cifPair;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tcifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\n\n\t\t\tmap.push(cifPair);\n\n\t\t}\n\n\t\treturn map;\n\t};\n}\n\nexport default Mapping;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mapping.js","import {defer, requestAnimationFrame} from './utils/core';\n\n/**\n * Queue for handling tasks one at a time\n * @class\n * @param {scope} context what this will resolve to in the tasks\n */\nclass Queue {\n\tconstructor(context){\n\t\tthis._q = [];\n\t\tthis.context = context;\n\t\tthis.tick = requestAnimationFrame;\n\t\tthis.running = false;\n\t\tthis.paused = false;\n\t};\n\n\t/**\n\t * Add an item to the queue\n\t * @return {Promise}\n\t */\n\tenqueue() {\n\t\tvar deferred, promise;\n\t\tvar queued;\n\t\tvar task = [].shift.call(arguments);\n\t\tvar args = arguments;\n\n\t\t// Handle single args without context\n\t\t// if(args && !Array.isArray(args)) {\n\t\t//   args = [args];\n\t\t// }\n\t\tif(!task) {\n\t\t\treturn console.error(\"No Task Provided\");\n\t\t}\n\n\t\tif(typeof task === \"function\"){\n\n\t\t\tdeferred = new defer();\n\t\t\tpromise = deferred.promise;\n\n\t\t\tqueued = {\n\t\t\t\t\"task\" : task,\n\t\t\t\t\"args\"     : args,\n\t\t\t\t//\"context\"  : context,\n\t\t\t\t\"deferred\" : deferred,\n\t\t\t\t\"promise\" : promise\n\t\t\t};\n\n\t\t} else {\n\t\t\t// Task is a promise\n\t\t\tqueued = {\n\t\t\t\t\"promise\" : task\n\t\t\t};\n\n\t\t}\n\n\t\tthis._q.push(queued);\n\n\t\t// Wait to start queue flush\n\t\tif (this.paused == false && !this.running) {\n\t\t\t// setTimeout(this.flush.bind(this), 0);\n\t\t\t// this.tick.call(window, this.run.bind(this));\n\t\t\tthis.run();\n\t\t}\n\n\t\treturn queued.promise;\n\t};\n\n\t/**\n\t * Run one item\n\t * @return {Promise}\n\t */\n\tdequeue(){\n\t\tvar inwait, task, result;\n\n\t\tif(this._q.length) {\n\t\t\tinwait = this._q.shift();\n\t\t\ttask = inwait.task;\n\t\t\tif(task){\n\t\t\t\t// console.log(task)\n\n\t\t\t\tresult = task.apply(this.context, inwait.args);\n\n\t\t\t\tif(result && typeof result[\"then\"] === \"function\") {\n\t\t\t\t\t// Task is a function that returns a promise\n\t\t\t\t\treturn result.then(function(){\n\t\t\t\t\t\tinwait.deferred.resolve.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this), function(reason) {\n\t\t\t\t\t\tinwait.deferred.reject.apply(this.context, arguments);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else {\n\t\t\t\t\t// Task resolves immediately\n\t\t\t\t\tinwait.deferred.resolve.apply(this.context, result);\n\t\t\t\t\treturn inwait.promise;\n\t\t\t\t}\n\n\n\n\t\t\t} else if(inwait.promise) {\n\t\t\t\t// Task is a promise\n\t\t\t\treturn inwait.promise;\n\t\t\t}\n\n\t\t} else {\n\t\t\tinwait = new defer();\n\t\t\tinwait.deferred.resolve();\n\t\t\treturn inwait.promise;\n\t\t}\n\n\t};\n\n\t// Run All Immediately\n\tdump(){\n\t\twhile(this._q.length) {\n\t\t\tthis.dequeue();\n\t\t}\n\t};\n\n\t/**\n\t * Run all tasks sequentially, at convince\n\t * @return {Promise}\n\t */\n\trun(){\n\n\t\tif(!this.running){\n\t\t\tthis.running = true;\n\t\t\tthis.defered = new defer();\n\t\t}\n\n\t\tthis.tick.call(window, function() {\n\n\t\t\tif(this._q.length) {\n\n\t\t\t\tthis.dequeue()\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tthis.run();\n\t\t\t\t\t}.bind(this));\n\n\t\t\t} else {\n\t\t\t\tthis.defered.resolve();\n\t\t\t\tthis.running = undefined;\n\t\t\t}\n\n\t\t}.bind(this));\n\n\t\t// Unpause\n\t\tif(this.paused == true) {\n\t\t\tthis.paused = false;\n\t\t}\n\n\t\treturn this.defered.promise;\n\t};\n\n\t/**\n\t * Flush all, as quickly as possible\n\t * @return {Promise}\n\t */\n\tflush(){\n\n\t\tif(this.running){\n\t\t\treturn this.running;\n\t\t}\n\n\t\tif(this._q.length) {\n\t\t\tthis.running = this.dequeue()\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.running = undefined;\n\t\t\t\t\treturn this.flush();\n\t\t\t\t}.bind(this));\n\n\t\t\treturn this.running;\n\t\t}\n\n\t};\n\n\t/**\n\t * Clear all items in wait\n\t */\n\tclear(){\n\t\tthis._q = [];\n\t\tthis.running = false;\n\t};\n\n\t/**\n\t * Get the number of tasks in the queue\n\t * @return {int} tasks\n\t */\n\tlength(){\n\t\treturn this._q.length;\n\t};\n\n\t/**\n\t * Pause a running queue\n\t */\n\tpause(){\n\t\tthis.paused = true;\n\t};\n}\n\n\n/**\n * Create a new task from a callback\n * @class\n * @private\n * @param {function} task\n * @param {array} args\n * @param {scope} context\n * @return {function} task\n */\nclass Task {\n\tconstructor(task, args, context){\n\n\t\treturn function(){\n\t\t\tvar toApply = arguments || [];\n\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tvar callback = function(value){\n\t\t\t\t\tresolve(value);\n\t\t\t\t};\n\t\t\t\t// Add the callback to the arguments list\n\t\t\t\ttoApply.push(callback);\n\n\t\t\t\t// Apply all arguments to the functions\n\t\t\t\ttask.apply(this, toApply);\n\n\t\t\t}.bind(this));\n\n\t\t};\n\n\t};\n}\n\n\nexport default Queue;\n\n\n\n// WEBPACK FOOTER //\n// ./src/queue.js","// import URI from 'urijs';\nimport { qs } from './utils/core';\nimport Url from './utils/url';\n\nexport function replaceBase(doc, section){\n\tvar base;\n\tvar head;\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\t// head = doc.querySelector(\"head\");\n\t// base = head.querySelector(\"base\");\n\thead = qs(doc, \"head\");\n\tbase = qs(head, \"base\");\n\n\tif(!base) {\n\t\tbase = doc.createElement(\"base\");\n\t\thead.insertBefore(base, head.firstChild);\n\t}\n\n\tbase.setAttribute(\"href\", section.url);\n}\n\nexport function replaceCanonical(doc, section){\n\tvar head;\n\tvar link;\n\tvar url = section.url; // window.location.origin +  window.location.pathname + \"?loc=\" + encodeURIComponent(section.url);\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tlink = qs(head, \"link[rel='canonical']\");\n\n\tif (link) {\n\t\tlink.setAttribute(\"href\", url);\n\t} else {\n\t\tlink = doc.createElement(\"link\");\n\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\tlink.setAttribute(\"href\", url);\n\t\thead.appendChild(link);\n\t}\n}\n\nexport function replaceLinks(view, renderer) {\n\n\tvar links = view.document.querySelectorAll(\"a[href]\");\n\tvar replaceLink = function(link){\n\t\tvar href = link.getAttribute(\"href\");\n\n\t\tif(href.indexOf(\"mailto:\") === 0){\n\t\t\treturn;\n\t\t}\n\n\t\tvar linkUrl = Url(href);\n\t\tvar relative = this.book.resolve(href, false);\n\n\t\tif(linkUrl && linkUrl.protocol){\n\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\n\n\t\t}else{\n\t\t\t/*\n\t\t\tif(baseDirectory) {\n\t\t\t\t// We must ensure that the file:// protocol is preserved for\n\t\t\t\t// local file links, as in certain contexts (such as under\n\t\t\t\t// Titanium), file links without the file:// protocol will not\n\t\t\t\t// work\n\t\t\t\tif (baseUri.protocol === \"file\") {\n\t\t\t\t\trelative = core.resolveUrl(baseUri.base, href);\n\t\t\t\t} else {\n\t\t\t\t\trelative = core.resolveUrl(baseDirectory, href);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trelative = href;\n\t\t\t}\n\t\t\t*/\n\n\t\t\tif(linkUrl.fragment) {\n\t\t\t\t// do nothing with fragment yet\n\t\t\t} else {\n\t\t\t\tlink.onclick = function(){\n\t\t\t\t\trenderer.display(relative);\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t}\n\n\t\t}\n\t}.bind(this);\n\n\tfor (var i = 0; i < links.length; i++) {\n\t\treplaceLink(links[i]);\n\t}\n\n\n};\n\nexport function substitute(content, urls, replacements) {\n\turls.forEach(function(url, i){\n\t\tif (url && replacements[i]) {\n\t\t\tcontent = content.replace(new RegExp(url, 'g'), replacements[i]);\n\t\t}\n\t});\n\treturn content;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/replacements.js","import {defer, isXml, parse} from './utils/core';\nimport Path from './utils/path';\n\nfunction request(url, type, withCredentials, headers) {\n\tvar supportsURL = (typeof window != \"undefined\") ? window.URL : false; // TODO: fallback for url if window isn't defined\n\tvar BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\n\tvar uri;\n\n\tvar deferred = new defer();\n\n\tvar xhr = new XMLHttpRequest();\n\n\t//-- Check from PDF.js:\n\t//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\n\tvar xhrPrototype = XMLHttpRequest.prototype;\n\n\tvar header;\n\n\tif (!('overrideMimeType' in xhrPrototype)) {\n\t\t// IE10 might have response, but not overrideMimeType\n\t\tObject.defineProperty(xhrPrototype, 'overrideMimeType', {\n\t\t\tvalue: function xmlHttpRequestOverrideMimeType(mimeType) {}\n\t\t});\n\t}\n\tif(withCredentials) {\n\t\txhr.withCredentials = true;\n\t}\n\n\txhr.onreadystatechange = handler;\n\txhr.onerror = err;\n\n\txhr.open(\"GET\", url, true);\n\n\tfor(header in headers) {\n\t\txhr.setRequestHeader(header, headers[header]);\n\t}\n\n\tif(type == \"json\") {\n\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\n\t}\n\n\t// If type isn't set, determine it from the file extension\n\tif(!type) {\n\t\ttype = new Path(url).extension;\n\t}\n\n\tif(type == 'blob'){\n\t\txhr.responseType = BLOB_RESPONSE;\n\t}\n\n\n\tif(isXml(type)) {\n\t\t// xhr.responseType = \"document\";\n\t\txhr.overrideMimeType('text/xml'); // for OPF parsing\n\t}\n\n\tif(type == 'xhtml') {\n\t\t// xhr.responseType = \"document\";\n\t}\n\n\tif(type == 'html' || type == 'htm') {\n\t\t// xhr.responseType = \"document\";\n\t }\n\n\tif(type == \"binary\") {\n\t\txhr.responseType = \"arraybuffer\";\n\t}\n\n\txhr.send();\n\n\tfunction err(e) {\n\t\tconsole.error(e);\n\t\tdeferred.reject(e);\n\t}\n\n\tfunction handler() {\n\t\tif (this.readyState === XMLHttpRequest.DONE) {\n\t\t\tvar responseXML = false;\n\n\t\t\tif(this.responseType === '' || this.responseType === \"document\") {\n\t\t\t\tresponseXML = this.responseXML;\n\t\t\t}\n\n\t\t\tif (this.status === 200 || responseXML ) { //-- Firefox is reporting 0 for blob urls\n\t\t\t\tvar r;\n\n\t\t\t\tif (!this.response && !responseXML) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tmessage : \"Empty Response\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tif (this.status === 403) {\n\t\t\t\t\tdeferred.reject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tresponse: this.response,\n\t\t\t\t\t\tmessage : \"Forbidden\",\n\t\t\t\t\t\tstack : new Error().stack\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tif(responseXML){\n\t\t\t\t\tr = this.responseXML;\n\t\t\t\t} else\n\t\t\t\tif(isXml(type)){\n\t\t\t\t\t// xhr.overrideMimeType('text/xml'); // for OPF parsing\n\t\t\t\t\t// If this.responseXML wasn't set, try to parse using a DOMParser from text\n\t\t\t\t\tr = parse(this.response, \"text/xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == 'xhtml'){\n\t\t\t\t\tr = parse(this.response, \"application/xhtml+xml\");\n\t\t\t\t}else\n\t\t\t\tif(type == 'html' || type == 'htm'){\n\t\t\t\t\tr = parse(this.response, \"text/html\");\n\t\t\t\t}else\n\t\t\t\tif(type == 'json'){\n\t\t\t\t\tr = JSON.parse(this.response);\n\t\t\t\t}else\n\t\t\t\tif(type == 'blob'){\n\n\t\t\t\t\tif(supportsURL) {\n\t\t\t\t\t\tr = this.response;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//-- Safari doesn't support responseType blob, so create a blob from arraybuffer\n\t\t\t\t\t\tr = new Blob([this.response]);\n\t\t\t\t\t}\n\n\t\t\t\t}else{\n\t\t\t\t\tr = this.response;\n\t\t\t\t}\n\n\t\t\t\tdeferred.resolve(r);\n\t\t\t} else {\n\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tstatus: this.status,\n\t\t\t\t\tmessage : this.response,\n\t\t\t\t\tstack : new Error().stack\n\t\t\t\t});\n\n\t\t\t}\n\t\t}\n\t}\n\n\treturn deferred.promise;\n};\n\nexport default request;\n\n\n\n// WEBPACK FOOTER //\n// ./src/request.js","import EventEmitter from 'event-emitter';\nimport {isNumber, prefixed} from './utils/core';\nimport EpubCFI from './epubcfi';\nimport Mapping from './mapping';\n\n\nclass Contents {\n\tconstructor(doc, content, cfiBase) {\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.document = doc;\n\t\tthis.documentElement =  this.document.documentElement;\n\t\tthis.content = content || this.document.body;\n\t\tthis.window = this.document.defaultView;\n\t\t// Dom events to listen for\n\t\tthis.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis._size = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t}\n\n\t\tthis.cfiBase = cfiBase || \"\";\n\n\t\tthis.listeners();\n\t};\n\n\twidth(w) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tframe.style.width = w;\n\t\t\t// this.content.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)['width'];\n\n\n\t};\n\n\theight(h) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tframe.style.height = h;\n\t\t\t// this.content.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(frame)['height'];\n\n\t};\n\n\tcontentWidth(w) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tcontent.style.width = w;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)['width'];\n\n\n\t};\n\n\tcontentHeight(h) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tcontent.style.height = h;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)['height'];\n\n\t};\n\n\ttextWidth() {\n\t\tvar width;\n\t\tvar range = this.document.createRange();\n\t\tvar content = this.content || this.document.body;\n\n\t\t// Select the contents of frame\n\t\trange.selectNodeContents(content);\n\n\t\t// get the width of the text content\n\t\twidth = range.getBoundingClientRect().width;\n\n\t\treturn width;\n\n\t};\n\n\ttextHeight() {\n\t\tvar height;\n\t\tvar range = this.document.createRange();\n\t\tvar content = this.content || this.document.body;\n\n\t\trange.selectNodeContents(content);\n\n\t\theight = range.getBoundingClientRect().height;\n\n\t\treturn height;\n\t};\n\n\tscrollWidth() {\n\t\tvar width = this.documentElement.scrollWidth;\n\n\t\treturn width;\n\t};\n\n\tscrollHeight() {\n\t\tvar height = this.documentElement.scrollHeight;\n\n\t\treturn height;\n\t};\n\n\toverflow(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflow = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)['overflow'];\n\t};\n\n\toverflowX(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowX = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)['overflowX'];\n\t};\n\n\toverflowY(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowY = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)['overflowY'];\n\t};\n\n\tcss(property, value) {\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (value) {\n\t\t\tcontent.style[property] = value;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[property];\n\t};\n\n\tviewport(options) {\n\t\tvar width, height, scale, scalable;\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar newContent = '';\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tcontent = $viewport.getAttribute(\"content\");\n\t\t\tcontents = content.split(/\\s*,\\s*/);\n\t\t\tif(contents[0]){\n\t\t\t\twidth = contents[0].replace(\"width=\", '').trim();\n\t\t\t}\n\t\t\tif(contents[1]){\n\t\t\t\theight = contents[1].replace(\"height=\", '').trim();\n\t\t\t}\n\t\t\tif(contents[2]){\n\t\t\t\tscale = contents[2].replace(\"initial-scale=\", '').trim();\n\t\t\t}\n\t\t\tif(contents[3]){\n\t\t\t\tscalable = contents[3].replace(\"user-scalable=\", '').trim();\n\t\t\t}\n\t\t}\n\n\t\tif (options) {\n\n\t\t\tnewContent += \"width=\" + (options.width || width);\n\t\t\tnewContent += \", height=\" + (options.height || height);\n\t\t\tif (options.scale || scale) {\n\t\t\t\tnewContent += \", initial-scale=\" + (options.scale || scale);\n\t\t\t}\n\t\t\tif (options.scalable || scalable) {\n\t\t\t\tnewContent += \", user-scalable=\" + (options.scalable || scalable);\n\t\t\t}\n\n\t\t\tif (!$viewport) {\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\n\t\t\t\tthis.document.querySelector('head').appendChild($viewport);\n\t\t\t}\n\n\t\t\t$viewport.setAttribute(\"content\", newContent);\n\t\t}\n\n\n\t\treturn {\n\t\t\twidth: parseInt(width),\n\t\t\theight: parseInt(height)\n\t\t};\n\t};\n\n\n\t// layout(layoutFunc) {\n\t//\n\t//   this.iframe.style.display = \"inline-block\";\n\t//\n\t//   // Reset Body Styles\n\t//   this.content.style.margin = \"0\";\n\t//   //this.document.body.style.display = \"inline-block\";\n\t//   //this.document.documentElement.style.width = \"auto\";\n\t//\n\t//   if(layoutFunc){\n\t//     layoutFunc(this);\n\t//   }\n\t//\n\t//   this.onLayout(this);\n\t//\n\t// };\n\t//\n\t// onLayout(view) {\n\t//   // stub\n\t// };\n\n\texpand() {\n\t\tthis.emit(\"expand\");\n\t};\n\n\tlisteners() {\n\n\t\tthis.imageLoadListeners();\n\n\t\tthis.mediaQueryListeners();\n\n\t\t// this.fontLoadListeners();\n\n\t\tthis.addEventListeners();\n\n\t\tthis.addSelectionListeners();\n\n\t\tthis.resizeListeners();\n\n\t};\n\n\tremoveListeners() {\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.removeSelectionListeners();\n\t};\n\n\tresizeListeners() {\n\t\tvar width, height;\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\n\t\twidth = this.scrollWidth();\n\t\theight = this.scrollHeight();\n\n\t\tif (width != this._size.width || height != this._size.height) {\n\n\t\t\tthis._size = {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t}\n\n\t\t\tthis.emit(\"resize\", this._size);\n\t\t}\n\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n\t};\n\n\t//https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n\tmediaQueryListeners() {\n\t\t\tvar sheets = this.document.styleSheets;\n\t\t\tvar mediaChangeHandler = function(m){\n\t\t\t\tif(m.matches && !this._expanding) {\n\t\t\t\t\tsetTimeout(this.expand.bind(this), 1);\n\t\t\t\t\t// this.expand();\n\t\t\t\t}\n\t\t\t}.bind(this);\n\n\t\t\tfor (var i = 0; i < sheets.length; i += 1) {\n\t\t\t\t\tvar rules;\n\t\t\t\t\t// Firefox errors if we access cssRules cross-domain\n\t\t\t\t\ttry {\n\t\t\t\t\t\trules = sheets[i].cssRules;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif(!rules) return; // Stylesheets changed\n\t\t\t\t\tfor (var j = 0; j < rules.length; j += 1) {\n\t\t\t\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\n\t\t\t\t\t\t\tif(rules[j].media){\n\t\t\t\t\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\n\t\t\t\t\t\t\t\t\tmql.addListener(mediaChangeHandler);\n\t\t\t\t\t\t\t\t\t//mql.onchange = mediaChangeHandler;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t};\n\n\tobserve(target) {\n\t\tvar renderer = this;\n\n\t\t// create an observer instance\n\t\tvar observer = new MutationObserver(function(mutations) {\n\t\t\tif(renderer._expanding) {\n\t\t\t\trenderer.expand();\n\t\t\t}\n\t\t\t// mutations.forEach(function(mutation) {\n\t\t\t//   console.log(mutation);\n\t\t\t// });\n\t\t});\n\n\t\t// configuration of the observer:\n\t\tvar config = { attributes: true, childList: true, characterData: true, subtree: true };\n\n\t\t// pass in the target node, as well as the observer options\n\t\tobserver.observe(target, config);\n\n\t\treturn observer;\n\t};\n\n\timageLoadListeners(target) {\n\t\tvar images = this.document.querySelectorAll(\"img\");\n\t\tvar img;\n\t\tfor (var i = 0; i < images.length; i++) {\n\t\t\timg = images[i];\n\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\n\t\t\t\t\timg.naturalWidth === 0) {\n\t\t\t\timg.onload = this.expand.bind(this);\n\t\t\t}\n\t\t}\n\t};\n\n\tfontLoadListeners(target) {\n\t\tif (!this.document || !this.document.fonts) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.document.fonts.ready.then(function () {\n\t\t\tthis.expand();\n\t\t}.bind(this));\n\n\t};\n\n\troot() {\n\t\tif(!this.document) return null;\n\t\treturn this.document.documentElement;\n\t};\n\n\tlocationOf(target, ignoreClass) {\n\t\tvar position;\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\n\n\t\tif(!this.document) return;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\trange = new EpubCFI(target).toRange(this.document, ignoreClass);\n\n\t\t\tif(range) {\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t} else {\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\n\t\t\t\t\tif (range.collapsed) {\n\t\t\t\t\t\tposition = range.getClientRects()[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\n\t\t\t\t\t}\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if(typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\n\t\t\tid = target.substring(target.indexOf(\"#\")+1);\n\t\t\tel = this.document.getElementById(id);\n\n\t\t\tif(el) {\n\t\t\t\tposition = el.getBoundingClientRect();\n\t\t\t\ttargetPos.left = position.left;\n\t\t\t\ttargetPos.top = position.top;\n\t\t\t}\n\t\t}\n\n\t\treturn targetPos;\n\t};\n\n\taddStylesheet(src) {\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $stylesheet;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if link already exists\n\t\t\t$stylesheet = this.document.querySelector('link[href=\"'+src+'\"]');\n\t\t\tif ($stylesheet) {\n\t\t\t\tresolve(true);\n\t\t\t\treturn; // already present\n\t\t\t}\n\n\t\t\t$stylesheet = this.document.createElement('link');\n\t\t\t$stylesheet.type = 'text/css';\n\t\t\t$stylesheet.rel = \"stylesheet\";\n\t\t\t$stylesheet.href = src;\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == 'complete') ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\t// Let apply\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($stylesheet);\n\n\t\t}.bind(this));\n\t};\n\n\t// https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n\taddStylesheetRules(rules) {\n\t\tvar styleEl;\n\t\tvar styleSheet;\n\t\tvar key = \"epubjs-inserted-css\";\n\n\t\tif(!this.document) return;\n\n\t\t// Check if link already exists\n\t\tstyleEl = this.document.getElementById(\"#\"+key);\n\t\tif (!styleEl) {\n\t\t\tstyleEl = this.document.createElement('style');\n\t\t\tstyleEl.id = key;\n\t\t}\n\n\t\t// Append style element to head\n\t\tthis.document.head.appendChild(styleEl);\n\n\t\t// Grab style sheet\n\t\tstyleSheet = styleEl.sheet;\n\n\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\n\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = '';\n\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\n\t\t\tif (Object.prototype.toString.call(rule[1][0]) === '[object Array]') {\n\t\t\t\trule = rule[1];\n\t\t\t\tj = 0;\n\t\t\t}\n\n\t\t\tfor (var pl = rule.length; j < pl; j++) {\n\t\t\t\tvar prop = rule[j];\n\t\t\t\tpropStr += prop[0] + ':' + prop[1] + (prop[2] ? ' !important' : '') + ';\\n';\n\t\t\t}\n\n\t\t\t// Insert CSS Rule\n\t\t\tstyleSheet.insertRule(selector + '{' + propStr + '}', styleSheet.cssRules.length);\n\t\t}\n\t};\n\n\taddScript(src) {\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $script;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$script = this.document.createElement('script');\n\t\t\t$script.type = 'text/javascript';\n\t\t\t$script.async = true;\n\t\t\t$script.src = src;\n\t\t\t$script.onload = $script.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == 'complete') ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($script);\n\n\t\t}.bind(this));\n\t};\n\n\taddClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tcontent.classList.add(className);\n\n\t};\n\n\tremoveClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tcontent.classList.remove(className);\n\n\t};\n\n\taddEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.listenedEvents.forEach(function(eventName){\n\t\t\tthis.document.addEventListener(eventName, this.triggerEvent.bind(this), false);\n\t\t}, this);\n\n\t};\n\n\tremoveEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.listenedEvents.forEach(function(eventName){\n\t\t\tthis.document.removeEventListener(eventName, this.triggerEvent, false);\n\t\t}, this);\n\n\t};\n\n\t// Pass browser events\n\ttriggerEvent(e){\n\t\tthis.emit(e.type, e);\n\t};\n\n\taddSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.addEventListener(\"selectionchange\", this.onSelectionChange.bind(this), false);\n\t};\n\n\tremoveSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.removeEventListener(\"selectionchange\", this.onSelectionChange, false);\n\t};\n\n\tonSelectionChange(e){\n\t\tif (this.selectionEndTimeout) {\n\t\t\tclearTimeout(this.selectionEndTimeout);\n\t\t}\n\t\tthis.selectionEndTimeout = setTimeout(function() {\n\t\t\tvar selection = this.window.getSelection();\n\t\t\tthis.triggerSelectedEvent(selection);\n\t\t}.bind(this), 500);\n\t};\n\n\ttriggerSelectedEvent(selection){\n\t\tvar range, cfirange;\n\n\t\tif (selection && selection.rangeCount > 0) {\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed) {\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\n\t\t\t\tthis.emit(\"selected\", cfirange);\n\t\t\t\tthis.emit(\"selectedRange\", range);\n\t\t\t}\n\t\t}\n\t};\n\n\trange(_cfi, ignoreClass){\n\t\tvar cfi = new EpubCFI(_cfi);\n\t\treturn cfi.toRange(this.document, ignoreClass);\n\t};\n\n\tmap(layout){\n\t\tvar map = new Mapping(layout);\n\t\treturn map.section();\n\t};\n\n\tsize(width, height){\n\n\t\tif (width >= 0) {\n\t\t\tthis.width(width);\n\t\t}\n\n\t\tif (height >= 0) {\n\t\t\tthis.height(height);\n\t\t}\n\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"boxSizing\", \"border-box\");\n\n\t};\n\n\tcolumns(width, height, columnWidth, gap){\n\t\tvar COLUMN_AXIS = prefixed('columnAxis');\n\t\tvar COLUMN_GAP = prefixed('columnGap');\n\t\tvar COLUMN_WIDTH = prefixed('columnWidth');\n\t\tvar COLUMN_FILL = prefixed('columnFill');\n\t\tvar textWidth;\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ width: width, height: height, scale: 1.0 });\n\n\t\t// this.overflowY(\"hidden\");\n\t\tthis.css(\"overflowY\", \"hidden\");\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"boxSizing\", \"border-box\");\n\t\tthis.css(\"maxWidth\", \"inherit\");\n\n\t\tthis.css(COLUMN_AXIS, \"horizontal\");\n\t\tthis.css(COLUMN_FILL, \"auto\");\n\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\n\t};\n\n\tscaler(scale, offsetX, offsetY){\n\t\tvar scale = \"scale(\" + scale + \")\";\n\t\tvar translate = '';\n\t\t// this.css(\"position\", \"absolute\"));\n\t\tthis.css(\"transformOrigin\", \"top left\");\n\n\t\tif (offsetX >= 0 || offsetY >= 0) {\n\t\t\ttranslate = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\n\t\t}\n\n\t\tthis.css(\"transform\", scale + translate);\n\t};\n\n\tfit(width, height){\n\t\tvar viewport = this.viewport();\n\t\tvar widthScale = width / viewport.width;\n\t\tvar heightScale = height / viewport.height;\n\t\tvar scale = widthScale < heightScale ? widthScale : heightScale;\n\n\t\tvar offsetY = (height - (viewport.height * scale)) / 2;\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\t\tthis.overflow(\"hidden\");\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ scale: 1.0 });\n\n\t\t// Scale to the correct size\n\t\tthis.scaler(scale, 0, offsetY);\n\n\t\tthis.css(\"backgroundColor\", \"transparent\");\n\t};\n\n\tmapPage(cfiBase, start, end) {\n\t\tvar mapping = new Mapping();\n\n\t\treturn mapping.page(this, cfiBase, start, end);\n\t};\n\n\tdestroy() {\n\t\t// Stop observing\n\t\tif(this.observer) {\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tthis.removeListeners();\n\n\t};\n}\n\nEventEmitter(Contents.prototype);\n\nexport default Contents;\n\n\n\n// WEBPACK FOOTER //\n// ./src/contents.js","import EventEmitter from 'event-emitter';\nimport {extend, defer} from '../../utils/core';\nimport EpubCFI from '../../epubcfi';\nimport Mapping from '../../mapping';\nimport Queue from '../../queue';\nimport Stage from '../helpers/stage';\nimport Views from '../helpers/views';\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\t// globalLayoutProperties : { layout: 'reflowable', spread: 'auto', orientation: 'auto'},\n\t\t\t// layout: null,\n\t\t\taxis: \"vertical\",\n\t\t\tignoreClass: ''\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tlayout: this.layout,\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t}\n\n\trender(element, size){\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.settings.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\t};\n\n\taddEventListeners(){\n\t\twindow.addEventListener('unload', function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\t};\n\n\tdestroy(){\n\t\t// this.views.each(function(view){\n\t\t// \tview.destroy();\n\t\t// });\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t};\n\n\tonResized(e) {\n\t\tclearTimeout(this.resizeTimeout);\n\t\tthis.resizeTimeout = setTimeout(function(){\n\t\t\tthis.resize();\n\t\t}.bind(this), 150);\n\t};\n\n\tresize(width, height){\n\n\t\t// Clear the queue\n\t\tthis.q.clear();\n\n\t\tthis._stageSize = this.stage.size(width, height);\n\t\tthis._bounds = this.bounds();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Update for existing views\n\t\tthis.views.each(function(view) {\n\t\t\tview.size(this._stageSize.width, this._stageSize.height);\n\t\t}.bind(this));\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(\"resized\", {\n\t\t\twidth: this.stage.width,\n\t\t\theight: this.stage.height\n\t\t});\n\n\t};\n\n\tcreateView(section) {\n\t\treturn new this.View(section, this.viewSettings);\n\t};\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location\n\t\tif(visible && target) {\n\t\t\toffset = visible.locationOf(target);\n\t\t\tthis.moveTo(offset);\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.views.hide();\n\n\t\tthis.views.clear();\n\n\t\tthis.add(section)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\toffset = view.locationOf(target);\n\t\t\t\t\tthis.moveTo(offset);\n\t\t\t\t}\n\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tvar next;\n\t\t\t\tif (this.layout.name === \"pre-paginated\" &&\n\t\t\t\t\t\tthis.layout.divisor > 1) {\n\t\t\t\t\tnext = section.next();\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\treturn this.add(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this))\n\t\t\t// .then(function(){\n\t\t\t// \treturn this.hooks.display.trigger(view);\n\t\t\t// }.bind(this))\n\t\t\t// .then(function(){\n\t\t\t// \tthis.views.show();\n\t\t\t// }.bind(this));\n\t\t\treturn displayed;\n\t};\n\n\tafterDisplayed(view){\n\t\tthis.emit(\"added\", view);\n\t};\n\n\tafterResized(view){\n\t\tthis.emit(\"resize\", view.section);\n\t};\n\n\t// moveTo(offset){\n\t// \tthis.scrollTo(offset.left, offset.top);\n\t// };\n\n\tmoveTo(offset){\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\t\t}\n\n\t\tthis.scrollTo(distX, distY);\n\t};\n\n\tadd(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(\"shown\", this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\treturn view.display(this.request);\n\n\t};\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\t\tthis.views.append(view);\n\t\treturn view.display(this.request);\n\t};\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tthis.views.prepend(view);\n\t\treturn view.display(this.request);\n\t};\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar view;\n\t\tvar left;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left < this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0);\n\t\t\t} else if (left - this.layout.columnWidth === this.container.scrollWidth) {\n\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\n\t\t} else {\n\n\t\t\tnext = this.views.last().section.next();\n\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.views.clear();\n\n\t\t\treturn this.append(next)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar right;\n\t\t\t\t\tif (this.layout.name && this.layout.divisor > 1) {\n\t\t\t\t\t\tright = next.next();\n\t\t\t\t\t\tif (right) {\n\t\t\t\t\t\t\treturn this.append(right);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this))\n\t\t\t\t.then(function(){\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t};\n\n\tprev(){\n\t\tvar prev;\n\t\tvar view;\n\t\tvar left;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.views.clear();\n\n\t\t\treturn this.prepend(prev)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this))\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0);\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t};\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t};\n\n\tcurrentLocation(){\n\n\t\tif (this.settings.axis === \"vertical\") {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t} else {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t}\n\t\treturn this.location;\n\t};\n\n\tscrolledLocation(){\n\t\tvar view;\n\n\t\tif(this.views.length) {\n\t\t\tview = this.views.first();\n\t\t\treturn this.mapping.page(view, view.section.cfiBase);\n\t\t}\n\n\t};\n\n\tpaginatedLocation(){\n\t\tvar view;\n\t\tvar start, end;\n\n\t\tif(this.views.length) {\n\t\t\tview = this.views.first();\n\t\t\tstart = this._bounds.left - view.position().left;\n\t\t\tend = start + this.layout.spreadWidth;\n\t\t\treturn this.mapping.page(view, view.section.cfiBase, start, end);\n\t\t}\n\n\t};\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t};\n\n\tvisible(){\n\t\t// return this.views.displayed();\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t};\n\n\tscrollBy(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(this.settings.height) {\n\n\t\t\tif(x) this.container.scrollLeft += x;\n\t\t\tif(y) this.container.scrollTop += y;\n\n\t\t} else {\n\t\t\twindow.scrollBy(x,y);\n\t\t}\n\t\t// console.log(\"scrollBy\", x, y);\n\t\tthis.scrolled = true;\n\t\tthis.onScroll();\n\t};\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(this.settings.height) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\t// console.log(\"scrollTo\", x, y);\n\t\tthis.scrolled = true;\n\t\tthis.onScroll();\n\t\t// if(this.container.scrollLeft != x){\n\t\t//   setTimeout(function() {\n\t\t//     this.scrollTo(x, y, silent);\n\t\t//   }.bind(this), 10);\n\t\t//   return;\n\t\t// };\n\t };\n\n\tonScroll(){\n\n\t};\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t};\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\n\t\tthis.mapping = new Mapping(this.layout);\n\t\t // this.manager.layout(this.layout.format);\n\t};\n\n\tupdateLayout() {\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta;\n\n\t\t\tthis.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\n\t};\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.each(function(view){\n\t\t\t\tview.setLayout(layout);\n\t\t\t});\n\n\t\t}\n\n\t};\n\n\tupdateFlow(flow){\n\t\tvar axis = (flow === \"paginated\") ? \"horizontal\" : \"vertical\";\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tthis.settings.overflow = (flow === \"paginated\") ? \"hidden\" : \"auto\";\n\t\t// this.views.each(function(view){\n\t\t// \tview.setAxis(axis);\n\t\t// });\n\n\t};\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tthis.views.each(function(view){\n\t\t\tcontents.push(view.contents);\n\t\t});\n\t\treturn contents;\n\t};\n}\n\n //-- Enable binding events to Manager\n EventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/managers/default/index.js","import EventEmitter from 'event-emitter';\nimport { extend, defer, isFloat } from './utils/core';\nimport {replaceLinks} from './replacements';\nimport Hook from './hook';\nimport EpubCFI from './epubcfi';\nimport Queue from './queue';\nimport Layout from './layout';\nimport Mapping from './mapping';\nimport Themes from './themes';\nimport Path from './utils/path';\n\n/**\n * [Rendition description]\n * @class\n * @param {Book} book\n * @param {object} options\n * @param {int} options.width\n * @param {int} options.height\n * @param {string} options.ignoreClass\n * @param {string} options.manager\n * @param {string} options.view\n * @param {string} options.layout\n * @param {string} options.spread\n * @param {int} options.minSpreadWidth overridden by spread: none (never) / both (always)\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: '',\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass\n\t\t};\n\n\t\tthis.book = book;\n\n\t\tthis.views = null;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @property {Hook} hooks\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\t/**\n\t\t * @property {method} hooks.content\n\t\t * @type {Hook}\n\t\t */\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(replaceLinks.bind(this));\n\t\tthis.hooks.content.register(this.passViewEvents.bind(this));\n\n\t\t// this.hooks.display.register(this.afterDisplay.bind(this));\n\t\tthis.themes = new Themes(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\t// Block the queue until rendering is started\n\t\tthis.starting = new defer();\n\t\tthis.started = this.starting.promise;\n\t\tthis.q.enqueue(this.start);\n\t};\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t};\n\n\t/**\n\t * Require the manager from passed string, or as a function\n\t * @param  {string|function} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from register managers,\n\t\t// or require included managers directly\n\t\tif (typeof manager === \"string\") {\n\t\t\t// Use global or require\n\t\t\tviewManager = typeof ePub != \"undefined\" ? ePub.ViewManagers[manager] : undefined; //require('./managers/'+manager);\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a function\n\t\t\tviewManager = manager\n\t\t}\n\n\t\treturn viewManager;\n\t};\n\n\t/**\n\t * Require the view from passed string, or as a function\n\t * @param  {string|function} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\tif (typeof view == \"string\") {\n\t\t\tView = typeof ePub != \"undefined\" ? ePub.Views[view] : undefined; //require('./views/'+view);\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a function\n\t\t\tView = view\n\t\t}\n\n\t\treturn View;\n\t};\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(\"added\", this.afterDisplayed.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(\"resized\", this.onResized.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(\"scroll\", this.reportLocation.bind(this));\n\n\n\t\tthis.on('displayed', this.reportLocation.bind(this));\n\n\t\t// Trigger that rendering has started\n\t\tthis.emit(\"started\");\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t};\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t// Trigger Attached\n\t\t\tthis.emit(\"attached\");\n\n\t\t}.bind(this));\n\n\t};\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\n\t\treturn this.q.enqueue(this._display, target);\n\n\t};\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length && isFloat(target)) {\n\t\t\tconsole.log(\"percentage\", target);\n\t\t\ttarget = book.locations.cfiFromPercentage(target);\n\t\t\tconsole.log(\"cfi\", target);\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Trim the target fragment\n\t\t// removing the chapter\n\t\tif(!isCfiString && typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\t\t\t\tmoveTo = target.substring(target.indexOf(\"#\")+1);\n\t\t}\n\n\t\tif (isCfiString) {\n\t\t\tmoveTo = target;\n\t\t}\n\n\t\treturn this.manager.display(section, moveTo)\n\t\t\t.then(function(){\n\t\t\t\t// this.emit(\"displayed\", section);\n\t\t\t}.bind(this));\n\n\t};\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t};\n\t*/\n\n\t/**\n\t * Report what has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\t\tthis.hooks.content.trigger(view, this);\n\t\tthis.emit(\"rendered\", view.section);\n\t\tthis.reportLocation();\n\t};\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size){\n\n\t\tif(this.location) {\n\t\t\tthis.display(this.location.start);\n\t\t}\n\n\t\tthis.emit(\"resized\", {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t});\n\n\t};\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t};\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t};\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t};\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\n\t\tif (this.settings.width >= 0 && this.settings.height >= 0) {\n\t\t\tviewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth\n\t\t};\n\n\t\treturn properties;\n\t};\n\n\t// applyLayoutProperties(){\n\t// \tvar settings = this.determineLayoutProperties(this.book.package.metadata);\n\t//\n\t// \tthis.flow(settings.flow);\n\t//\n\t// \tthis.layout(settings);\n\t// };\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled-doc\" || flow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\t};\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\tthis.mapping = new Mapping(this._layout);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t};\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} min min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis._layout.spread(spread, min);\n\n\t\tif (this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t};\n\n\t/**\n\t * Report the current location\n\t * @private\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function(){\n\t\t\tvar location = this.manager.currentLocation();\n\t\t\tif (location && location.then && typeof location.then === 'function') {\n\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\tthis.location = result;\n\n\t\t\t\t\tthis.percentage = this.book.locations.percentageFromCfi(result);\n\t\t\t\t\tif (this.percentage != null) {\n\t\t\t\t\t\tthis.location.percentage = this.percentage;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.emit(\"locationChanged\", this.location);\n\t\t\t\t}.bind(this));\n\t\t\t} else if (location) {\n\t\t\t\tthis.location = location;\n\t\t\t\tthis.percentage = this.book.locations.percentageFromCfi(location);\n\t\t\t\tif (this.percentage != null) {\n\t\t\t\t\tthis.location.percentage = this.percentage;\n\t\t\t\t}\n\n\t\t\t\tthis.emit(\"locationChanged\", this.location);\n\t\t\t}\n\n\t\t}.bind(this));\n\t};\n\n\t/**\n\t * Get the Current Location CFI\n\t * @return {EpubCFI} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === 'function') {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tvar percentage = this.book.locations.percentageFromCfi(result);\n\t\t\t\tif (percentage != null) {\n\t\t\t\t\tresult.percentage = percentage;\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tvar percentage = this.book.locations.percentageFromCfi(location);\n\t\t\tif (percentage != null) {\n\t\t\t\tlocation.percentage = percentage;\n\t\t\t}\n\t\t\treturn location;\n\t\t}\n\t};\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\tthis.q.clear();\n\n\t\tthis.manager.destroy();\n\t};\n\n\t/**\n\t * Pass the events from a view\n\t * @private\n\t * @param  {View} view\n\t */\n\tpassViewEvents(view){\n\t\tview.contents.listenedEvents.forEach(function(e){\n\t\t\tview.on(e, this.triggerViewEvent.bind(this));\n\t\t}.bind(this));\n\n\t\tview.on(\"selected\", this.triggerSelectedEvent.bind(this));\n\t};\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e){\n\t\tthis.emit(e.type, e);\n\t};\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange){\n\t\tthis.emit(\"selected\", cfirange);\n\t};\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\trange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].range(_cfi, ignoreClass);\n\t\t}\n\t};\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {View} view\n\t */\n\tadjustImages(view) {\n\n\t\tview.addStylesheetRules([\n\t\t\t\t[\"img\",\n\t\t\t\t\t[\"max-width\", (view.layout.spreadWidth) + \"px\"],\n\t\t\t\t\t[\"max-height\", (view.layout.height) + \"px\"]\n\t\t\t\t]\n\t\t]);\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t};\n\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t};\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n\n\n\n// WEBPACK FOOTER //\n// ./src/rendition.js","module.exports = __WEBPACK_EXTERNAL_MODULE_14__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xmldom\"\n// module id = 14\n// module chunks = 0","import EventEmitter from 'event-emitter';\n// import path from 'path';\nimport {extend, defer} from './utils/core';\nimport Url from './utils/url';\nimport Path from './utils/path';\nimport Spine from './spine';\nimport Locations from './locations';\nimport Container from './container';\nimport Packaging from './packaging';\nimport Navigation from './navigation';\nimport Resources from './resources';\nimport PageList from './pagelist';\nimport Rendition from './rendition';\nimport Archive from './archive';\nimport request from './request';\nimport EpubCFI from './epubcfi';\n\nconst CONTAINER_PATH = \"META-INF/container.xml\";\n\n/**\n * Creates a new Book\n * @class\n * @param {string} url\n * @param {object} options\n * @param {method} options.requestMethod a request function to use instead of the default\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\n * @param {string} [options.replacements=base64] use base64, blobUrl, or none for replacing assets in archived Epubs\n * @returns {Book}\n * @example new Book(\"/path/to/book.epub\", {})\n * @example new Book({ replacements: \"blobUrl\" })\n */\nclass Book {\n\tconstructor(url, options) {\n\t\t// Allow passing just options to the Book\n\t\tif (typeof(options) === \"undefined\"\n\t\t\t&& typeof(url) === \"object\") {\n\t\t\toptions = url;\n\t\t\turl = undefined;\n\t\t}\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\trequestMethod: undefined,\n\t\t\trequestCredentials: undefined,\n\t\t\trequestHeaders: undefined,\n\t\t\tencoding: undefined,\n\t\t\treplacements: 'base64'\n\t\t});\n\n\t\textend(this.settings, options);\n\n\n\t\t// Promises\n\t\tthis.opening = new defer();\n\t\t/**\n\t\t * @property {promise} opened returns after the book is loaded\n\t\t */\n\t\tthis.opened = this.opening.promise;\n\t\tthis.isOpen = false;\n\n\t\tthis.loading = {\n\t\t\tmanifest: new defer(),\n\t\t\tspine: new defer(),\n\t\t\tmetadata: new defer(),\n\t\t\tcover: new defer(),\n\t\t\tnavigation: new defer(),\n\t\t\tpageList: new defer(),\n\t\t\tresources: new defer()\n\t\t};\n\n\t\tthis.loaded = {\n\t\t\tmanifest: this.loading.manifest.promise,\n\t\t\tspine: this.loading.spine.promise,\n\t\t\tmetadata: this.loading.metadata.promise,\n\t\t\tcover: this.loading.cover.promise,\n\t\t\tnavigation: this.loading.navigation.promise,\n\t\t\tpageList: this.loading.pageList.promise,\n\t\t\tresources: this.loading.resources.promise\n\t\t};\n\n\t\t// this.ready = RSVP.hash(this.loaded);\n\t\t/**\n\t\t * @property {promise} ready returns after the book is loaded and parsed\n\t\t * @private\n\t\t */\n\t\tthis.ready = Promise.all([this.loaded.manifest,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.spine,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.metadata,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.cover,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.navigation,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.resources ]);\n\n\n\t\t// Queue for methods used before opening\n\t\tthis.isRendered = false;\n\t\t// this._q = queue(this);\n\n\t\t/**\n\t\t * @property {method} request\n\t\t * @private\n\t\t */\n\t\tthis.request = this.settings.requestMethod || request;\n\n\t\t/**\n\t\t * @property {Spine} spine\n\t\t */\n\t\tthis.spine = new Spine();\n\n\t\t/**\n\t\t * @property {Locations} locations\n\t\t */\n\t\tthis.locations = new Locations(this.spine, this.load.bind(this));\n\n\t\t/**\n\t\t * @property {Navigation} navigation\n\t\t */\n\t\tthis.navigation = undefined;\n\n\t\t/**\n\t\t * @property {PageList} pagelist\n\t\t */\n\t\tthis.pageList = new PageList();\n\n\t\t/**\n\t\t * @property {Url} url\n\t\t * @private\n\t\t */\n\t\tthis.url = undefined;\n\n\t\t/**\n\t\t * @property {Path} path\n\t\t * @private\n\t\t */\n\t\tthis.path = undefined;\n\n\t\t/**\n\t\t * @property {boolean} archived\n\t\t * @private\n\t\t */\n\t\tthis.archived = false;\n\n\t\tif(url) {\n\t\t\tthis.open(url).catch((error) => {\n\t\t\t\tvar err = new Error(\"Cannot load book at \"+ url );\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.emit(\"openFailed\", err);\n\t\t\t\tconsole.log(error);\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Open a epub or url\n\t * @param {string} input URL, Path or ArrayBuffer\n\t * @param {string} [what] to force opening\n\t * @returns {Promise} of when the book has been loaded\n\t * @example book.open(\"/path/to/book.epub\")\n\t */\n\topen(input, what) {\n\t\tvar opening;\n\t\tvar type = what || this.determineType(input);\n\n\t\tif (type === \"binary\") {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.openEpub(input);\n\t\t} else if (type === \"epub\") {\n\t\t\tthis.archived = true;\n\t\t\tthis.url = new Url(\"/\", \"\");\n\t\t\topening = this.request(input, 'binary')\n\t\t\t\t.then(this.openEpub.bind(this));\n\t\t} else if(type == \"opf\") {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openPackaging(this.url.Path.toString());\n\t\t} else {\n\t\t\tthis.url = new Url(input);\n\t\t\topening = this.openContainer(CONTAINER_PATH)\n\t\t\t\t.then(this.openPackaging.bind(this));\n\t\t}\n\n\t\treturn opening;\n\t}\n\n\t/**\n\t * Open an archived epub\n\t * @private\n\t * @param  {binary} data\n\t * @param  {[string]} encoding\n\t * @return {Promise}\n\t */\n\topenEpub(data, encoding) {\n\t\treturn this.unarchive(data, encoding || this.settings.encoding)\n\t\t\t.then(() => {\n\t\t\t\treturn this.openContainer(CONTAINER_PATH);\n\t\t\t})\n\t\t\t.then((packagePath) => {\n\t\t\t\treturn this.openPackaging(packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the epub container\n\t * @private\n\t * @param  {string} url\n\t * @return {string} packagePath\n\t */\n\topenContainer(url) {\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.container = new Container(xml);\n\t\t\t\treturn this.resolve(this.container.packagePath);\n\t\t\t});\n\t}\n\n\t/**\n\t * Open the Open Packaging Format Xml\n\t * @private\n\t * @param  {string} url\n\t * @return {Promise}\n\t */\n\topenPackaging(url) {\n\t\tvar packageUrl;\n\t\tthis.path = new Path(url);\n\t\treturn this.load(url)\n\t\t\t.then((xml) => {\n\t\t\t\tthis.packaging = new Packaging(xml);\n\t\t\t\treturn this.unpack(this.packaging);\n\t\t\t});\n\t}\n\n\t/**\n\t * Load a resource from the Book\n\t * @param  {string} path path to the resource to load\n\t * @return {Promise}     returns a promise with the requested resource\n\t */\n\tload(path) {\n\t\tvar resolved;\n\n\t\tif(this.archived) {\n\t\t\tresolved = this.resolve(path);\n\t\t\treturn this.archive.request(resolved);\n\t\t} else {\n\t\t\tresolved = this.resolve(path);\n\t\t\treturn this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\n\t\t}\n\t}\n\n\t/**\n\t * Resolve a path to it's absolute position in the Book\n\t * @param  {string} path\n\t * @param  {[boolean]} absolute force resolving the full URL\n\t * @return {string}          the resolved path string\n\t */\n\tresolve(path, absolute) {\n\t\tvar resolved = path;\n\t\tvar isAbsolute = (path.indexOf('://') > -1);\n\n\t\tif (isAbsolute) {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (this.path) {\n\t\t\tresolved = this.path.resolve(path);\n\t\t}\n\n\t\tif(absolute != false && this.url) {\n\t\t\tresolved = this.url.resolve(resolved);\n\t\t}\n\n\t\treturn resolved;\n\t}\n\n\t/**\n\t * Determine the type of they input passed to open\n\t * @private\n\t * @param  {string} input\n\t * @return {string}  binary | directory | epub | opf\n\t */\n\tdetermineType(input) {\n\t\tvar url;\n\t\tvar path;\n\t\tvar extension;\n\n\t\tif (typeof(input) != \"string\") {\n\t\t\treturn \"binary\";\n\t\t}\n\n\t\turl = new Url(input);\n\t\tpath = url.path();\n\t\textension = path.extension;\n\n\t\tif (!extension) {\n\t\t\treturn \"directory\";\n\t\t}\n\n\t\tif(extension === \"epub\"){\n\t\t\treturn \"epub\";\n\t\t}\n\n\t\tif(extension === \"opf\"){\n\t\t\treturn \"opf\";\n\t\t}\n\t};\n\n\n\t/**\n\t * unpack the contents of the Books packageXml\n\t * @private\n\t * @param {document} packageXml XML Document\n\t */\n\tunpack(opf) {\n\t\tthis.package = opf;\n\n\t\tthis.spine.unpack(this.package, this.resolve.bind(this));\n\n\t\tthis.resources = new Resources(this.package.manifest, {\n\t\t\tarchive: this.archive,\n\t\t\tresolver: this.resolve.bind(this),\n\t\t\treplacements: this.settings.replacements\n\t\t});\n\n\t\tthis.loadNavigation(this.package).then(() => {\n\t\t\tthis.toc = this.navigation.toc;\n\t\t\tthis.loading.navigation.resolve(this.navigation);\n\t\t});\n\n\t\tthis.cover = this.resolve(this.package.coverPath);\n\n\t\t// Resolve promises\n\t\tthis.loading.manifest.resolve(this.package.manifest);\n\t\tthis.loading.metadata.resolve(this.package.metadata);\n\t\tthis.loading.spine.resolve(this.spine);\n\t\tthis.loading.cover.resolve(this.cover);\n\t\tthis.loading.resources.resolve(this.resources);\n\t\tthis.loading.pageList.resolve(this.pageList);\n\n\n\t\tthis.isOpen = true;\n\n\t\tif(this.archived) {\n\t\t\tthis.replacements().then(() => {\n\t\t\t\tthis.opening.resolve(this);\n\t\t\t});\n\t\t} else {\n\t\t\t// Resolve book opened promise\n\t\t\tthis.opening.resolve(this);\n\t\t}\n\n\t}\n\n\t/**\n\t * Load Navigation and PageList from package\n\t * @private\n\t * @param {document} opf XML Document\n\t */\n\tloadNavigation(opf) {\n\t\tvar navPath = opf.navPath || opf.ncxPath;\n\n\t\tif (!navPath) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.load(navPath, 'xml')\n\t\t\t.then((xml) => {\n\t\t\t\tthis.navigation = new Navigation(xml);\n\t\t\t\tthis.pageList = new PageList(xml);\n\t\t\t\treturn this.navigation;\n\t\t\t});\n\t}\n\n\t/**\n\t * Alias for book.spine.get\n\t * @param {string} target\n\t */\n\tsection(target) {\n\t\treturn this.spine.get(target);\n\t}\n\n\t/**\n\t * Sugar to render a book\n\t * @param  {element} element element to add the views to\n\t * @param  {[object]} options\n\t * @return {Rendition}\n\t */\n\trenderTo(element, options) {\n\t\t// var renderMethod = (options && options.method) ?\n\t\t//     options.method :\n\t\t//     \"single\";\n\n\t\tthis.rendition = new Rendition(this, options);\n\t\tthis.rendition.attachTo(element);\n\n\t\treturn this.rendition;\n\t};\n\n\t/**\n\t * Set if request should use withCredentials\n\t * @param {boolean} credentials\n\t */\n\tsetRequestCredentials(credentials) {\n\t\tthis.settings.requestCredentials = credentials;\n\t};\n\n\t/**\n\t * Set headers request should use\n\t * @param {object} headers\n\t */\n\tsetRequestHeaders(headers) {\n\t\tthis.settings.requestHeaders = headers;\n\t};\n\n\t/**\n\t * Unarchive a zipped epub\n\t * @private\n\t * @param  {binary} input epub data\n\t * @param  {[string]} encoding\n\t * @return {Archive}\n\t */\n\tunarchive(input, encoding) {\n\t\tthis.archive = new Archive();\n\t\treturn this.archive.open(input, encoding);\n\t}\n\n\t/**\n\t * Get the cover url\n\t * @return {string} coverUrl\n\t */\n\tcoverUrl() {\n\t\tvar retrieved = this.loaded.cover.\n\t\t\tthen((url) => {\n\t\t\t\tif(this.archived) {\n\t\t\t\t\t// return this.archive.createUrl(this.cover);\n\t\t\t\t\treturn this.resources.get(this.cover);\n\t\t\t\t}else{\n\t\t\t\t\treturn this.cover;\n\t\t\t\t}\n\t\t\t});\n\n\n\n\t\treturn retrieved;\n\t}\n\n\t/**\n\t * load replacement urls\n\t * @private\n\t * @return {Promise} completed loading urls\n\t */\n\treplacements() {\n\t\tthis.spine.hooks.serialize.register((output, section) => {\n\t\t\tsection.output = this.resources.substitute(output, section.url);\n\t\t});\n\n\t\treturn this.resources.replacements().\n\t\t\tthen(() => {\n\t\t\t\treturn this.resources.replaceCss();\n\t\t\t});\n\t}\n\n\t/**\n\t * Find a DOM Range for a given CFI Range\n\t * @param  {EpubCFI} cfiRange a epub cfi range\n\t * @return {Range}\n\t */\n\t range(cfiRange) {\n\t\tvar cfi = new EpubCFI(cfiRange);\n\t\tvar item = this.spine.get(cfi.spinePos);\n\n\t\treturn item.load().then(function (contents) {\n\t\t\tvar range = cfi.toRange(item.document);\n\t\t\treturn range;\n\t\t})\n\t}\n\n\t/**\n\t * Generates the Book Key using the identifer in the manifest or other string provided\n\t * @param  {[string]} identifier to use instead of metadata identifier\n\t * @return {string} key\n\t */\n\tkey(identifier) {\n\t\tvar ident = identifier || this.package.metadata.identifier || this.url.filename;\n\t\treturn \"epubjs:\" + (EPUBJS_VERSION || ePub.VERSION) + \":\" + ident;\n\t}\n\n}\n\n//-- Enable binding events to book\nEventEmitter(Book.prototype);\n\nexport default Book;\n\n\n\n// WEBPACK FOOTER //\n// ./src/book.js","import {extend, defer, requestAnimationFrame} from '../../utils/core';\nimport DefaultViewManager from '../default';\n\nclass ContinuousViewManager extends DefaultViewManager {\n\tconstructor(options) {\n\t\tsuper(options)\n\t\t// DefaultViewManager.apply(this, arguments); // call super constructor.\n\n\t\tthis.name = \"continuous\";\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\toverflow: \"auto\",\n\t\t\taxis: \"vertical\",\n\t\t\toffset: 500,\n\t\t\toffsetDelta: 250,\n\t\t\twidth: undefined,\n\t\t\theight: undefined\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\t// Gap can be 0, byt defaults doesn't handle that\n\t\tif (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\n\t\t\tthis.settings.gap = options.settings.gap;\n\t\t}\n\n\t\t// this.viewSettings.axis = this.settings.axis;\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tlayout: this.layout,\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\tthis.scrollTop = 0;\n\t\tthis.scrollLeft = 0;\n\t};\n\n\tdisplay(section, target){\n\t\treturn DefaultViewManager.prototype.display.call(this, section, target)\n\t\t\t.then(function () {\n\t\t\t\treturn this.fill();\n\t\t\t}.bind(this));\n\t};\n\n\tfill(_full){\n\t\tvar full = _full || new defer();\n\n\t\tthis.check().then(function(result) {\n\t\t\tif (result) {\n\t\t\t\tthis.fill(full);\n\t\t\t} else {\n\t\t\t\tfull.resolve();\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn full.promise;\n\t}\n\n\tmoveTo(offset){\n\t\t// var bounds = this.stage.bounds();\n\t\t// var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tvar offsetX = 0,\n\t\t\t\toffsetY = 0;\n\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tdistY = offset.top;\n\t\t\toffsetY = offset.top+this.settings.offset;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\t\t\toffsetX = distX+this.settings.offset;\n\t\t}\n\n\t\treturn this.check(offsetX, offsetY)\n\t\t\t.then(function(){\n\t\t\t\tthis.scrollBy(distX, distY);\n\t\t\t}.bind(this));\n\t};\n\n\t/*\n\tafterDisplayed(currView){\n\t\tvar next = currView.section.next();\n\t\tvar prev = currView.section.prev();\n\t\tvar index = this.views.indexOf(currView);\n\t\tvar prevView, nextView;\n\n\t\tif(index + 1 === this.views.length && next) {\n\t\t\tnextView = this.createView(next);\n\t\t\tthis.q.enqueue(this.append.bind(this), nextView);\n\t\t}\n\n\t\tif(index === 0 && prev) {\n\t\t\tprevView = this.createView(prev, this.viewSettings);\n\t\t\tthis.q.enqueue(this.prepend.bind(this), prevView);\n\t\t}\n\n\t\t// this.removeShownListeners(currView);\n\t\t// currView.onShown = this.afterDisplayed.bind(this);\n\t\tthis.emit(\"added\", currView.section);\n\n\t};\n\t*/\n\n\tresize(width, height){\n\n\t\t// Clear the queue\n\t\tthis.q.clear();\n\n\t\tthis._stageSize = this.stage.size(width, height);\n\t\tthis._bounds = this.bounds();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Update for existing views\n\t\tthis.views.each(function(view) {\n\t\t\tview.size(this._stageSize.width, this._stageSize.height);\n\t\t}.bind(this));\n\n\t\tthis.updateLayout();\n\n\t\t// if(this.location) {\n\t\t//   this.rendition.display(this.location.start);\n\t\t// }\n\n\t\tthis.emit(\"resized\", {\n\t\t\twidth: this.stage.width,\n\t\t\theight: this.stage.height\n\t\t});\n\n\t};\n\n\tonResized(e) {\n\n\t\t// this.views.clear();\n\n\t\tclearTimeout(this.resizeTimeout);\n\t\tthis.resizeTimeout = setTimeout(function(){\n\t\t\tthis.resize();\n\t\t}.bind(this), 150);\n\t};\n\n\tafterResized(view){\n\t\tthis.emit(\"resize\", view.section);\n\t};\n\n\t// Remove Previous Listeners if present\n\tremoveShownListeners(view){\n\n\t\t// view.off(\"shown\", this.afterDisplayed);\n\t\t// view.off(\"shown\", this.afterDisplayedAbove);\n\t\tview.onDisplayed = function(){};\n\n\t};\n\n\n\t// append(section){\n\t// \treturn this.q.enqueue(function() {\n\t//\n\t// \t\tthis._append(section);\n\t//\n\t//\n\t// \t}.bind(this));\n\t// };\n\t//\n\t// prepend(section){\n\t// \treturn this.q.enqueue(function() {\n\t//\n\t// \t\tthis._prepend(section);\n\t//\n\t// \t}.bind(this));\n\t//\n\t// };\n\n\tappend(section){\n\t\tvar view = this.createView(section);\n\t\tthis.views.append(view);\n\t\treturn view;\n\t};\n\n\tprepend(section){\n\t\tvar view = this.createView(section);\n\n\t\tview.on(\"resized\", this.counter.bind(this));\n\n\t\tthis.views.prepend(view);\n\t\treturn view;\n\t};\n\n\tcounter(bounds){\n\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t};\n\n\tupdate(_offset){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.all();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tvar updating = new defer();\n\t\tvar promises = [];\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\n\t\t\tisVisible = this.isVisible(view, offset, offset, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tif (!view.displayed) {\n\t\t\t\t\tpromises.push(view.display(this.request).then(function (view) {\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tvisible.push(view);\n\t\t\t} else {\n\t\t\t\tthis.q.enqueue(view.destroy.bind(view));\n\n\t\t\t\tclearTimeout(this.trimTimeout);\n\t\t\t\tthis.trimTimeout = setTimeout(function(){\n\t\t\t\t\tthis.q.enqueue(this.trim.bind(this));\n\t\t\t\t}.bind(this), 250);\n\t\t\t}\n\n\t\t}\n\n\t\tif(promises.length){\n\t\t\treturn Promise.all(promises);\n\t\t} else {\n\t\t\tupdating.resolve();\n\t\t\treturn updating.promise;\n\t\t}\n\n\t};\n\n\tcheck(_offsetLeft, _offsetTop){\n\t\tvar last, first, next, prev;\n\n\t\tvar checking = new defer();\n\t\tvar newViews = [];\n\n\t\tvar horizontal = (this.settings.axis === \"horizontal\");\n\t\tvar delta = this.settings.offset || 0;\n\n\t\tif (_offsetLeft && horizontal) {\n\t\t\tdelta = _offsetLeft;\n\t\t}\n\n\t\tif (_offsetTop && !horizontal) {\n\t\t\tdelta = _offsetTop;\n\t\t}\n\n\t\tvar bounds = this._bounds; // bounds saved this until resize\n\n\t\tvar offset = horizontal ? this.scrollLeft : this.scrollTop;\n\t\tvar visibleLength = horizontal ? bounds.width : bounds.height;\n\t\tvar contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n\n\t\tif (offset + visibleLength + delta >= contentLength) {\n\t\t\tlast = this.views.last();\n\t\t\tnext = last && last.section.next();\n\t\t\tif(next) {\n\t\t\t\tnewViews.push(this.append(next));\n\t\t\t}\n\t\t}\n\n\t\tif (offset - delta < 0 ) {\n\t\t\tfirst = this.views.first();\n\t\t\tprev = first && first.section.prev();\n\t\t\tif(prev) {\n\t\t\t\tnewViews.push(this.prepend(prev));\n\t\t\t}\n\t\t}\n\n\t\tif(newViews.length){\n\t\t\t// Promise.all(promises)\n\t\t\t\t// .then(function() {\n\t\t\t\t\t// Check to see if anything new is on screen after rendering\n\t\t\t\t\treturn this.q.enqueue(function(){\n\t\t\t\t\t\treturn this.update(delta);\n\t\t\t\t\t}.bind(this));\n\n\n\t\t\t\t// }.bind(this));\n\n\t\t} else {\n\t\t\tchecking.resolve(false);\n\t\t\treturn checking.promise;\n\t\t}\n\n\n\t};\n\n\ttrim(){\n\t\tvar task = new defer();\n\t\tvar displayed = this.views.displayed();\n\t\tvar first = displayed[0];\n\t\tvar last = displayed[displayed.length-1];\n\t\tvar firstIndex = this.views.indexOf(first);\n\t\tvar lastIndex = this.views.indexOf(last);\n\t\tvar above = this.views.slice(0, firstIndex);\n\t\tvar below = this.views.slice(lastIndex+1);\n\n\t\t// Erase all but last above\n\t\tfor (var i = 0; i < above.length-1; i++) {\n\t\t\tthis.erase(above[i], above);\n\t\t}\n\n\t\t// Erase all except first below\n\t\tfor (var j = 1; j < below.length; j++) {\n\t\t\tthis.erase(below[j]);\n\t\t}\n\n\t\ttask.resolve();\n\t\treturn task.promise;\n\t};\n\n\terase(view, above){ //Trim\n\n\t\tvar prevTop;\n\t\tvar prevLeft;\n\n\t\tif(this.settings.height) {\n\t\t\tprevTop = this.container.scrollTop;\n\t\t\tprevLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tprevTop = window.scrollY;\n\t\t\tprevLeft = window.scrollX;\n\t\t}\n\n\t\tvar bounds = view.bounds();\n\n\t\tthis.views.remove(view);\n\n\t\tif(above) {\n\n\t\t\tif(this.settings.axis === \"vertical\") {\n\t\t\t\tthis.scrollTo(0, prevTop - bounds.height, true);\n\t\t\t} else {\n\t\t\t\tthis.scrollTo(prevLeft - bounds.width, 0, true);\n\t\t\t}\n\t\t}\n\n\t};\n\n\taddEventListeners(stage){\n\n\t\twindow.addEventListener('unload', function(e){\n\t\t\tthis.ignore = true;\n\t\t\t// this.scrollTo(0,0);\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tthis.addScrollListeners();\n\t};\n\n\taddScrollListeners() {\n\t\tvar scroller;\n\n\t\tthis.tick = requestAnimationFrame;\n\n\t\tif(this.settings.height) {\n\t\t\tthis.prevScrollTop = this.container.scrollTop;\n\t\t\tthis.prevScrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tthis.prevScrollTop = window.scrollY;\n\t\t\tthis.prevScrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollDeltaVert = 0;\n\t\tthis.scrollDeltaHorz = 0;\n\n\t\tif(this.settings.height) {\n\t\t\tscroller = this.container;\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t\tthis.scrollTop = window.scrollY;\n\t\t\tthis.scrollLeft = window.scrollX;\n\t\t}\n\n\t\tscroller.addEventListener(\"scroll\", this.onScroll.bind(this));\n\n\t\t// this.tick.call(window, this.onScroll.bind(this));\n\n\t\tthis.scrolled = false;\n\n\t};\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\t// if(!this.ignore) {\n\n\t\t\tif(this.settings.height) {\n\t\t\t\tscrollTop = this.container.scrollTop;\n\t\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t\t} else {\n\t\t\t\tscrollTop = window.scrollY;\n\t\t\t\tscrollLeft = window.scrollX;\n\t\t\t}\n\n\t\t\tthis.scrollTop = scrollTop;\n\t\t\tthis.scrollLeft = scrollLeft;\n\n\t\t\tif(!this.ignore) {\n\n\t\t\t\tif((this.scrollDeltaVert === 0 &&\n\t\t\t\t\t this.scrollDeltaHorz === 0) ||\n\t\t\t\t\t this.scrollDeltaVert > this.settings.offsetDelta ||\n\t\t\t\t\t this.scrollDeltaHorz > this.settings.offsetDelta) {\n\n\t\t\t\t\tthis.q.enqueue(function() {\n\t\t\t\t\t\tthis.check();\n\t\t\t\t\t}.bind(this));\n\t\t\t\t\t// this.check();\n\n\t\t\t\t\tthis.scrollDeltaVert = 0;\n\t\t\t\t\tthis.scrollDeltaHorz = 0;\n\n\t\t\t\t\tthis.emit(\"scroll\", {\n\t\t\t\t\t\ttop: scrollTop,\n\t\t\t\t\t\tleft: scrollLeft\n\t\t\t\t\t});\n\n\t\t\t\t\tclearTimeout(this.afterScrolled);\n\t\t\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\t\t\tthis.emit(\"scrolled\", {\n\t\t\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t\t\t});\n\t\t\t\t\t}.bind(this));\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tthis.ignore = false;\n\t\t\t}\n\n\t\t\tthis.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\n\t\t\tthis.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\n\n\t\t\tthis.prevScrollTop = scrollTop;\n\t\t\tthis.prevScrollLeft = scrollLeft;\n\n\t\t\tclearTimeout(this.scrollTimeout);\n\t\t\tthis.scrollTimeout = setTimeout(function(){\n\t\t\t\tthis.scrollDeltaVert = 0;\n\t\t\t\tthis.scrollDeltaHorz = 0;\n\t\t\t}.bind(this), 150);\n\n\n\t\t\tthis.scrolled = false;\n\t\t// }\n\n\t\t// this.tick.call(window, this.onScroll.bind(this));\n\n\t};\n\n\n\t//  resizeView(view) {\n\t//\n\t// \tif(this.settings.axis === \"horizontal\") {\n\t// \t\tview.lock(\"height\", this.stage.width, this.stage.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.stage.width, this.stage.height);\n\t// \t}\n\t//\n\t// };\n\n\tcurrentLocation(){\n\n\t\tif (this.settings.axis === \"vertical\") {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t} else {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t}\n\n\t\treturn this.location;\n\t};\n\n\tscrolledLocation(){\n\n\t\tvar visible = this.visible();\n\t\tvar startPage, endPage;\n\n\t\tvar container = this.container.getBoundingClientRect();\n\n\t\tif(visible.length === 1) {\n\t\t\treturn this.mapping.page(visible[0].contents, visible[0].section.cfiBase);\n\t\t}\n\n\t\tif(visible.length > 1) {\n\n\t\t\tstartPage = this.mapping.page(visible[0].contents, visible[0].section.cfiBase);\n\t\t\tendPage = this.mapping.page(visible[visible.length-1].contents, visible[visible.length-1].section.cfiBase);\n\n\t\t\treturn {\n\t\t\t\tstart: startPage.start,\n\t\t\t\tend: endPage.end\n\t\t\t};\n\t\t}\n\n\t};\n\n\tpaginatedLocation(){\n\t\tvar visible = this.visible();\n\t\tvar startA, startB, endA, endB;\n\t\tvar pageLeft, pageRight;\n\t\tvar container = this.container.getBoundingClientRect();\n\n\t\tif(visible.length === 1) {\n\t\t\tstartA = container.left - visible[0].position().left;\n\t\t\tendA = startA + this.layout.spreadWidth;\n\n\t\t\treturn this.mapping.page(visible[0].contents, visible[0].section.cfiBase, startA, endA);\n\t\t}\n\n\t\tif(visible.length > 1) {\n\n\t\t\t// Left Col\n\t\t\tstartA = container.left - visible[0].position().left;\n\t\t\tendA = startA + this.layout.columnWidth;\n\n\t\t\t// Right Col\n\t\t\tstartB = container.left + this.layout.spreadWidth - visible[visible.length-1].position().left;\n\t\t\tendB = startB + this.layout.columnWidth;\n\n\t\t\tpageLeft = this.mapping.page(visible[0].contents, visible[0].section.cfiBase, startA, endA);\n\t\t\tpageRight = this.mapping.page(visible[visible.length-1].contents, visible[visible.length-1].section.cfiBase, startB, endB);\n\n\t\t\treturn {\n\t\t\t\tstart: pageLeft.start,\n\t\t\t\tend: pageRight.end\n\t\t\t};\n\t\t}\n\t};\n\n\t/*\n\tcurrent(what){\n\t\tvar view, top;\n\t\tvar container = this.container.getBoundingClientRect();\n\t\tvar length = this.views.length - 1;\n\n\t\tif(this.settings.axis === \"horizontal\") {\n\n\t\t\tfor (var i = length; i >= 0; i--) {\n\t\t\t\tview = this.views[i];\n\t\t\t\tleft = view.position().left;\n\n\t\t\t\tif(left < container.right) {\n\n\t\t\t\t\tif(this._current == view) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._current = view;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tfor (var i = length; i >= 0; i--) {\n\t\t\t\tview = this.views[i];\n\t\t\t\ttop = view.bounds().top;\n\t\t\t\tif(top < container.bottom) {\n\n\t\t\t\t\tif(this._current == view) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._current = view;\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\treturn this._current;\n\t};\n\t*/\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta;\n\n\t\t\tthis.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\n\t};\n\n\tnext(){\n\n\t\tif(this.settings.axis === \"horizontal\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif(this.container.scrollLeft +\n\t\t\t\t this.container.offsetWidth +\n\t\t\t\t this.layout.delta < this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0);\n\t\t\t} else {\n\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0);\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.scrollBy(0, this.layout.height);\n\t\t}\n\t};\n\n\tprev(){\n\t\tif(this.settings.axis === \"horizontal\") {\n\t\t\tthis.scrollBy(-this.layout.delta, 0);\n\t\t} else {\n\t\t\tthis.scrollBy(0, -this.layout.height);\n\t\t}\n\t};\n\n\tupdateFlow(flow){\n\t\tvar axis = (flow === \"paginated\") ? \"horizontal\" : \"vertical\";\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tthis.settings.overflow = (flow === \"paginated\") ? \"hidden\" : \"auto\";\n\n\t\t// this.views.each(function(view){\n\t\t// \tview.setAxis(axis);\n\t\t// });\n\n\t\tif (this.settings.axis === \"vertical\") {\n\t\t\tthis.settings.infinite = true;\n\t\t} else {\n\t\t\tthis.settings.infinite = false;\n\t\t}\n\n\t};\n}\n\nexport default ContinuousViewManager;\n\n\n\n// WEBPACK FOOTER //\n// ./src/managers/continuous/index.js","import EventEmitter from 'event-emitter';\nimport {extend, borders, uuid, isNumber, bounds, defer} from '../../utils/core';\nimport EpubCFI from '../../epubcfi';\nimport Contents from '../../contents';\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : '',\n\t\t\taxis: 'vertical',\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\tthis.width  = this.settings.width;\n\t\tthis.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\t};\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement('div');\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.display = \"inline-block\";\n\t\t} else {\n\t\t\telement.style.display = \"block\";\n\t\t}\n\n\t\treturn element;\n\t};\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement('iframe');\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.appendChild(this.iframe);\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\t\t// Firefox has trouble with baseURI and srcdoc\n\t\t// TODO: Disable for now in firefox\n\n\t\tif(!!(\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\treturn this.iframe;\n\t};\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t// .then(function(doc){\n\t\t\t// \treturn this.hooks.content.trigger(view, this);\n\t\t\t// }.bind(this))\n\t\t\t.then(function(){\n\t\t\t\t// this.settings.layout.format(view.contents);\n\t\t\t\t// return this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t// .then(function(){\n\t\t\t// \treturn this.display();\n\t\t\t// }.bind(this))\n\t\t\t// .then(function(){\n\t\t\t// \treturn this.hooks.render.trigger(view, this);\n\t\t\t// }.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\tthis.settings.layout.format(this.contents);\n\n\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\tthis.expand();\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\tif(show !== false) {\n\t\t\t\t\t//this.q.enqueue(function(view){\n\t\t\t\t\t\t// this.show();\n\t\t\t\t\t//}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\t//this.hooks.show.trigger(view, this);\n\t\t\t\tthis.emit(\"rendered\", this.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tconsole.error(e);\n\t\t\t\tthis.emit(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t};\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t};\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\tthis.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\n\t\t\tthis.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t\t// this.contents.layout();\n\t\t\t\tthis.expand();\n\n\t\t}\n\n\n\n\t};\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\t// Expand Horizontally\n\t\t// if(height && !width) {\n\t\tif(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\ttextWidth = this.contents.textWidth();\n\t\t\t// Check if the textWidth has changed\n\t\t\tif(textWidth != this._textWidth){\n\t\t\t\t// Get the contentWidth by resizing the iframe\n\t\t\t\t// Check with a min reset of the textWidth\n\t\t\t\twidth = this.contentWidth(textWidth);\n\n\t\t\t\tcolumns = Math.ceil(width / (this.settings.layout.columnWidth + this.settings.layout.gap));\n\n\t\t\t\tif ( this.settings.layout.divisor > 1 &&\n\t\t\t\t\t\t this.settings.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t\t// add a blank page\n\t\t\t\t\t\twidth += this.settings.layout.gap + this.settings.layout.columnWidth;\n\t\t\t\t}\n\n\t\t\t\t// Save the textWdith\n\t\t\t\tthis._textWidth = textWidth;\n\t\t\t\t// Save the contentWidth\n\t\t\t\tthis._contentWidth = width;\n\t\t\t} else {\n\t\t\t\t// Otherwise assume content height hasn't changed\n\t\t\t\twidth = this._contentWidth;\n\t\t\t}\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\ttextHeight = this.contents.textHeight();\n\t\t\tif(textHeight != this._textHeight){\n\t\t\t\theight = this.contentHeight(textHeight);\n\t\t\t\tthis._textHeight = textHeight;\n\t\t\t\tthis._contentHeight = height;\n\t\t\t} else {\n\t\t\t\theight = this._contentHeight;\n\t\t\t}\n\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.resize(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t};\n\n\tcontentWidth(min) {\n\t\tvar prev;\n\t\tvar width;\n\n\t\t// Save previous width\n\t\tprev = this.iframe.style.width;\n\t\t// Set the iframe size to min, width will only ever be greater\n\t\t// Will preserve the aspect ratio\n\t\tthis.iframe.style.width = (min || 0) + \"px\";\n\t\t// Get the scroll overflow width\n\t\twidth = this.contents.scrollWidth();\n\t\t// Reset iframe size back\n\t\tthis.iframe.style.width = prev;\n\t\treturn width;\n\t};\n\n\tcontentHeight(min) {\n\t\tvar prev;\n\t\tvar height;\n\n\t\tprev = this.iframe.style.height;\n\t\tthis.iframe.style.height = (min || 0) + \"px\";\n\t\theight = this.contents.scrollHeight();\n\n\t\tthis.iframe.style.height = prev;\n\t\treturn height;\n\t};\n\n\n\tresize(width, height) {\n\n\t\tif(!this.iframe) return;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tthis.iframeBounds = bounds(this.iframe);\n\n\t\tthis.reframe(this.iframeBounds.width, this.iframeBounds.height);\n\n\t};\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\t// if(!this.displayed) {\n\t\t//   this._needsReframe = true;\n\t\t//   return;\n\t\t// }\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t}\n\n\t\tthis.prevBounds = this.elementBounds;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\tsize = {\n\t\t\twidth: this.elementBounds.width,\n\t\t\theight: this.elementBounds.height,\n\t\t\twidthDelta: this.elementBounds.width - this.prevBounds.width,\n\t\t\theightDelta: this.elementBounds.height - this.prevBounds.height,\n\t\t};\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(\"resized\", size);\n\n\t};\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif(this.supportsSrcdoc){\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t} else {\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t};\n\n\tonLoad(event, promise) {\n\n\t\t\tthis.window = this.iframe.contentWindow;\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase);\n\n\t\t\tthis.rendering = false;\n\n\t\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\t\tif (link) {\n\t\t\t\tlink.setAttribute(\"href\", this.section.url);\n\t\t\t} else {\n\t\t\t\tlink = this.document.createElement(\"link\");\n\t\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\t\tlink.setAttribute(\"href\", this.section.url);\n\t\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t\t}\n\n\t\t\tthis.contents.on(\"expand\", function () {\n\t\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\t\t\tthis.expand();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.resolve(this.contents);\n\t};\n\n\n\n\t// layout(layoutFunc) {\n\t//\n\t//   this.iframe.style.display = \"inline-block\";\n\t//\n\t//   // Reset Body Styles\n\t//   // this.document.body.style.margin = \"0\";\n\t//   //this.document.body.style.display = \"inline-block\";\n\t//   //this.document.documentElement.style.width = \"auto\";\n\t//\n\t//   if(layoutFunc){\n\t//     this.layoutFunc = layoutFunc;\n\t//   }\n\t//\n\t//   this.contents.layout(this.layoutFunc);\n\t//\n\t// };\n\t//\n\t// onLayout(view) {\n\t//   // stub\n\t// };\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\t};\n\n\tsetAxis(axis) {\n\t\tthis.settings.axis = axis;\n\t};\n\n\tresizeListenters() {\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\t\tthis.expanding = setTimeout(this.expand.bind(this), 350);\n\t};\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t};\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t};\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request).then(function () {\n\n\t\t\t\tthis.emit(\"displayed\", this);\n\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\tthis.displayed = true;\n\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t}.bind(this));\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t};\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\t\t}\n\n\t\tthis.emit(\"shown\", this);\n\t};\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\tthis.emit(\"hidden\", this);\n\t};\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t};\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": window.scrollX + parentPos.left + targetPos.left,\n\t\t\t\"top\": window.scrollY + parentPos.top + targetPos.top\n\t\t};\n\t};\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t};\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t};\n\n\tbounds() {\n\t\tif(!this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\t\treturn this.elementBounds;\n\t};\n\n\tdestroy() {\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\t\t\tthis.displayed = false;\n\t\t\tthis.iframe = null;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t};\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n\n\n\n// WEBPACK FOOTER //\n// ./src/managers/views/iframe.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() { return this; })();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 18\n// module chunks = 0","/*\n From Zip.js, by Gildas Lormeau\nedited down\n */\n\nvar table = {\n\t\"application\" : {\n\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\n\t\t\"javascript\" : \"js\",\n\t\t\"ogg\" : \"ogx\",\n\t\t\"pdf\" : \"pdf\",\n\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\n\t\t\"rdf+xml\" : \"rdf\",\n\t\t\"smil\" : [ \"smi\", \"smil\" ],\n\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\n\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\" ],\n\t\t\"zip\" : \"zip\",\n\t\t\"x-httpd-eruby\" : \"rhtml\",\n\t\t\"x-latex\" : \"latex\",\n\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\n\t\t\"x-object\" : \"o\",\n\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\n\t\t\"x-silverlight\" : \"scr\",\n\t\t\"epub+zip\" : \"epub\",\n\t\t\"font-tdpfr\" : \"pfr\",\n\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\n\t\t\"json\" : \"json\",\n\t\t\"jsonml+json\" : \"jsonml\",\n\t\t\"mathml+xml\" : \"mathml\",\n\t\t\"metalink+xml\" : \"metalink\",\n\t\t\"mp4\" : \"mp4s\",\n\t\t// \"oebps-package+xml\" : \"opf\",\n\t\t\"omdoc+xml\" : \"omdoc\",\n\t\t\"oxps\" : \"oxps\",\n\t\t\"vnd.amazon.ebook\" : \"azw\",\n\t\t\"widget\" : \"wgt\",\n\t\t// \"x-dtbncx+xml\" : \"ncx\",\n\t\t\"x-dtbook+xml\" : \"dtb\",\n\t\t\"x-dtbresource+xml\" : \"res\",\n\t\t\"x-font-bdf\" : \"bdf\",\n\t\t\"x-font-ghostscript\" : \"gsf\",\n\t\t\"x-font-linux-psf\" : \"psf\",\n\t\t\"x-font-otf\" : \"otf\",\n\t\t\"x-font-pcf\" : \"pcf\",\n\t\t\"x-font-snf\" : \"snf\",\n\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\n\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\n\t\t\"x-font-woff\" : \"woff\",\n\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\n\t\t\"x-mspublisher\" : \"pub\",\n\t\t\"x-nzb\" : \"nzb\",\n\t\t\"x-tgif\" : \"obj\",\n\t\t\"xaml+xml\" : \"xaml\",\n\t\t\"xml-dtd\" : \"dtd\",\n\t\t\"xproc+xml\" : \"xpl\",\n\t\t\"xslt+xml\" : \"xslt\",\n\t\t\"internet-property-stream\" : \"acx\",\n\t\t\"x-compress\" : \"z\",\n\t\t\"x-compressed\" : \"tgz\",\n\t\t\"x-gzip\" : \"gz\",\n\t},\n\t\"audio\" : {\n\t\t\"flac\" : \"flac\",\n\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\n\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\n\t\t\"mpegurl\" : \"m3u\",\n\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\n\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\n\t\t\"x-ms-wma\" : \"wma\",\n\t\t\"x-wav\" : \"wav\",\n\t\t\"adpcm\" : \"adp\",\n\t\t\"mp4\" : \"mp4a\",\n\t\t\"webm\" : \"weba\",\n\t\t\"x-aac\" : \"aac\",\n\t\t\"x-caf\" : \"caf\",\n\t\t\"x-matroska\" : \"mka\",\n\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\n\t\t\"xm\" : \"xm\",\n\t\t\"mid\" : [ \"mid\", \"rmi\" ]\n\t},\n\t\"image\" : {\n\t\t\"gif\" : \"gif\",\n\t\t\"ief\" : \"ief\",\n\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\n\t\t\"pcx\" : \"pcx\",\n\t\t\"png\" : \"png\",\n\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\n\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\n\t\t\"x-icon\" : \"ico\",\n\t\t\"bmp\" : \"bmp\",\n\t\t\"webp\" : \"webp\",\n\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\n\t\t\"x-tga\" : \"tga\",\n\t\t\"cis-cod\" : \"cod\"\n\t},\n\t\"text\" : {\n\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\n\t\t\"css\" : \"css\",\n\t\t\"csv\" : \"csv\",\n\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\n\t\t\"mathml\" : \"mml\",\n\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\n\t\t\"richtext\" : \"rtx\",\n\t\t\"tab-separated-values\" : \"tsv\",\n\t\t\"x-bibtex\" : \"bib\"\n\t},\n\t\"video\" : {\n\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\n\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\n\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\n\t\t\"ogg\" : \"ogv\",\n\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\n\t\t\"x-flv\" : \"flv\",\n\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\n\t\t\"x-mng\" : \"mng\",\n\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\n\t\t\"x-ms-wm\" : \"wm\",\n\t\t\"x-ms-wmv\" : \"wmv\",\n\t\t\"x-ms-wmx\" : \"wmx\",\n\t\t\"x-ms-wvx\" : \"wvx\",\n\t\t\"x-msvideo\" : \"avi\",\n\t\t\"x-sgi-movie\" : \"movie\",\n\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\n\t\t\"3gpp2\" : \"3g2\",\n\t\t\"h261\" : \"h261\",\n\t\t\"h263\" : \"h263\",\n\t\t\"h264\" : \"h264\",\n\t\t\"jpeg\" : \"jpgv\",\n\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\n\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\n\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\n\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\n\t\t\"vnd.vivo\" : \"viv\",\n\t\t\"webm\" : \"webm\",\n\t\t\"x-f4v\" : \"f4v\",\n\t\t\"x-m4v\" : \"m4v\",\n\t\t\"x-ms-vob\" : \"vob\",\n\t\t\"x-smv\" : \"smv\"\n\t}\n};\n\nvar mimeTypes = (function() {\n\tvar type, subtype, val, index, mimeTypes = {};\n\tfor (type in table) {\n\t\tif (table.hasOwnProperty(type)) {\n\t\t\tfor (subtype in table[type]) {\n\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\n\t\t\t\t\tval = table[type][subtype];\n\t\t\t\t\tif (typeof val == \"string\") {\n\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\n\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn mimeTypes;\n})();\n\nvar defaultValue = \"text/plain\";//\"application/octet-stream\";\n\nfunction lookup(filename) {\n\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\n};\n\nmodule.exports = {\n\t'lookup': lookup\n}\n\n\n\n// WEBPACK FOOTER //\n// ./libs/mime/mime.js","import {defer, isXml, parse} from './utils/core';\nimport request from './request';\nimport mime from '../libs/mime/mime';\nimport Path from './utils/path';\n\n/**\n * Handles Unzipping a requesting files from an Epub Archive\n * @class\n */\nclass Archive {\n\tconstructor() {\n\t\tthis.zip = undefined;\n\t\tthis.checkRequirements();\n\t\tthis.urlCache = {};\n\t}\n\n\t/**\n\t * Checks to see if JSZip exists in global namspace,\n\t * Requires JSZip if it isn't there\n\t * @private\n\t */\n\tcheckRequirements(){\n\t\ttry {\n\t\t\tif (typeof JSZip === 'undefined') {\n\t\t\t\tJSZip = require('jszip');\n\t\t\t}\n\t\t\tthis.zip = new JSZip();\n\t\t} catch (e) {\n\t\t\tconsole.error(\"JSZip lib not loaded\");\n\t\t}\n\t};\n\n\t/**\n\t * Open an archive\n\t * @param  {binary} input\n\t * @param  {boolean} isBase64 tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topen(input, isBase64){\n\t\treturn this.zip.loadAsync(input, {\"base64\": isBase64});\n\t};\n\n\t/**\n\t * Load and Open an archive\n\t * @param  {string} zipUrl\n\t * @param  {boolean} isBase64 tells JSZip if the input data is base64 encoded\n\t * @return {Promise} zipfile\n\t */\n\topenUrl(zipUrl, isBase64){\n\t\treturn request(zipUrl, \"binary\")\n\t\t\t.then(function(data){\n\t\t\t\treturn this.zip.loadAsync(data, {\"base64\": isBase64});\n\t\t\t}.bind(this));\n\t};\n\n\t/**\n\t * Request\n\t * @param  {string} url  a url to request from the archive\n\t * @param  {[string]} type specify the type of the returned result\n\t * @return {Promise}\n\t */\n\trequest(url, type){\n\t\tvar deferred = new defer();\n\t\tvar response;\n\t\tvar r;\n\t\tvar path = new Path(url);\n\n\t\t// If type isn't set, determine it from the file extension\n\t\tif(!type) {\n\t\t\ttype = path.extension;\n\t\t}\n\n\t\tif(type == 'blob'){\n\t\t\tresponse = this.getBlob(url);\n\t\t} else {\n\t\t\tresponse = this.getText(url);\n\t\t}\n\n\t\tif (response) {\n\t\t\tresponse.then(function (r) {\n\t\t\t\tlet result = this.handleResponse(r, type);\n\t\t\t\tdeferred.resolve(result);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\t\treturn deferred.promise;\n\t};\n\n\t/**\n\t * Handle the response from request\n\t * @private\n\t * @param  {any} response\n\t * @param  {[string]} type\n\t * @return {any} the parsed result\n\t */\n\thandleResponse(response, type){\n\t\tvar r;\n\n\t\tif(type == \"json\") {\n\t\t\tr = JSON.parse(response);\n\t\t}\n\t\telse\n\t\tif(isXml(type)) {\n\t\t\tr = parse(response, \"text/xml\");\n\t\t}\n\t\telse\n\t\tif(type == 'xhtml') {\n\t\t\tr = parse(response, \"application/xhtml+xml\");\n\t\t}\n\t\telse\n\t\tif(type == 'html' || type == 'htm') {\n\t\t\tr = parse(response, \"text/html\");\n\t\t } else {\n\t\t\t r = response;\n\t\t }\n\n\t\treturn r;\n\t};\n\n\t/**\n\t * Get a Blob from Archive by Url\n\t * @param  {string} url\n\t * @param  {[string]} mimeType\n\t * @return {Blob}\n\t */\n\tgetBlob(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"uint8array\").then(function(uint8array) {\n\t\t\t\treturn new Blob([uint8array], {type : mimeType});\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Get Text from Archive by Url\n\t * @param  {string} url\n\t * @param  {[string]} encoding\n\t * @return {string}\n\t */\n\tgetText(url, encoding){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\treturn entry.async(\"string\").then(function(text) {\n\t\t\t\treturn text;\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Get a base64 encoded result from Archive by Url\n\t * @param  {string} url\n\t * @param  {[string]} mimeType\n\t * @return {string} base64 encoded\n\t */\n\tgetBase64(url, mimeType){\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\t\tvar entry = this.zip.file(decodededUrl);\n\n\t\tif(entry) {\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\n\t\t\treturn entry.async(\"base64\").then(function(data) {\n\t\t\t\treturn \"data:\" + mimeType + \";base64,\" + data;\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Create a Url from an unarchived item\n\t * @param  {string} url\n\t * @param  {[object]} options.base64 use base64 encoding or blob url\n\t * @return {Promise} url promise with Url string\n\t */\n\tcreateUrl(url, options){\n\t\tvar deferred = new defer();\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar tempUrl;\n\t\tvar blob;\n\t\tvar response;\n\t\tvar useBase64 = options && options.base64;\n\n\t\tif(url in this.urlCache) {\n\t\t\tdeferred.resolve(this.urlCache[url]);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tif (useBase64) {\n\t\t\tresponse = this.getBase64(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(tempUrl) {\n\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresponse = this.getBlob(url);\n\n\t\t\tif (response) {\n\t\t\t\tresponse.then(function(blob) {\n\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\n\t\t\t\t\tdeferred.resolve(tempUrl);\n\n\t\t\t\t}.bind(this));\n\n\t\t\t}\n\t\t}\n\n\n\t\tif (!response) {\n\t\t\tdeferred.reject({\n\t\t\t\tmessage : \"File not found in the epub: \" + url,\n\t\t\t\tstack : new Error().stack\n\t\t\t});\n\t\t}\n\n\t\treturn deferred.promise;\n\t};\n\n\t/**\n\t * Revoke Temp Url for a achive item\n\t * @param  {string} url url of the item in the archive\n\t */\n\trevokeUrl(url){\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\n\t\tvar fromCache = this.urlCache[url];\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\n\t};\n}\n\nexport default Archive;\n\n\n\n// WEBPACK FOOTER //\n// ./src/archive.js","import path from 'path-webpack';\nimport {qs} from './utils/core';\nimport EpubCFI from './epubcfi';\n\n/**\n * Handles Parsing and Accessing an Epub Container\n * @class\n * @param {[document]} containerDocument xml document\n */\nclass Container {\n\tconstructor(containerDocument) {\n\t\tif (containerDocument) {\n\t\t\tthis.parse(containerDocument);\n\t\t}\n\t};\n\n\t/**\n\t * Parse the Container XML\n\t * @param  {document} containerDocument\n\t */\n\tparse(containerDocument){\n\t\t\t//-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\n\t\t\tvar rootfile, fullpath, folder, encoding;\n\n\t\t\tif(!containerDocument) {\n\t\t\t\tconsole.error(\"Container File Not Found\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trootfile = qs(containerDocument, \"rootfile\");\n\n\t\t\tif(!rootfile) {\n\t\t\t\tconsole.error(\"No RootFile Found\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.packagePath = rootfile.getAttribute('full-path');\n\t\t\tthis.directory = path.dirname(this.packagePath);\n\t\t\tthis.encoding = containerDocument.xmlEncoding;\n\t};\n}\n\nexport default Container;\n\n\n\n// WEBPACK FOOTER //\n// ./src/container.js","import core from './utils/core';\n\n/**\n * Figures out the CSS to apply for a layout\n * @class\n * @param {object} settings\n * @param {[string=reflowable]} settings.layout\n * @param {[string]} settings.spread\n * @param {[int=800]} settings.minSpreadWidth\n * @param {[boolean=false]} settings.evenSpreads\n */\nclass Layout {\n\tconstructor(settings) {\n\t\tthis.name = settings.layout || \"reflowable\";\n\t\tthis._spread = (settings.spread === \"none\") ? false : true;\n\t\tthis._minSpreadWidth = settings.minSpreadWidth || 800;\n\t\tthis._evenSpreads = settings.evenSpreads || false;\n\n\t\tif (settings.flow === \"scrolled-continuous\" ||\n\t\t\t\tsettings.flow === \"scrolled-doc\") {\n\t\t\tthis._flow = \"scrolled\";\n\t\t} else {\n\t\t\tthis._flow = \"paginated\";\n\t\t}\n\n\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.spreadWidth = 0;\n\t\tthis.delta = 0;\n\n\t\tthis.columnWidth = 0;\n\t\tthis.gap = 0;\n\t\tthis.divisor = 1;\n\t};\n\n\t/**\n\t * Switch the flow between paginated and scrolled\n\t * @param  {string} flow paginated | scrolled\n\t */\n\tflow(flow) {\n\t\tthis._flow = (flow === \"paginated\") ? \"paginated\" : \"scrolled\";\n\t}\n\n\t/**\n\t * Switch between using spreads or not, and set the\n\t * width at which they switch to single.\n\t * @param  {string} spread true | false\n\t * @param  {boolean} min integer in pixels\n\t */\n\tspread(spread, min) {\n\n\t\tthis._spread = (spread === \"none\") ? false : true;\n\n\t\tif (min >= 0) {\n\t\t\tthis._minSpreadWidth = min;\n\t\t}\n\t}\n\n\t/**\n\t * Calculate the dimensions of the pagination\n\t * @param  {number} _width  [description]\n\t * @param  {number} _height [description]\n\t * @param  {number} _gap    [description]\n\t */\n\tcalculate(_width, _height, _gap){\n\n\t\tvar divisor = 1;\n\t\tvar gap = _gap || 0;\n\n\t\t//-- Check the width and create even width columns\n\t\tvar fullWidth = Math.floor(_width);\n\t\tvar width = _width;\n\n\t\tvar section = Math.floor(width / 8);\n\n\t\tvar colWidth;\n\t\tvar spreadWidth;\n\t\tvar delta;\n\n\t\tif (this._spread && width >= this._minSpreadWidth) {\n\t\t\tdivisor = 2;\n\t\t} else {\n\t\t\tdivisor = 1;\n\t\t}\n\n\t\tif (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\n\t\t\tgap = ((section % 2 === 0) ? section : section - 1);\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" ) {\n\t\t\tgap = 0;\n\t\t}\n\n\t\t//-- Double Page\n\t\tif(divisor > 1) {\n\t\t\tcolWidth = (width - gap) / divisor;\n\t\t} else {\n\t\t\tcolWidth = width;\n\t\t}\n\n\t\tif (this.name === \"pre-paginated\" && divisor > 1) {\n\t\t\twidth = colWidth;\n\t\t}\n\n\t\tspreadWidth = colWidth * divisor;\n\n\t\tdelta = (colWidth + gap) * divisor;\n\n\t\tthis.width = width;\n\t\tthis.height = _height;\n\t\tthis.spreadWidth = spreadWidth;\n\t\tthis.delta = delta;\n\n\t\tthis.columnWidth = colWidth;\n\t\tthis.gap = gap;\n\t\tthis.divisor = divisor;\n\t};\n\n\t/**\n\t * Apply Css to a Document\n\t * @param  {Contents} contents\n\t * @return {[Promise]}\n\t */\n\tformat(contents){\n\t\tvar formating;\n\n\t\tif (this.name === \"pre-paginated\") {\n\t\t\tformating = contents.fit(this.columnWidth, this.height);\n\t\t} else if (this._flow === \"paginated\") {\n\t\t\tformating = contents.columns(this.width, this.height, this.columnWidth, this.gap);\n\t\t} else { // scrolled\n\t\t\tformating = contents.size(this.width, null);\n\t\t}\n\n\t\treturn formating; // might be a promise in some View Managers\n\t};\n\n\t/**\n\t * Count number of pages\n\t * @param  {number} totalWidth\n\t * @return {number} spreads\n\t * @return {number} pages\n\t */\n\tcount(totalWidth) {\n\t\t// var totalWidth = contents.scrollWidth();\n\t\tvar spreads = Math.ceil( totalWidth / this.spreadWidth);\n\n\t\treturn {\n\t\t\tspreads : spreads,\n\t\t\tpages : spreads * this.divisor\n\t\t};\n\t};\n}\n\nexport default Layout;\n\n\n\n// WEBPACK FOOTER //\n// ./src/layout.js","import {qs, sprint, locationOf} from './utils/core';\nimport Queue from './queue';\nimport EpubCFI from './epubcfi';\nimport EventEmitter from 'event-emitter';\n\n/**\n * Find Locations for a Book\n * @param {Spine} spine\n * @param {request} request\n */\nclass Locations {\n\tconstructor(spine, request) {\n\t\tthis.spine = spine;\n\t\tthis.request = request;\n\n\t\tthis.q = new Queue(this);\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis._locations = [];\n\t\tthis.total = 0;\n\n\t\tthis.break = 150;\n\n\t\tthis._current = 0;\n\n\t};\n\n\t/**\n\t * Load all of sections in the book to generate locations\n\t * @param  {int} chars how many chars to split on\n\t * @return {object} locations\n\t */\n\tgenerate(chars) {\n\n\t\tif (chars) {\n\t\t\tthis.break = chars;\n\t\t}\n\n\t\tthis.q.pause();\n\n\t\tthis.spine.each(function(section) {\n\n\t\t\tthis.q.enqueue(this.process.bind(this), section);\n\n\t\t}.bind(this));\n\n\t\treturn this.q.run().then(function() {\n\t\t\tthis.total = this._locations.length-1;\n\n\t\t\tif (this._currentCfi) {\n\t\t\t\tthis.currentLocation = this._currentCfi;\n\t\t\t}\n\n\t\t\treturn this._locations;\n\t\t\t// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\n\t\t}.bind(this));\n\n\t};\n\n\tcreateRange () {\n\t\treturn {\n\t\t\tstartContainer: undefined,\n\t\t\tstartOffset: undefined,\n\t\t\tendContainer: undefined,\n\t\t\tendOffset: undefined\n\t\t}\n\t};\n\n\tprocess(section) {\n\n\t\treturn section.load(this.request)\n\t\t\t.then(function(contents) {\n\t\t\t\tvar locations = this.parse(contents, section.cfiBase);\n\t\t\t\tthis._locations = this._locations.concat(locations);\n\t\t\t}.bind(this));\n\n\t};\n\n\tparse(contents, cfiBase, chars) {\n\t\tvar locations = [];\n\t\tvar range;\n\t\tvar doc = contents.ownerDocument;\n\t\tvar body = qs(doc, 'body');\n\t\tvar counter = 0;\n\t\tvar prev;\n\t\tvar _break = chars || this.break;\n\t\tvar parser = function(node) {\n\t\t\tvar len = node.length;\n\t\t\tvar dist;\n\t\t\tvar pos = 0;\n\n\t\t\tif (node.textContent.trim().length === 0) {\n\t\t\t\treturn false; // continue\n\t\t\t}\n\n\t\t\t// Start range\n\t\t\tif (counter == 0) {\n\t\t\t\trange = this.createRange();\n\t\t\t\trange.startContainer = node;\n\t\t\t\trange.startOffset = 0;\n\t\t\t}\n\n\t\t\tdist = _break - counter;\n\n\t\t\t// Node is smaller than a break,\n\t\t\t// skip over it\n\t\t\tif(dist > len){\n\t\t\t\tcounter += len;\n\t\t\t\tpos = len;\n\t\t\t}\n\n\t\t\twhile (pos < len) {\n\t\t\t\t// counter = this.break;\n\t\t\t\tpos += dist;\n\t\t\t\t// Gone over\n\t\t\t\tif(pos >= len){\n\t\t\t\t\t// Continue counter for next node\n\t\t\t\t\tcounter = len - (pos - _break);\n\t\t\t\t// At End\n\t\t\t\t} else {\n\t\t\t\t\t// End the previous range\n\t\t\t\t\trange.endContainer = node;\n\t\t\t\t\trange.endOffset = pos;\n\t\t\t\t\t// cfi = section.cfiFromRange(range);\n\t\t\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\t\t\tlocations.push(cfi);\n\t\t\t\t\tcounter = 0;\n\n\t\t\t\t\t// Start new range\n\t\t\t\t\tpos += 1;\n\t\t\t\t\trange = this.createRange();\n\t\t\t\t\trange.startContainer = node;\n\t\t\t\t\trange.startOffset = pos;\n\n\t\t\t\t\tdist = _break;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprev = node;\n\t\t};\n\n\t\tsprint(body, parser.bind(this));\n\n\t\t// Close remaining\n\t\tif (range && range.startContainer && prev) {\n\t\t\trange.endContainer = prev;\n\t\t\trange.endOffset = prev.length;\n\t\t\t// cfi = section.cfiFromRange(range);\n\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\n\t\t\tlocations.push(cfi);\n\t\t\tcounter = 0;\n\t\t}\n\n\t\treturn locations;\n\t};\n\n\tlocationFromCfi(cfi){\n\t\t// Check if the location has not been set yet\n\t\tif(this._locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn locationOf(cfi.start, this._locations, this.epubcfi.compare);\n\t};\n\n\tpercentageFromCfi(cfi) {\n\t\tif(this._locations.length === 0) {\n\t\t\treturn null;\n\t\t}\n\t\t// Find closest cfi\n\t\tvar loc = this.locationFromCfi(cfi);\n\t\t// Get percentage in total\n\t\treturn this.percentageFromLocation(loc);\n\t};\n\n\tpercentageFromLocation(loc) {\n\t\tif (!loc || !this.total) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn (loc / this.total);\n\t};\n\n\tcfiFromLocation(loc){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof loc != \"number\"){\n\t\t\tloc = parseInt(pg);\n\t\t}\n\n\t\tif(loc >= 0 && loc < this._locations.length) {\n\t\t\tcfi = this._locations[loc];\n\t\t}\n\n\t\treturn cfi;\n\t};\n\n\tcfiFromPercentage(value){\n\t\tvar percentage = (value > 1) ? value / 100 : value; // Normalize value to 0-1\n\t\tvar loc = Math.ceil(this.total * percentage);\n\n\t\treturn this.cfiFromLocation(loc);\n\t};\n\n\tload(locations){\n\t\tthis._locations = JSON.parse(locations);\n\t\tthis.total = this._locations.length-1;\n\t\treturn this._locations;\n\t};\n\n\tsave(json){\n\t\treturn JSON.stringify(this._locations);\n\t};\n\n\tgetCurrent(json){\n\t\treturn this._current;\n\t};\n\n\tsetCurrent(curr){\n\t\tvar loc;\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tthis._currentCfi = curr;\n\t\t} else if (typeof curr == \"number\") {\n\t\t\tthis._current = curr;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._locations.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(typeof curr == \"string\"){\n\t\t\tloc = this.locationFromCfi(curr);\n\t\t\tthis._current = loc;\n\t\t} else {\n\t\t\tloc = curr;\n\t\t}\n\n\t\tthis.emit(\"changed\", {\n\t\t\tpercentage: this.percentageFromLocation(loc)\n\t\t});\n\t};\n\n\tget currentLocation() {\n\t\treturn this._current;\n\t}\n\n\tset currentLocation(curr) {\n\t\tthis.setCurrent(curr);\n\t}\n\n\tlength () {\n\t\treturn this._locations.length;\n\t};\n}\n\nEventEmitter(Locations.prototype);\n\nexport default Locations;\n\n\n\n// WEBPACK FOOTER //\n// ./src/locations.js","import {uuid, isNumber, isElement, windowBounds} from '../../utils/core';\n\nclass Stage {\n\tconstructor(_options) {\n\t\tthis.settings = _options || {};\n\t\tthis.id = \"epubjs-container-\" + uuid();\n\n\t\tthis.container = this.create(this.settings);\n\n\t\tif(this.settings.hidden) {\n\t\t\tthis.wrapper = this.wrap(this.container);\n\t\t}\n\n\t}\n\n\t/*\n\t* Creates an element to render to.\n\t* Resizes to passed width and height or to the elements size\n\t*/\n\tcreate(options){\n\t\tvar height  = options.height;// !== false ? options.height : \"100%\";\n\t\tvar width   = options.width;// !== false ? options.width : \"100%\";\n\t\tvar overflow  = options.overflow || false;\n\t\tvar axis = options.axis || \"vertical\";\n\n\t\tif(options.height && isNumber(options.height)) {\n\t\t\theight = options.height + \"px\";\n\t\t}\n\n\t\tif(options.width && isNumber(options.width)) {\n\t\t\twidth = options.width + \"px\";\n\t\t}\n\n\t\t// Create new container element\n\t\tlet container = document.createElement(\"div\");\n\n\t\tcontainer.id = this.id;\n\t\tcontainer.classList.add(\"epub-container\");\n\n\t\t// Style Element\n\t\t// container.style.fontSize = \"0\";\n\t\tcontainer.style.wordSpacing = \"0\";\n\t\tcontainer.style.lineHeight = \"0\";\n\t\tcontainer.style.verticalAlign = \"top\";\n\n\t\tif(axis === \"horizontal\") {\n\t\t\tcontainer.style.whiteSpace = \"nowrap\";\n\t\t}\n\n\t\tif(width){\n\t\t\tcontainer.style.width = width;\n\t\t}\n\n\t\tif(height){\n\t\t\tcontainer.style.height = height;\n\t\t}\n\n\t\tif (overflow) {\n\t\t\tcontainer.style.overflow = overflow;\n\t\t}\n\n\t\treturn container;\n\t};\n\n\twrap(container) {\n\t\tvar wrapper = document.createElement(\"div\");\n\n\t\twrapper.style.visibility = \"hidden\";\n\t\twrapper.style.overflow = \"hidden\";\n\t\twrapper.style.width = \"0\";\n\t\twrapper.style.height = \"0\";\n\n\t\twrapper.appendChild(container);\n\t\treturn wrapper;\n\t};\n\n\n\tgetElement(_element){\n\t\tvar element;\n\n\t\tif(isElement(_element)) {\n\t\t\telement = _element;\n\t\t} else if (typeof _element === \"string\") {\n\t\t\telement = document.getElementById(_element);\n\t\t}\n\n\t\tif(!element){\n\t\t\tconsole.error(\"Not an Element\");\n\t\t\treturn;\n\t\t}\n\n\t\treturn element;\n\t};\n\n\tattachTo(what){\n\n\t\tvar element = this.getElement(what);\n\t\tvar base;\n\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.hidden) {\n\t\t\tbase = this.wrapper;\n\t\t} else {\n\t\t\tbase = this.container;\n\t\t}\n\n\t\telement.appendChild(base);\n\n\t\tthis.element = element;\n\n\t\treturn element;\n\n\t};\n\n\tgetContainer() {\n\t\treturn this.container;\n\t};\n\n\tonResize(func){\n\t\t// Only listen to window for resize event if width and height are not fixed.\n\t\t// This applies if it is set to a percent or auto.\n\t\tif(!isNumber(this.settings.width) ||\n\t\t\t !isNumber(this.settings.height) ) {\n\t\t\twindow.addEventListener(\"resize\", func, false);\n\t\t}\n\n\t};\n\n\tsize(width, height){\n\t\tvar bounds;\n\t\t// var width = _width || this.settings.width;\n\t\t// var height = _height || this.settings.height;\n\n\t\t// If width or height are set to false, inherit them from containing element\n\t\tif(width === null) {\n\t\t\tbounds = this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.width) {\n\t\t\t\twidth = bounds.width;\n\t\t\t\tthis.container.style.width = bounds.width + \"px\";\n\t\t\t}\n\t\t}\n\n\t\tif(height === null) {\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.height) {\n\t\t\t\theight = bounds.height;\n\t\t\t\tthis.container.style.height = bounds.height + \"px\";\n\t\t\t}\n\n\t\t}\n\n\t\tif(!isNumber(width)) {\n\t\t\tbounds = this.container.getBoundingClientRect();\n\t\t\twidth = bounds.width;\n\t\t\t//height = bounds.height;\n\t\t}\n\n\t\tif(!isNumber(height)) {\n\t\t\tbounds = bounds || this.container.getBoundingClientRect();\n\t\t\t//width = bounds.width;\n\t\t\theight = bounds.height;\n\t\t}\n\n\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\n\n\t\tthis.containerPadding = {\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\treturn {\n\t\t\twidth: width -\n\t\t\t\t\t\t\tthis.containerPadding.left -\n\t\t\t\t\t\t\tthis.containerPadding.right,\n\t\t\theight: height -\n\t\t\t\t\t\t\tthis.containerPadding.top -\n\t\t\t\t\t\t\tthis.containerPadding.bottom\n\t\t};\n\n\t};\n\n\tbounds(){\n\n\t\tif(!this.container) {\n\t\t\treturn windowBounds();\n\t\t} else {\n\t\t\treturn this.container.getBoundingClientRect();\n\t\t}\n\n\t}\n\n\tgetSheet(){\n\t\tvar style = document.createElement(\"style\");\n\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\t\tstyle.appendChild(document.createTextNode(\"\"));\n\n\t\tdocument.head.appendChild(style);\n\n\t\treturn style.sheet;\n\t}\n\n\taddStyleRules(selector, rulesArray){\n\t\tvar scope = \"#\" + this.id + \" \";\n\t\tvar rules = \"\";\n\n\t\tif(!this.sheet){\n\t\t\tthis.sheet = this.getSheet();\n\t\t}\n\n\t\trulesArray.forEach(function(set) {\n\t\t\tfor (var prop in set) {\n\t\t\t\tif(set.hasOwnProperty(prop)) {\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n\t}\n}\n\nexport default Stage;\n\n\n\n// WEBPACK FOOTER //\n// ./src/managers/helpers/stage.js","class Views {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t\tthis.hidden = false;\n\t};\n\n\tall() {\n\t\treturn this._views;\n\t};\n\n\tfirst() {\n\t\treturn this._views[0];\n\t};\n\n\tlast() {\n\t\treturn this._views[this._views.length-1];\n\t};\n\n\tindexOf(view) {\n\t\treturn this._views.indexOf(view);\n\t};\n\n\tslice() {\n\t\treturn this._views.slice.apply(this._views, arguments);\n\t};\n\n\tget(i) {\n\t\treturn this._views[i];\n\t};\n\n\tappend(view){\n\t\tthis._views.push(view);\n\t\tif(this.container){\n\t\t\tthis.container.appendChild(view.element);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t};\n\n\tprepend(view){\n\t\tthis._views.unshift(view);\n\t\tif(this.container){\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\n\t\t}\n\t\tthis.length++;\n\t\treturn view;\n\t};\n\n\tinsert(view, index) {\n\t\tthis._views.splice(index, 0, view);\n\n\t\tif(this.container){\n\t\t\tif(index < this.container.children.length){\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\n\t\t\t} else {\n\t\t\t\tthis.container.appendChild(view.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.length++;\n\t\treturn view;\n\t};\n\n\tremove(view) {\n\t\tvar index = this._views.indexOf(view);\n\n\t\tif(index > -1) {\n\t\t\tthis._views.splice(index, 1);\n\t\t}\n\n\n\t\tthis.destroy(view);\n\n\t\tthis.length--;\n\t};\n\n\tdestroy(view) {\n\t\tif(view.displayed){\n\t\t\tview.destroy();\n\t\t}\n\n\t\tif(this.container){\n\t\t\t this.container.removeChild(view.element);\n\t\t}\n\t\tview = null;\n\t};\n\n\t// Iterators\n\n\teach() {\n\t\treturn this._views.forEach.apply(this._views, arguments);\n\t};\n\n\tclear(){\n\t\t// Remove all views\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tif(!this.length) return;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tthis.destroy(view);\n\t\t}\n\n\t\tthis._views = [];\n\t\tthis.length = 0;\n\t};\n\n\tfind(section){\n\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed && view.section.index == section.index) {\n\t\t\t\treturn view;\n\t\t\t}\n\t\t}\n\n\t};\n\n\tdisplayed(){\n\t\tvar displayed = [];\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tdisplayed.push(view);\n\t\t\t}\n\t\t}\n\t\treturn displayed;\n\t};\n\n\tshow(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.show();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = false;\n\t};\n\n\thide(){\n\t\tvar view;\n\t\tvar len = this.length;\n\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tview = this._views[i];\n\t\t\tif(view.displayed){\n\t\t\t\tview.hide();\n\t\t\t}\n\t\t}\n\t\tthis.hidden = true;\n\t};\n}\n\nexport default Views;\n\n\n\n// WEBPACK FOOTER //\n// ./src/managers/helpers/views.js","import {qs, qsa, querySelectorByType} from './utils/core';\n\n/**\n * Navigation Parser\n * @param {document} xml navigation html / xhtml / ncx\n */\nclass Navigation {\n\tconstructor(xml) {\n\t\tthis.toc = [];\n\t\tthis.tocByHref = {};\n\t\tthis.tocById = {};\n\n\t\tif (xml) {\n\t\t\tthis.parse(xml);\n\t\t}\n\t};\n\n\t/**\n\t * Parse out the navigation items\n\t * @param {document} xml navigation html / xhtml / ncx\n\t */\n\tparse(xml) {\n\t\tvar html = qs(xml, \"html\");\n\t\tvar ncx = qs(xml, \"ncx\");\n\n\t\tif(html) {\n\t\t\tthis.toc = this.parseNav(xml);\n\t\t} else if(ncx){\n\t\t\tthis.toc = this.parseNcx(xml);\n\t\t}\n\n\t\tthis.unpack(this.toc);\n\t};\n\n\t/**\n\t * Unpack navigation items\n\t * @private\n\t * @param  {array} toc\n\t */\n\tunpack(toc) {\n\t\tvar item;\n\n\t\tfor (var i = 0; i < toc.length; i++) {\n\t\t\titem = toc[i];\n\t\t\tthis.tocByHref[item.href] = i;\n\t\t\tthis.tocById[item.id] = i;\n\t\t}\n\n\t};\n\n\t/**\n\t * Get an item from the navigation\n\t * @param  {string} target\n\t * @return {object} navItems\n\t */\n\tget(target) {\n\t\tvar index;\n\n\t\tif(!target) {\n\t\t\treturn this.toc;\n\t\t}\n\n\t\tif(target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.tocById[target.substring(1)];\n\t\t} else if(target in this.tocByHref){\n\t\t\tindex = this.tocByHref[target];\n\t\t}\n\n\t\treturn this.toc[index];\n\t};\n\n\t/**\n\t * Parse from a Epub > 3.0 Nav\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"toc\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.navItem(navItems[i]);\n\t\t\ttoc[item.id] = item;\n\t\t\tif(!item.parent) {\n\t\t\t\tlist.push(item);\n\t\t\t} else {\n\t\t\t\tparent = toc[item.parent];\n\t\t\t\tparent.subitems.push(item);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t};\n\n\t/**\n\t * Create a navItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} navItem\n\t */\n\tnavItem(item){\n\t\tvar id = item.getAttribute('id') || false,\n\t\t\t\tcontent = qs(item, \"a\"),\n\t\t\t\tsrc = content.getAttribute('href') || '',\n\t\t\t\ttext = content.textContent || \"\",\n\t\t\t\tsubitems = [],\n\t\t\t\tparentNode = item.parentNode,\n\t\t\t\tparent;\n\n\t\tif(parentNode && parentNode.nodeName === \"navPoint\") {\n\t\t\tparent = parentNode.getAttribute('id');\n\t\t}\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t};\n\n\t/**\n\t * Parse from a Epub > 3.0 NC\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {array} navigation list\n\t */\n\tparseNcx(tocXml){\n\t\tvar navPoints = qsa(tocXml, \"navPoint\");\n\t\tvar length = navPoints.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item, parent;\n\n\t\tif(!navPoints || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.ncxItem(navPoints[i]);\n\t\t\ttoc[item.id] = item;\n\t\t\tif(!item.parent) {\n\t\t\t\tlist.push(item);\n\t\t\t} else {\n\t\t\t\tparent = toc[item.parent];\n\t\t\t\tparent.subitems.push(item);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t};\n\n\t/**\n\t * Create a ncxItem\n\t * @private\n\t * @param  {element} item\n\t * @return {object} ncxItem\n\t */\n\tncxItem(item){\n\t\tvar id = item.getAttribute('id') || false,\n\t\t\t\tcontent = qs(item, \"content\"),\n\t\t\t\tsrc = content.getAttribute('src'),\n\t\t\t\tnavLabel = qs(item, \"navLabel\"),\n\t\t\t\ttext = navLabel.textContent ? navLabel.textContent : \"\",\n\t\t\t\tsubitems = [],\n\t\t\t\tparentNode = item.parentNode,\n\t\t\t\tparent;\n\n\t\tif(parentNode && parentNode.nodeName === \"navPoint\") {\n\t\t\tparent = parentNode.getAttribute('id');\n\t\t}\n\n\n\t\treturn {\n\t\t\t\"id\": id,\n\t\t\t\"href\": src,\n\t\t\t\"label\": text,\n\t\t\t\"subitems\" : subitems,\n\t\t\t\"parent\" : parent\n\t\t};\n\t};\n\n\t/**\n\t * forEach pass through\n\t * @param  {Function} fn function to run on each item\n\t * @return {method} forEach loop\n\t */\n\tforEach(fn) {\n\t\treturn this.toc.forEach(fn);\n\t};\n}\n\nexport default Navigation;\n\n\n\n// WEBPACK FOOTER //\n// ./src/navigation.js","import {qs, qsa, qsp} from './utils/core';\nimport EpubCFI from './epubcfi';\n\n/**\n * Open Packaging Format Parser\n * @class\n * @param {document} packageDocument OPF XML\n */\nclass Packaging {\n\tconstructor(packageDocument) {\n\t\tif (packageDocument) {\n\t\t\tthis.parse(packageDocument);\n\t\t}\n\t};\n\n\t/**\n\t * Parse OPF XML\n\t * @param  {document} packageDocument OPF XML\n\t * @return {object} parsed package parts\n\t */\n\tparse(packageDocument){\n\t\tvar metadataNode, manifestNode, spineNode;\n\n\t\tif(!packageDocument) {\n\t\t\tconsole.error(\"Package File Not Found\");\n\t\t\treturn;\n\t\t}\n\n\t\tmetadataNode = qs(packageDocument, \"metadata\");\n\t\tif(!metadataNode) {\n\t\t\tconsole.error(\"No Metadata Found\");\n\t\t\treturn;\n\t\t}\n\n\t\tmanifestNode = qs(packageDocument, \"manifest\");\n\t\tif(!manifestNode) {\n\t\t\tconsole.error(\"No Manifest Found\");\n\t\t\treturn;\n\t\t}\n\n\t\tspineNode = qs(packageDocument, \"spine\");\n\t\tif(!spineNode) {\n\t\t\tconsole.error(\"No Spine Found\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.manifest = this.parseManifest(manifestNode);\n\t\tthis.navPath = this.findNavPath(manifestNode);\n\t\tthis.ncxPath = this.findNcxPath(manifestNode, spineNode);\n\t\tthis.coverPath = this.findCoverPath(packageDocument);\n\n\t\tthis.spineNodeIndex = Array.prototype.indexOf.call(spineNode.parentNode.childNodes, spineNode);\n\n\t\tthis.spine = this.parseSpine(spineNode, this.manifest);\n\n\t\tthis.metadata = this.parseMetadata(metadataNode);\n\n\t\tthis.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\n\n\n\t\treturn {\n\t\t\t'metadata' : this.metadata,\n\t\t\t'spine'    : this.spine,\n\t\t\t'manifest' : this.manifest,\n\t\t\t'navPath'  : this.navPath,\n\t\t\t'ncxPath'  : this.ncxPath,\n\t\t\t'coverPath': this.coverPath,\n\t\t\t'spineNodeIndex' : this.spineNodeIndex\n\t\t};\n\t};\n\n\t/**\n\t * Parse Metadata\n\t * @private\n\t * @param  {document} xml\n\t * @return {object} metadata\n\t */\n\tparseMetadata(xml){\n\t\tvar metadata = {};\n\n\t\tmetadata.title = this.getElementText(xml, 'title');\n\t\tmetadata.creator = this.getElementText(xml, 'creator');\n\t\tmetadata.description = this.getElementText(xml, 'description');\n\n\t\tmetadata.pubdate = this.getElementText(xml, 'date');\n\n\t\tmetadata.publisher = this.getElementText(xml, 'publisher');\n\n\t\tmetadata.identifier = this.getElementText(xml, \"identifier\");\n\t\tmetadata.language = this.getElementText(xml, \"language\");\n\t\tmetadata.rights = this.getElementText(xml, \"rights\");\n\n\t\tmetadata.modified_date = this.getPropertyText(xml, 'dcterms:modified');\n\n\t\tmetadata.layout = this.getPropertyText(xml, \"rendition:layout\");\n\t\tmetadata.orientation = this.getPropertyText(xml, 'rendition:orientation');\n\t\tmetadata.flow = this.getPropertyText(xml, 'rendition:flow');\n\t\tmetadata.viewport = this.getPropertyText(xml, 'rendition:viewport');\n\t\t// metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\n\n\t\treturn metadata;\n\t};\n\n\t/**\n\t * Parse Manifest\n\t * @private\n\t * @param  {document} manifestXml\n\t * @return {object} manifest\n\t */\n\tparseManifest(manifestXml){\n\t\tvar manifest = {};\n\n\t\t//-- Turn items into an array\n\t\t// var selected = manifestXml.querySelectorAll(\"item\");\n\t\tvar selected = qsa(manifestXml, \"item\");\n\t\tvar items = Array.prototype.slice.call(selected);\n\n\t\t//-- Create an object with the id as key\n\t\titems.forEach(function(item){\n\t\t\tvar id = item.getAttribute('id'),\n\t\t\t\t\thref = item.getAttribute('href') || '',\n\t\t\t\t\ttype = item.getAttribute('media-type') || '',\n\t\t\t\t\tproperties = item.getAttribute('properties') || '';\n\n\t\t\tmanifest[id] = {\n\t\t\t\t'href' : href,\n\t\t\t\t// 'url' : href,\n\t\t\t\t'type' : type,\n\t\t\t\t'properties' : properties.length ? properties.split(' ') : []\n\t\t\t};\n\n\t\t});\n\n\t\treturn manifest;\n\n\t};\n\n\t/**\n\t * Parse Spine\n\t * @param  {document} spineXml\n\t * @param  {Packaging.manifest} manifest\n\t * @return {object} spine\n\t */\n\tparseSpine(spineXml, manifest){\n\t\tvar spine = [];\n\n\t\tvar selected = spineXml.getElementsByTagName(\"itemref\"),\n\t\t\t\titems = Array.prototype.slice.call(selected);\n\n\t\tvar epubcfi = new EpubCFI();\n\n\t\t//-- Add to array to mantain ordering and cross reference with manifest\n\t\titems.forEach(function(item, index){\n\t\t\tvar idref = item.getAttribute('idref');\n\t\t\t// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\n\t\t\tvar props = item.getAttribute('properties') || '';\n\t\t\tvar propArray = props.length ? props.split(' ') : [];\n\t\t\t// var manifestProps = manifest[Id].properties;\n\t\t\t// var manifestPropArray = manifestProps.length ? manifestProps.split(' ') : [];\n\n\t\t\tvar itemref = {\n\t\t\t\t'idref' : idref,\n\t\t\t\t'linear' : item.getAttribute('linear') || '',\n\t\t\t\t'properties' : propArray,\n\t\t\t\t// 'href' : manifest[Id].href,\n\t\t\t\t// 'url' :  manifest[Id].url,\n\t\t\t\t'index' : index\n\t\t\t\t// 'cfiBase' : cfiBase\n\t\t\t};\n\t\t\tspine.push(itemref);\n\t\t});\n\n\t\treturn spine;\n\t};\n\n\t/**\n\t * Find TOC NAV\n\t * @private\n\t */\n\tfindNavPath(manifestNode){\n\t\t// Find item with property 'nav'\n\t\t// Should catch nav irregardless of order\n\t\t// var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"properties\":\"nav\"});\n\t\treturn node ? node.getAttribute('href') : false;\n\t};\n\n\t/**\n\t * Find TOC NCX\n\t * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\n\t * @private\n\t */\n\tfindNcxPath(manifestNode, spineNode){\n\t\t// var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\n\t\tvar node = qsp(manifestNode, \"item\", {\"media-type\":\"application/x-dtbncx+xml\"});\n\t\tvar tocId;\n\n\t\t// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\n\t\t// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\n\t\t// \"The item that describes the NCX must be referenced by the spine toc attribute.\"\n\t\tif (!node) {\n\t\t\ttocId = spineNode.getAttribute(\"toc\");\n\t\t\tif(tocId) {\n\t\t\t\t// node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\n\t\t\t\tnode = manifestNode.getElementById(tocId);\n\t\t\t}\n\t\t}\n\n\t\treturn node ? node.getAttribute('href') : false;\n\t};\n\n\t/**\n\t * Find the Cover Path\n\t * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\n\t * Fallback for Epub 2.0\n\t * @param  {document} packageXml\n\t * @return {string} href\n\t */\n\tfindCoverPath(packageXml){\n\t\tvar pkg = qs(packageXml, \"package\");\n\t\tvar epubVersion = pkg.getAttribute('version');\n\n\t\tif (epubVersion === '2.0') {\n\t\t\tvar metaCover = qsp(packageXml, 'meta', {'name':'cover'});\n\t\t\tif (metaCover) {\n\t\t\t\tvar coverId = metaCover.getAttribute('content');\n\t\t\t\t// var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\n\t\t\t\tvar cover = packageXml.getElementById(coverId);\n\t\t\t\treturn cover ? cover.getAttribute('href') : '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// var node = packageXml.querySelector(\"item[properties='cover-image']\");\n\t\t\tvar node = qsp(packageXml, 'item', {'properties':'cover-image'});\n\t\t\treturn node ? node.getAttribute('href') : '';\n\t\t}\n\t};\n\n\t/**\n\t * Get text of a namespaced element\n\t * @private\n\t * @param  {document} xml\n\t * @param  {string} tag\n\t * @return {string} text\n\t */\n\tgetElementText(xml, tag){\n\t\tvar found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag),\n\t\t\tel;\n\n\t\tif(!found || found.length === 0) return '';\n\n\t\tel = found[0];\n\n\t\tif(el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn '';\n\n\t};\n\n\t/**\n\t * Get text by property\n\t * @private\n\t * @param  {document} xml\n\t * @param  {string} property\n\t * @return {string} text\n\t */\n\tgetPropertyText(xml, property){\n\t\tvar el = qsp(xml, \"meta\", {\"property\":property});\n\n\t\tif(el && el.childNodes.length){\n\t\t\treturn el.childNodes[0].nodeValue;\n\t\t}\n\n\t\treturn '';\n\t};\n}\n\nexport default Packaging;\n\n\n\n// WEBPACK FOOTER //\n// ./src/packaging.js","import EpubCFI from './epubcfi';\nimport {\n\tqs,\n\tqsa,\n\tquerySelectorByType,\n\tindexOfSorted,\n\tlocationOf\n} from './utils/core';\n\n/**\n * Page List Parser\n * @param {[document]} xml\n */\nclass PageList {\n\tconstructor(xml) {\n\t\tthis.pages = [];\n\t\tthis.locations = [];\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tif (xml) {\n\t\t\tthis.pageList = this.parse(xml);\n\t\t}\n\n\t\tif(this.pageList && this.pageList.length) {\n\t\t\tthis.process(this.pageList);\n\t\t}\n\t};\n\n\t/**\n\t * Parse PageList Xml\n\t * @param  {document} xml\n\t */\n\tparse(xml) {\n\t\tvar html = qs(xml, \"html\");\n\t\t// var ncx = qs(xml, \"ncx\");\n\n\t\tif(html) {\n\t\t\tthis.toc = this.parseNav(xml);\n\t\t} else if(ncx){ // Not supported\n\t\t\t// this.toc = this.parseNcx(xml);\n\t\t\treturn;\n\t\t}\n\n\t};\n\n\t/**\n\t * Parse a Nav PageList\n\t * @private\n\t * @param  {document} navHtml\n\t * @return {PageList.item[]} list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"page-list\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar toc = {};\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.item(navItems[i]);\n\t\t\tlist.push(item);\n\t\t}\n\n\t\treturn list;\n\t};\n\n\t/**\n\t * Page List Item\n\t * @private\n\t * @param  {object} item\n\t * @return {object} pageListItem\n\t */\n\titem(item){\n\t\tvar id = item.getAttribute('id') || false,\n\t\t\tcontent = qs(item, \"a\"),\n\t\t\thref = content.getAttribute('href') || '',\n\t\t\ttext = content.textContent || \"\",\n\t\t\tpage = parseInt(text),\n\t\t\tisCfi = href.indexOf(\"epubcfi\"),\n\t\t\tsplit,\n\t\t\tpackageUrl,\n\t\t\tcfi;\n\n\t\tif(isCfi != -1) {\n\t\t\tsplit = href.split(\"#\");\n\t\t\tpackageUrl = split[0];\n\t\t\tcfi = split.length > 1 ? split[1] : false;\n\t\t\treturn {\n\t\t\t\t\"cfi\" : cfi,\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"packageUrl\" : packageUrl,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Process pageList items\n\t * @private\n\t * @param  {array} pageList\n\t */\n\tprocess(pageList){\n\t\tpageList.forEach(function(item){\n\t\t\tthis.pages.push(item.page);\n\t\t\tif (item.cfi) {\n\t\t\t\tthis.locations.push(item.cfi);\n\t\t\t}\n\t\t}, this);\n\t\tthis.firstPage = parseInt(this.pages[0]);\n\t\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\n\t\tthis.totalPages = this.lastPage - this.firstPage;\n\t};\n\n\n\t/**\n\t * Replace HREFs with CFI\n\t * TODO: implement getting CFI from Href\n\t */\n\taddCFIs() {\n\t\tthis.pageList.forEach(function(pg){\n\t\t\tif(!pg.cfi) {\n\t\t\t\t// epubcfi.generateCfiFromHref(pg.href, book).then(function(cfi){\n\t\t\t\t// \tpg.cfi = cfi;\n\t\t\t\t// \tpg.packageUrl = book.settings.packageUrl;\n\t\t\t\t// });\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n\tEPUBJS.generateCfiFromHref(href, book) {\n\t  var uri = EPUBJS.core.uri(href);\n\t  var path = uri.path;\n\t  var fragment = uri.fragment;\n\t  var spinePos = book.spineIndexByURL[path];\n\t  var loaded;\n\t  var deferred = new RSVP.defer();\n\t  var epubcfi = new EPUBJS.EpubCFI();\n\t  var spineItem;\n\n\t  if(typeof spinePos !== \"undefined\"){\n\t    spineItem = book.spine[spinePos];\n\t    loaded = book.loadXml(spineItem.url);\n\t    loaded.then(function(doc){\n\t      var element = doc.getElementById(fragment);\n\t      var cfi;\n\t      cfi = epubcfi.generateCfiFromElement(element, spineItem.cfiBase);\n\t      deferred.resolve(cfi);\n\t    });\n\t  }\n\n\t  return deferred.promise;\n\t};\n\t*/\n\n\t/**\n\t * Get a PageList result from a EpubCFI\n\t * @param  {string} cfi EpubCFI String\n\t * @return {string} page\n\t */\n\tpageFromCfi(cfi){\n\t\tvar pg = -1;\n\n\t\t// Check if the pageList has not been set yet\n\t\tif(this.locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// TODO: check if CFI is valid?\n\n\t\t// check if the cfi is in the location list\n\t\t// var index = this.locations.indexOf(cfi);\n\t\tvar index = indexOfSorted(cfi, this.locations, this.epubcfi.compare);\n\t\tif(index != -1) {\n\t\t\tpg = this.pages[index];\n\t\t} else {\n\t\t\t// Otherwise add it to the list of locations\n\t\t\t// Insert it in the correct position in the locations page\n\t\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\n\t\t\tindex = locationOf(cfi, this.locations, this.epubcfi.compare);\n\t\t\t// Get the page at the location just before the new one, or return the first\n\t\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\n\t\t\tif(pg !== undefined) {\n\t\t\t\t// Add the new page in so that the locations and page array match up\n\t\t\t\t//this.pages.splice(index, 0, pg);\n\t\t\t} else {\n\t\t\t\tpg = -1;\n\t\t\t}\n\n\t\t}\n\t\treturn pg;\n\t};\n\n\t/**\n\t * Get an EpubCFI from a Page List Item\n\t * @param  {string} pg\n\t * @return {string} cfi\n\t */\n\tcfiFromPage(pg){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof pg != \"number\"){\n\t\t\tpg = parseInt(pg);\n\t\t}\n\n\t\t// check if the cfi is in the page list\n\t\t// Pages could be unsorted.\n\t\tvar index = this.pages.indexOf(pg);\n\t\tif(index != -1) {\n\t\t\tcfi = this.locations[index];\n\t\t}\n\t\t// TODO: handle pages not in the list\n\t\treturn cfi;\n\t};\n\n\t/**\n\t * Get a Page from Book percentage\n\t * @param  {number} percent\n\t * @return {string} page\n\t */\n\tpageFromPercentage(percent){\n\t\tvar pg = Math.round(this.totalPages * percent);\n\t\treturn pg;\n\t};\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a page\n\t * @param  {int} pg the page\n\t * @return {number} percentage\n\t */\n\tpercentageFromPage(pg){\n\t\tvar percentage = (pg - this.firstPage) / this.totalPages;\n\t\treturn Math.round(percentage * 1000) / 1000;\n\t};\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a cfi\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} percentage\n\t */\n\tpercentageFromCfi(cfi){\n\t\tvar pg = this.pageFromCfi(cfi);\n\t\tvar percentage = this.percentageFromPage(pg);\n\t\treturn percentage;\n\t};\n}\n\nexport default PageList;\n\n\n\n// WEBPACK FOOTER //\n// ./src/pagelist.js","import {substitute} from './replacements';\nimport {createBase64Url, createBlobUrl} from './utils/core';\nimport Path from './utils/path';\nimport path from 'path-webpack';\n\n/**\n * Handle Package Resources\n * @class\n * @param {Manifest} manifest\n * @param {[object]} options\n * @param {[string='base64']} options.replacements\n * @param {[Archive]} options.archive\n * @param {[method]} options.resolver\n */\nclass Resources {\n\tconstructor(manifest, options) {\n\t\tthis.settings = {\n\t\t\treplacements: (options && options.replacements) || 'base64',\n\t\t\tarchive: (options && options.archive),\n\t\t\tresolver: (options && options.resolver)\n\t\t};\n\t\tthis.manifest = manifest;\n\t\tthis.resources = Object.keys(manifest).\n\t\t\tmap(function (key){\n\t\t\t\treturn manifest[key];\n\t\t\t});\n\n\t\tthis.replacementUrls = [];\n\n\t\tthis.split();\n\t\tthis.splitUrls();\n\t}\n\n\t/**\n\t * Split resources by type\n\t * @private\n\t */\n\tsplit(){\n\n\t\t// HTML\n\t\tthis.html = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"application/xhtml+xml\" ||\n\t\t\t\t\t\titem.type === \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Exclude HTML\n\t\tthis.assets = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type !== \"application/xhtml+xml\" &&\n\t\t\t\t\t\titem.type !== \"text/html\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Only CSS\n\t\tthis.css = this.resources.\n\t\t\tfilter(function (item){\n\t\t\t\tif (item.type === \"text/css\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\t/**\n\t * Convert split resources into Urls\n\t * @private\n\t */\n\tsplitUrls(){\n\n\t\t// All Assets Urls\n\t\tthis.urls = this.assets.\n\t\t\tmap(function(item) {\n\t\t\t\treturn item.href;\n\t\t\t}.bind(this));\n\n\t\t// Css Urls\n\t\tthis.cssUrls = this.css.map(function(item) {\n\t\t\treturn item.href;\n\t\t});\n\n\t};\n\n\t/**\n\t * Create blob urls for all the assets\n\t * @param  {Archive} archive\n\t * @param  {resolver} resolver Url resolver\n\t * @return {Promise}         returns replacement urls\n\t */\n\treplacements(archive, resolver){\n\t\tarchive = archive || this.settings.archive;\n\t\tresolver = resolver || this.settings.resolver;\n\n\t\tif (this.settings.replacements === \"none\") {\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tresolve(this.urls);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tvar replacements = this.urls.\n\t\t\tmap(function(url) {\n\t\t\t\tvar absolute = resolver(url);\n\n\t\t\t\treturn archive.createUrl(absolute, {\"base64\": (this.settings.replacements === \"base64\")});\n\t\t\t}.bind(this))\n\n\t\treturn Promise.all(replacements)\n\t\t\t.then(function(replacementUrls) {\n\t\t\t\tthis.replacementUrls = replacementUrls;\n\t\t\t\treturn replacementUrls;\n\t\t\t}.bind(this));\n\t};\n\n\t/**\n\t * Replace URLs in CSS resources\n\t * @private\n\t * @param  {[Archive]} archive\n\t * @param  {[method]} resolver\n\t * @return {Promise}\n\t */\n\treplaceCss(archive, resolver){\n\t\tvar replaced = [];\n\t\tarchive = archive || this.settings.archive;\n\t\tresolver = resolver || this.settings.resolver;\n\t\tthis.cssUrls.forEach(function(href) {\n\t\t\tvar replacement = this.createCssFile(href, archive, resolver)\n\t\t\t\t.then(function (replacementUrl) {\n\t\t\t\t\t// switch the url in the replacementUrls\n\t\t\t\t\tvar indexInUrls = this.urls.indexOf(href);\n\t\t\t\t\tif (indexInUrls > -1) {\n\t\t\t\t\t\tthis.replacementUrls[indexInUrls] = replacementUrl;\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\n\t\t\treplaced.push(replacement);\n\t\t}.bind(this));\n\t\treturn Promise.all(replaced);\n\t};\n\n\t/**\n\t * Create a new CSS file with the replaced URLs\n\t * @private\n\t * @param  {string} href the original css file\n\t * @param  {[Archive]} archive\n\t * @param  {[method]} resolver\n\t * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\n\t */\n\tcreateCssFile(href, archive, resolver){\n\t\t\tvar newUrl;\n\t\t\tvar indexInUrls;\n\t\t\tarchive = archive || this.settings.archive;\n\t\t\tresolver = resolver || this.settings.resolver;\n\n\t\t\tif (path.isAbsolute(href)) {\n\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\tresolve(urls, replacementUrls);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar absolute = resolver(href);\n\n\t\t\t// Get the text of the css file from the archive\n\t\t\tvar textResponse = archive.getText(absolute);\n\t\t\t// Get asset links relative to css file\n\t\t\tvar relUrls = this.urls.map(function(assetHref) {\n\t\t\t\t\tvar resolved = resolver(assetHref);\n\t\t\t\t\tvar relative = new Path(absolute).relative(resolved);\n\n\t\t\t\t\treturn relative;\n\t\t\t\t}.bind(this));\n\n\t\t\treturn textResponse.then(function (text) {\n\t\t\t\t// Replacements in the css text\n\t\t\t\ttext = substitute(text, relUrls, this.replacementUrls);\n\n\t\t\t\t// Get the new url\n\t\t\t\tif (this.settings.replacements === \"base64\") {\n\t\t\t\t\tnewUrl = createBase64Url(text, 'text/css');\n\t\t\t\t} else {\n\t\t\t\t\tnewUrl = createBlobUrl(text, 'text/css');\n\t\t\t\t}\n\n\t\t\t\treturn newUrl;\n\t\t\t}.bind(this));\n\n\t};\n\n\t/**\n\t * Resolve all resources URLs relative to an absolute URL\n\t * @param  {string} absolute to be resolved to\n\t * @param  {[resolver]} resolver\n\t * @return {string[]} array with relative Urls\n\t */\n\trelativeTo(absolute, resolver){\n\t\tresolver = resolver || this.settings.resolver;\n\n\t\t// Get Urls relative to current sections\n\t\treturn this.urls.\n\t\t\tmap(function(href) {\n\t\t\t\tvar resolved = resolver(href);\n\t\t\t\tvar relative = new Path(absolute).relative(resolved);\n\t\t\t\treturn relative;\n\t\t\t}.bind(this));\n\t};\n\n\t/**\n\t * Get a URL for a resource\n\t * @param  {string} path\n\t * @return {string} url\n\t */\n\tget(path) {\n\t\tvar indexInUrls = this.urls.indexOf(path);\n\t\tif (indexInUrls === -1) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.replacementUrls.length) {\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tresolve(this.replacementUrls[indexInUrls]);\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\treturn archive.createUrl(absolute,\n\t\t\t\t{\"base64\": (this.settings.replacements === \"base64\")})\n\t\t}\n\t}\n\n\t/**\n\t * Substitute urls in content, with replacements,\n\t * relative to a url if provided\n\t * @param  {string} content\n\t * @param  {[string]} url   url to resolve to\n\t * @return {string}         content with urls substituted\n\t */\n\tsubstitute(content, url) {\n\t\tvar relUrls;\n\t\tif (url) {\n\t\t\trelUrls = this.relativeTo(url);\n\t\t} else {\n\t\t\trelUrls = this.urls;\n\t\t}\n\t\treturn substitute(content, relUrls, this.replacementUrls);\n\t};\n}\n\nexport default Resources;\n\n\n\n// WEBPACK FOOTER //\n// ./src/resources.js","import { defer } from './utils/core';\nimport EpubCFI from './epubcfi';\nimport Hook from './hook';\nimport Url from './utils/url';\n\n/**\n * Represents a Section of the Book\n * In most books this is equivelent to a Chapter\n * @param {object} item  The spine item representing the section\n * @param {object} hooks hooks for serialize and content\n */\nclass Section {\n\tconstructor(item, hooks){\n\t\t\tthis.idref = item.idref;\n\t\t\tthis.linear = item.linear;\n\t\t\tthis.properties = item.properties;\n\t\t\tthis.index = item.index;\n\t\t\tthis.href = item.href;\n\t\t\tthis.url = item.url;\n\t\t\tthis.next = item.next;\n\t\t\tthis.prev = item.prev;\n\n\t\t\tthis.cfiBase = item.cfiBase;\n\n\t\t\tif (hooks) {\n\t\t\t\tthis.hooks = hooks;\n\t\t\t} else {\n\t\t\t\tthis.hooks = {};\n\t\t\t\tthis.hooks.serialize = new Hook(this);\n\t\t\t\tthis.hooks.content = new Hook(this);\n\t\t\t}\n\n\t};\n\n\t/**\n\t * Load the section from its url\n\t * @param  {method} _request a request method to use for loading\n\t * @return {document} a promise with the xml document\n\t */\n\tload(_request){\n\t\tvar request = _request || this.request || require('./request');\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(this.contents) {\n\t\t\tloading.resolve(this.contents);\n\t\t} else {\n\t\t\trequest(this.url)\n\t\t\t\t.then(function(xml){\n\t\t\t\t\tvar base;\n\t\t\t\t\tvar directory = new Url(this.url).directory;\n\n\t\t\t\t\tthis.document = xml;\n\t\t\t\t\tthis.contents = xml.documentElement;\n\n\t\t\t\t\treturn this.hooks.content.trigger(this.document, this);\n\t\t\t\t}.bind(this))\n\t\t\t\t.then(function(){\n\t\t\t\t\tloading.resolve(this.contents);\n\t\t\t\t}.bind(this))\n\t\t\t\t.catch(function(error){\n\t\t\t\t\tloading.reject(error);\n\t\t\t\t});\n\t\t}\n\n\t\treturn loaded;\n\t};\n\n\t/**\n\t * Adds a base tag for resolving urls in the section\n\t * @private\n\t * @param  {document} _document\n\t */\n\tbase(_document){\n\t\t\tvar task = new defer();\n\t\t\tvar base = _document.createElement(\"base\"); // TODO: check if exists\n\t\t\tvar head;\n\n\t\t\tbase.setAttribute(\"href\", window.location.origin + \"/\" +this.url);\n\n\t\t\tif(_document) {\n\t\t\t\thead = _document.querySelector(\"head\");\n\t\t\t}\n\t\t\tif(head) {\n\t\t\t\thead.insertBefore(base, head.firstChild);\n\t\t\t\ttask.resolve();\n\t\t\t} else {\n\t\t\t\ttask.reject(new Error(\"No head to insert into\"));\n\t\t\t}\n\n\n\t\t\treturn task.promise;\n\t};\n\n\t/**\n\t * Render the contents of a section\n\t * @param  {method} _request a request method to use for loading\n\t * @return {string} output a serialized XML Document\n\t */\n\trender(_request){\n\t\tvar rendering = new defer();\n\t\tvar rendered = rendering.promise;\n\t\tthis.output; // TODO: better way to return this from hooks?\n\n\t\tthis.load(_request).\n\t\t\tthen(function(contents){\n\t\t\t\tvar serializer;\n\n\t\t\t\tif (typeof XMLSerializer === \"undefined\") {\n\t\t\t\t\tXMLSerializer = require('xmldom').XMLSerializer;\n\t\t\t\t}\n\t\t\t\tserializer = new XMLSerializer();\n\t\t\t\tthis.output = serializer.serializeToString(contents);\n\t\t\t\treturn this.output;\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\treturn this.hooks.serialize.trigger(this.output, this);\n\t\t\t}.bind(this)).\n\t\t\tthen(function(){\n\t\t\t\trendering.resolve(this.output);\n\t\t\t}.bind(this))\n\t\t\t.catch(function(error){\n\t\t\t\trendering.reject(error);\n\t\t\t});\n\n\t\treturn rendered;\n\t};\n\n\t/**\n\t * Find a string in a section\n\t * TODO: need reimplementation from v0.2\n\t * @param  {string} query [description]\n\t * @return {[type]} [description]\n\t */\n\tfind(query){\n\n\t};\n\n\t/**\n\t* Reconciles the current chapters layout properies with\n\t* the global layout properities.\n\t* @param {object} global  The globa layout settings object, chapter properties string\n\t* @return {object} layoutProperties Object with layout properties\n\t*/\n\treconcileLayoutSettings(global){\n\t\t//-- Get the global defaults\n\t\tvar settings = {\n\t\t\tlayout : global.layout,\n\t\t\tspread : global.spread,\n\t\t\torientation : global.orientation\n\t\t};\n\n\t\t//-- Get the chapter's display type\n\t\tthis.properties.forEach(function(prop){\n\t\t\tvar rendition = prop.replace(\"rendition:\", '');\n\t\t\tvar split = rendition.indexOf(\"-\");\n\t\t\tvar property, value;\n\n\t\t\tif(split != -1){\n\t\t\t\tproperty = rendition.slice(0, split);\n\t\t\t\tvalue = rendition.slice(split+1);\n\n\t\t\t\tsettings[property] = value;\n\t\t\t}\n\t\t});\n\t return settings;\n\t};\n\n\t/**\n\t * Get a CFI from a Range in the Section\n\t * @param  {range} _range\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromRange(_range) {\n\t\treturn new EpubCFI(_range, this.cfiBase).toString();\n\t};\n\n\t/**\n\t * Get a CFI from an Element in the Section\n\t * @param  {element} el\n\t * @return {string} cfi an EpubCFI string\n\t */\n\tcfiFromElement(el) {\n\t\treturn new EpubCFI(el, this.cfiBase).toString();\n\t};\n}\n\nexport default Section;\n\n\n\n// WEBPACK FOOTER //\n// ./src/section.js","import core from './utils/core';\nimport EpubCFI from './epubcfi';\nimport Hook from './hook';\nimport Section from './section';\nimport {replaceBase, replaceCanonical} from './replacements';\n\n/**\n * A collection of Spine Items\n */\nclass Spine {\n\tconstructor() {\n\t\tthis.spineItems = [];\n\t\tthis.spineByHref = {};\n\t\tthis.spineById = {};\n\n\t\tthis.hooks = {};\n\t\tthis.hooks.serialize = new Hook();\n\t\tthis.hooks.content = new Hook();\n\n\t\t// Register replacements\n\t\tthis.hooks.content.register(replaceBase);\n\t\tthis.hooks.content.register(replaceCanonical);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.loaded = false;\n\t};\n\n\t/**\n\t * Unpack items from a opf into spine items\n\t * @param  {Package} _package\n\t * @param  {method} resolver URL resolver\n\t */\n\tunpack(_package, resolver) {\n\n\t\tthis.items = _package.spine;\n\t\tthis.manifest = _package.manifest;\n\t\tthis.spineNodeIndex = _package.spineNodeIndex;\n\t\tthis.baseUrl = _package.baseUrl || _package.basePath || '';\n\t\tthis.length = this.items.length;\n\n\t\tthis.items.forEach(function(item, index){\n\t\t\tvar href, url;\n\t\t\tvar manifestItem = this.manifest[item.idref];\n\t\t\tvar spineItem;\n\n\t\t\titem.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\n\n\t\t\tif(manifestItem) {\n\t\t\t\titem.href = manifestItem.href;\n\t\t\t\titem.url = resolver(item.href, true);\n\n\t\t\t\tif(manifestItem.properties.length){\n\t\t\t\t\titem.properties.push.apply(item.properties, manifestItem.properties);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titem.prev = function(){ return this.get(index-1); }.bind(this);\n\t\t\titem.next = function(){ return this.get(index+1); }.bind(this);\n\n\t\t\tspineItem = new Section(item, this.hooks);\n\n\t\t\tthis.append(spineItem);\n\n\n\t\t}.bind(this));\n\n\t\tthis.loaded = true;\n\t};\n\n\t/**\n\t * Get an item from the spine\n\t * @param  {[string|int]} target\n\t * @return {Section} section\n\t * @example spine.get();\n\t * @example spine.get(1);\n\t * @example spine.get(\"chap1.html\");\n\t * @example spine.get(\"#id1234\");\n\t */\n\tget(target) {\n\t\tvar index = 0;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\tcfi = new EpubCFI(target);\n\t\t\tindex = cfi.spinePos;\n\t\t} else if(target && (typeof target === \"number\" || isNaN(target) === false)){\n\t\t\tindex = target;\n\t\t} else if(target && target.indexOf(\"#\") === 0) {\n\t\t\tindex = this.spineById[target.substring(1)];\n\t\t} else if(target) {\n\t\t\t// Remove fragments\n\t\t\ttarget = target.split(\"#\")[0];\n\t\t\tindex = this.spineByHref[target];\n\t\t}\n\n\t\treturn this.spineItems[index] || null;\n\t};\n\n\t/**\n\t * Append a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tappend(section) {\n\t\tvar index = this.spineItems.length;\n\t\tsection.index = index;\n\n\t\tthis.spineItems.push(section);\n\n\t\tthis.spineByHref[section.href] = index;\n\t\tthis.spineById[section.idref] = index;\n\n\t\treturn index;\n\t};\n\n\t/**\n\t * Prepend a Section to the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tprepend(section) {\n\t\tvar index = this.spineItems.unshift(section);\n\t\tthis.spineByHref[section.href] = 0;\n\t\tthis.spineById[section.idref] = 0;\n\n\t\t// Re-index\n\t\tthis.spineItems.forEach(function(item, index){\n\t\t\titem.index = index;\n\t\t});\n\n\t\treturn 0;\n\t};\n\n\t// insert(section, index) {\n\t//\n\t// };\n\n\t/**\n\t * Remove a Section from the Spine\n\t * @private\n\t * @param  {Section} section\n\t */\n\tremove(section) {\n\t\tvar index = this.spineItems.indexOf(section);\n\n\t\tif(index > -1) {\n\t\t\tdelete this.spineByHref[section.href];\n\t\t\tdelete this.spineById[section.idref];\n\n\t\t\treturn this.spineItems.splice(index, 1);\n\t\t}\n\t};\n\n\t/**\n\t * Loop over the Sections in the Spine\n\t * @return {method} forEach\n\t */\n\teach() {\n\t\treturn this.spineItems.forEach.apply(this.spineItems, arguments);\n\t};\n}\n\nexport default Spine;\n\n\n\n// WEBPACK FOOTER //\n// ./src/spine.js","import Url from './utils/url';\n\nclass Themes {\n\tconstructor(rendition) {\n\t\tthis.rendition = rendition;\n\t\tthis._themes = {\n\t\t\t\"default\" : {\n\t\t\t\t\"rules\" : [],\n\t\t\t\t\"url\" : \"\",\n\t\t\t\t\"serialized\" : ''\n\t\t\t}\n\t\t};\n\t\tthis._overrides = {};\n\t\tthis._current = \"default\";\n\t\tthis._injected = [];\n\t\tthis.rendition.hooks.content.register(this.inject.bind(this));\n\t\tthis.rendition.hooks.content.register(this.overrides.bind(this));\n\n\t}\n\n\tregister () {\n\t\tif (arguments.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"object\") {\n\t\t\treturn this.registerThemes(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 1 && typeof(arguments[0]) === \"string\") {\n\t\t\treturn this.default(arguments[0]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"string\") {\n\t\t\treturn this.registerUrl(arguments[0], arguments[1]);\n\t\t}\n\t\tif (arguments.length === 2 && typeof(arguments[1]) === \"object\") {\n\t\t\treturn this.registerRules(arguments[0], arguments[1]);\n\t\t}\n\t};\n\n\tdefault (theme) {\n\t\tif (!theme) {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof(theme) === \"string\") {\n\t\t\treturn this.registerUrl(\"default\", theme);\n\t\t}\n\t\tif (typeof(theme) === \"object\") {\n\t\t\treturn this.registerRules(\"default\", theme);\n\t\t}\n\t};\n\n\tregisterThemes (themes) {\n\t\tfor (var theme in themes) {\n\t\t\tif (themes.hasOwnProperty(theme)) {\n\t\t\t\tif (typeof(themes[theme]) === \"string\") {\n\t\t\t\t\tthis.registerUrl(theme, themes[theme]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.registerRules(theme, themes[theme]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tregisterUrl (name, input) {\n\t\tvar url = new Url(input);\n\t\tthis._themes[name] = { \"url\": url.toString() };\n\t};\n\n\tregisterRules (name, rules) {\n\t\tthis._themes[name] = { \"rules\": rules };\n\t\t// TODO: serialize css rules\n\t};\n\n\tapply (name) {\n\t\tvar prev = this._current;\n\t\tvar contents;\n\n\t\tthis._current = name;\n\t\tthis.update(name);\n\n\t\tcontents = this.rendition.getContents();\n\t\tcontents.forEach(function (content) {\n\t\t\tcontent.removeClass(prev);\n\t\t\tcontent.addClass(name);\n\t\t}.bind(this));\n\t};\n\n\tupdate (name) {\n\t\tvar contents = this.rendition.getContents();\n\t\tcontents.forEach(function (content) {\n\t\t\tthis.add(name, content);\n\t\t}.bind(this));\n\t};\n\n\tinject (view) {\n\t\tvar links = [];\n\t\tvar themes = this._themes;\n\t\tvar theme;\n\n\t\tfor (var name in themes) {\n\t\t\tif (themes.hasOwnProperty(name)) {\n\t\t\t\ttheme = themes[name];\n\t\t\t\tif(theme.rules || (theme.url && links.indexOf(theme.url) === -1)) {\n\t\t\t\t\tthis.add(name, view.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(this._current) {\n\t\t\tview.contents.addClass(this._current);\n\t\t}\n\t};\n\n\tadd (name, contents) {\n\t\tvar theme = this._themes[name];\n\n\t\tif (!theme) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (theme.url) {\n\t\t\tcontents.addStylesheet(theme.url);\n\t\t} else if (theme.serialized) {\n\t\t\t// TODO: handle serialized\n\t\t} else if (theme.rules && theme.rules.length) {\n\t\t\tcontents.addStylesheetRules(theme.rules);\n\t\t\ttheme.injected = true;\n\t\t}\n\t};\n\n\toverride (name, value) {\n\t\tvar contents = this.rendition.getContents();\n\n\t\tthis._overrides[name] = value;\n\n\t\tcontents.forEach(function (content) {\n\t\t\tcontent.css(name, this._overrides[name]);\n\t\t}.bind(this));\n\t};\n\n\toverrides (view) {\n\t\tvar contents = view.contents;\n\t\tvar overrides = this._overrides;\n\t\tvar rules = [];\n\n\t\tfor (var rule in overrides) {\n\t\t\tif (overrides.hasOwnProperty(rule)) {\n\t\t\t\tcontents.css(rule, overrides[rule]);\n\t\t\t}\n\t\t}\n\t};\n\n\tfontSize (size) {\n\t\tthis.override(\"font-size\", size);\n\t};\n\n}\n\nexport default Themes;\n\n\n\n// WEBPACK FOOTER //\n// ./src/themes.js","'use strict';\n\nvar assign        = require('es5-ext/object/assign')\n  , normalizeOpts = require('es5-ext/object/normalize-options')\n  , isCallable    = require('es5-ext/object/is-callable')\n  , contains      = require('es5-ext/string/#/contains')\n\n  , d;\n\nd = module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif ((arguments.length < 2) || (typeof dscr !== 'string')) {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (dscr == null) {\n\t\tc = w = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t\tw = contains.call(dscr, 'w');\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== 'string') {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (get == null) {\n\t\tget = undefined;\n\t} else if (!isCallable(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (set == null) {\n\t\tset = undefined;\n\t} else if (!isCallable(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (dscr == null) {\n\t\tc = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/d/index.js\n// module id = 33\n// module chunks = 0","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.assign\n\t: require('./shim');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/assign/index.js\n// module id = 34\n// module chunks = 0","'use strict';\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== 'function') return false;\n\tobj = { foo: 'raz' };\n\tassign(obj, { bar: 'dwa' }, { trzy: 'trzy' });\n\treturn (obj.foo + obj.bar + obj.trzy) === 'razdwatrzy';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/assign/is-implemented.js\n// module id = 35\n// module chunks = 0","'use strict';\n\nvar keys  = require('../keys')\n  , value = require('../valid-value')\n\n  , max = Math.max;\n\nmodule.exports = function (dest, src/*, …srcn*/) {\n\tvar error, i, l = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry { dest[key] = src[key]; } catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < l; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/assign/shim.js\n// module id = 36\n// module chunks = 0","// Deprecated\n\n'use strict';\n\nmodule.exports = function (obj) { return typeof obj === 'function'; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/is-callable.js\n// module id = 37\n// module chunks = 0","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.keys\n\t: require('./shim');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/keys/index.js\n// module id = 38\n// module chunks = 0","'use strict';\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys('primitive');\n\t\treturn true;\n\t} catch (e) { return false; }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/keys/is-implemented.js\n// module id = 39\n// module chunks = 0","'use strict';\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) {\n\treturn keys(object == null ? object : Object(object));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/keys/shim.js\n// module id = 40\n// module chunks = 0","'use strict';\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\nmodule.exports = function (options/*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (options == null) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/normalize-options.js\n// module id = 41\n// module chunks = 0","'use strict';\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/valid-callable.js\n// module id = 42\n// module chunks = 0","'use strict';\n\nmodule.exports = function (value) {\n\tif (value == null) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/valid-value.js\n// module id = 43\n// module chunks = 0","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? String.prototype.contains\n\t: require('./shim');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/string/#/contains/index.js\n// module id = 44\n// module chunks = 0","'use strict';\n\nvar str = 'razdwatrzy';\n\nmodule.exports = function () {\n\tif (typeof str.contains !== 'function') return false;\n\treturn ((str.contains('dwa') === true) && (str.contains('foo') === false));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/string/#/contains/is-implemented.js\n// module id = 45\n// module chunks = 0","'use strict';\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/string/#/contains/shim.js\n// module id = 46\n// module chunks = 0","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 47\n// module chunks = 0","if(typeof __WEBPACK_EXTERNAL_MODULE_48__ === 'undefined') {var e = new Error(\"Cannot find module \\\"JSZip\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e;}\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_48__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"JSZip\"\n// module id = 48\n// module chunks = 0","import Book from './book';\nimport EpubCFI from './epubcfi';\nimport Rendition from './rendition';\nimport Contents from './contents';\n\n/**\n * Creates a new Book\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\n * @param {object} options to pass to the book\n * @returns {Book} a new Book object\n * @example ePub(\"/path/to/book.epub\", {})\n */\nfunction ePub(url, options) {\n\treturn new Book(url, options);\n};\n\nePub.VERSION = \"0.3.0\";\n\nif (typeof(global) !== \"undefined\") {\n\tglobal.EPUBJS_VERSION = ePub.VERSION;\n}\n\nePub.CFI = EpubCFI;\nePub.Rendition = Rendition;\nePub.Contents = Contents;\n\nePub.ViewManagers = {};\nePub.Views = {};\n/**\n * register plugins\n */\nePub.register = {\n\t/**\n\t * register a new view manager\n\t */\n\tmanager : function(name, manager){\n\t\treturn ePub.ViewManagers[name] = manager;\n\t},\n\t/**\n\t * register a new view\n\t */\n\tview : function(name, view){\n\t\treturn ePub.Views[name] = view;\n\t}\n};\n\n// Default Views\nePub.register.view(\"iframe\", require('./managers/views/iframe'));\n\n// Default View Managers\nePub.register.manager(\"default\", require('./managers/default'));\nePub.register.manager(\"continuous\", require('./managers/continuous'));\n\nexport default ePub;\n// export { Rendition };\n\n\n\n// WEBPACK FOOTER //\n// ./src/epub.js"],"sourceRoot":""}